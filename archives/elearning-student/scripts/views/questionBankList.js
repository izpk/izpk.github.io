define(["jquery","underscore","backbone","layer"],function(e,t,n,r){"use strict";return n.View.extend({el:"body",template:t.template(e("#template-question-bank-list").html()),events:{"click .questionBankList-type-btn":"questionBankListTypeBtn"},render:function(t,n,r){CAICUI.render.this.exit&&"function"==typeof CAICUI.render.this.exit&&e("body .questions").length&&(e("body .questions").remove(),CAICUI.render.this.exitMsg()),CAICUI.render.this=this,CAICUI.render.type=+t,CAICUI.render.certificate=n,CAICUI.render.certificateIndex="",CAICUI.render.subjectId=r,CAICUI.render.certificateArray=[{certificateName:"ACCA",certificateId:"ff808081473905e701475cd3c2080001"},{certificateName:"CMA",certificateId:"ff808081486933e601489c4662f60851"}],CAICUI.render.questionBankList={},CAICUI.render.questionBankList.typeArray=["realImitate","testSite"],CAICUI.render.questionBankList.type=t,CAICUI.render.ids=[],CAICUI.render.courseCategoryExamenListAjax=0,CAICUI.render.childKnowledgeNodePointListAjax=0,this.getcoursecategoryAjax(function(){CAICUI.render.certificateArray.forEach(function(e,t){e.certificateName==CAICUI.render.certificate&&(CAICUI.render.certificateIndex=t)});var t="";CAICUI.render.getcoursecategory[CAICUI.render.certificateIndex].subjects.forEach(function(e,n){var r=!1;CAICUI.render.type?e.knowledgePointId==CAICUI.render.subjectId&&(r=!0,CAICUI.render.subjectId=e.knowledgePointId):e.courseCategoryId==CAICUI.render.subjectId&&(r=!0,CAICUI.render.subjectId=e.courseCategoryId),r&&(t=e.subjectName,CAICUI.render.ids.push(e.courseCategoryId),CAICUI.render.ids.push(e.knowledgePointId))}),e("body #right").html(CAICUI.render.this.template({subjectId:CAICUI.render.subjectId,name:CAICUI.render.certificate,title:CAICUI.render.certificate+" "+t,type:CAICUI.render.type})),CAICUI.render.this.examenListRender(CAICUI.render.type,CAICUI.render.ids)})},getcoursecategoryAjax:function(e){CAICUI.Request.ajax({server:"getcoursecategory",done:function(t){CAICUI.render.getcoursecategory=t.data,e&&e()}})},examenListRender:function(n,r){CAICUI.render.type?this.childKnowledgeNodePointListAjax({id:r[1]},function(n){var r=[],i=[];t.each(n.data,function(e,t){r.push(e.knowledgePointId),i.push(e)}),CAICUI.render.this.exercisePointCountCache(r.toString(),function(n){var r=[];t.each(n.data,function(e,n){var o="",a=0,s="";t.each(i,function(t,n){t.knowledgePointId==e.knowledge_point_id&&+e.exercise_count&&(o=t.enTitle,a=e.exercise_count,s=t.id)}),r.push({title:o,number:a,id:s})});var o=e("#template-question-bank-imitate").html(),a=CAICUI.iGlobal.getTemplate(o,{data:r});e("body #scroller").html(a),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper"),e("body .questionBankList-li").on("click",function(e){CAICUI.render.this.questionBankListA(e)})})}):this.courseCategoryExamenListAjax({id:r[0]},function(t){var n=e("#template-question-bank-real").html(),r=CAICUI.iGlobal.getTemplate(n,t);e("body #scroller").html(r),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper"),e("body .questionBankList-real-li").on("click",function(e){CAICUI.render.this.questionBankListA(e)})})},childKnowledgeNodePointListAjax:function(e,t){CAICUI.Request.ajax({server:"childKnowledgeNodePointList",data:{knowledgePointId:CAICUI.render.ids[CAICUI.render.type]},done:function(n){"success"==n.state?(CAICUI.render.childKnowledgeNodePointList=n.data,t&&t(n)):CAICUI.render.childKnowledgeNodePointListAjax<2?(CAICUI.render.childKnowledgeNodePointListAjax++,CAICUI.render.this.childKnowledgeNodePointListAjax(e,t)):r.msg("Sorry~ 网络异常，请刷新页面重试。",function(){})},fail:function(n){CAICUI.render.childKnowledgeNodePointListAjax<2?(CAICUI.render.childKnowledgeNodePointListAjax++,CAICUI.render.this.childKnowledgeNodePointListAjax(e,t)):r.msg("Sorry~ 网络异常，请刷新页面重试。",function(){})}})},courseCategoryExamenListAjax:function(e,t){CAICUI.Request.ajax({server:"courseCategoryExamenList",data:{courseCategoryId:CAICUI.render.ids[CAICUI.render.type]},done:function(n){"success"==n.state?(CAICUI.render.courseCategoryExamenList=n.data,t&&t(n)):CAICUI.render.courseCategoryExamenListAjax<2?(CAICUI.render.courseCategoryExamenListAjax++,CAICUI.render.this.courseCategoryExamenListAjax(e,t)):r.msg("Sorry~ 网络异常，请刷新页面重试。",function(){})},fail:function(n){CAICUI.render.courseCategoryExamenListAjax<2?(CAICUI.render.courseCategoryExamenListAjax++,CAICUI.render.this.courseCategoryExamenListAjax(e,t)):r.msg("Sorry~ 网络异常，请刷新页面重试。",function(){})}})},exercisePointCountCache:function(e,t){CAICUI.Request.ajax({server:"exercisePointCountCache",data:{type:"4",knowledge_points:e},done:function(e){t&&t(e)},fail:function(e){}})},getQuestionBankIds:function(){var e=[];return CAICUI.render.getcoursecategory.forEach(function(t,n){t.certificateName==CAICUI.render.certificate&&t.subjects.forEach(function(t,n){t.subjectName==CAICUI.render.subject&&(e.push(t.courseCategoryId),e.push(t.knowledgePointId))})}),e},selectItem:function(e){var t=CAICUI.iGlobal.getThat(e),n=t.index(),r="";return t.hasClass("active")?r=!0:(r=!1,t.siblings().removeClass("active"),t.addClass("active")),{isActive:r,index:n}},selectQuestionBank:function(t){var n=this.selectItem(t),r=e("#template-question-bank-right").html(),i=CAICUI.iGlobal.getTemplate(r,CAICUI.render.questionBank.data[n.index]);e("body .question-bank-right").html(i)},questionBankListTypeBtn:function(t){var n=this.selectItem(t);if(console.log(n.isActive),!n.isActive){CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),CAICUI.render.questionBankList.type=n.index,CAICUI.render.type=n.index;var r="#questionBankList/"+CAICUI.render.type+"/"+CAICUI.render.certificate+"/"+CAICUI.render.ids[CAICUI.render.type];window.location.hash=r}},questionBankListA:function(e){var t=CAICUI.iGlobal.getThat(e).index(),n="",r=CAICUI.render.questionBankList.typeArray[CAICUI.render.questionBankList.type];+CAICUI.render.questionBankList.type?(n="#questionsTestSite/"+r+"/"+CAICUI.render.childKnowledgeNodePointList[t].knowledgePointId+"?return_link="+window.location.hash.substr(1)+"&return_hash=on",window.location.hash=n):(n="#questionsRealImitate/"+r+"/"+CAICUI.render.courseCategoryExamenList[t].id+"?return_link="+window.location.hash.substr(1)+"&return_hash=on",window.location.hash=n),console.log(n)}})});