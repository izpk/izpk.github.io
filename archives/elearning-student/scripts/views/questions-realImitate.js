define(["jquery","underscore","backbone","layer"],function(e,r,n,t){"use strict";return n.View.extend({el:"body",template:r.template(e("#template-questions-realImitate").html()),events:{"click .questions-card-button":"toggleCards","click .js-card-btn":"cardBtn","click .js-questions-btn-prev":"questionsPrev","click .js-questions-btn-next":"questionsNext","click .questions-correction-btn":"openFeedbackPop","click .questions-analysis-btn":"analysis","click .js-questions-option-click":"questionsOptionClick","keyup .js-questions-option-keyup":"questionsOptionKeyup","click .js-open-sidebar":"openSidebar","click .js-close-sidebar":"cloceSidebar","click .node-editor-isOpen-button":"nodeEditorIsOpenButton","click .node-editor-confirm":"nodeEditorConfirm","change #uploadForm-file":"uploadFormFile","click .view-other-btn":"viewOther","click #questions-guide-content":"stepGuide","click .questions-exit":"exit"},render:function(e,r){CAICUI.render.examType=e,CAICUI.render.examId=r,window.videoController={courseData:{},currentChapter:{},currentTask:{}},CAICUI.render.knowledgepointid=r,CAICUI.render.answerArr=["A","B","C","D","E","F","G","H"],CAICUI.render.this=this,CAICUI.render.typeHtml="",CAICUI.render.questionsType="",CAICUI.render.questionsStatus="",CAICUI.render.pushContext="",CAICUI.render.isDone="",CAICUI.render.exerciseId="",CAICUI.render.questionsDataCache="",CAICUI.render.questionsDataCacheArray=[],CAICUI.render.isMyChecked="",CAICUI.render.cardOpen=!1,CAICUI.render.exerciseIdOld="",CAICUI.render.exerciseIdNew="",CAICUI.render.exerciseNoDoneCount=0,CAICUI.render.exerciseRightCount=0,CAICUI.render.isPublic=1,CAICUI.render.currentProgress=0,CAICUI.render.isFinish=0,CAICUI.render.taskState=0,CAICUI.render.answerResolution={context:"",status:!0,rightAnswer:"",myAnswer:""},CAICUI.render.imgPathArray=[],CAICUI.render.questionsGuide="",CAICUI.render.questionsGuideIndex=1,CAICUI.render.this.questionsAnswer="",CAICUI.render.questionsIsSubmit=!0,CAICUI.render.questionsIndex="0",CAICUI.render.ExerciseTotalTime=0,CAICUI.render.lastExerciseNid=0,CAICUI.render.isDoneNew="",CAICUI.render.readonly="",CAICUI.render.viewResolution&&(CAICUI.render.readonly='readonly="readonly"'),CAICUI.render.this.$el.append(CAICUI.render.this.template()),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body .questions #wrapper"),this.init()},init:function(){this.getExamenInfoAjax(function(){e("body .questions-title").html(CAICUI.render.examenInfo.title)}),this.exerciseFilenameAjax(function(){var n=e("#template-questions-realImitate-cards").html(),t=CAICUI.iGlobal.getTemplate(n,{data:CAICUI.render.exerciseFilenameArray});e("body  .questions").append(t),CAICUI.render.this.exerciseKnowledgeMemberStatusAjax(CAICUI.render.examId,function(n){CAICUI.render.myExamContinue&&CAICUI.render.myExamContinue.examenNum?(CAICUI.render.examenNum=CAICUI.render.myExamContinue.examenNum,CAICUI.render.isFinish=n[0].is_finish,CAICUI.render.errorNum=+n[0].error_num,CAICUI.render.lastExerciseNid=+n[0].last_exercise_nid):n&&n.length&&(CAICUI.render.examenNum=n.length),CAICUI.render.this.userKnowledgePointExerciseListAjax(function(n){CAICUI.render.myExamContinue&&CAICUI.render.myExamContinue.examenNum||(n=[]),console.log(n),CAICUI.render.questionsDataCacheArray=n,CAICUI.render.exerciseNoDoneCount=CAICUI.render.exerciseCount-CAICUI.render.exerciseDoneCount,CAICUI.render.exerciseRightCount=CAICUI.render.exerciseDoneCount-CAICUI.render.errorNum;var t=0;CAICUI.render.exerciseDoneCount&&((t=CAICUI.render.exerciseRightCount/CAICUI.render.exerciseDoneCount*100)>0&&t<1&&(t=1),t=t.toFixed(0));var s=0;CAICUI.render.exerciseCount&&((s=CAICUI.render.exerciseDoneCount/CAICUI.render.exerciseCount*100)>0&&s<1&&(s=1),s=s.toFixed(0)),e("body .questions-progress-show").attr("data-course-progress",s),e("body .questions-percentage").html(s),e("body .questions-progress-show").animate({width:s+"%"},1e3),e(".exercise-done-count").text(CAICUI.render.exerciseDoneCount),e(".exercise-count").text(CAICUI.render.exerciseCount),e(".progress-round-count").text(t),e("#progress-round-question").attr("data-progress",t),CAICUI.iGlobal.canvasRound("progress-round-question",{borderColor:"#00A184",borderWidth:3,bg:!0,bgBorderColor:"#8CD5C8"}),console.log(n),r.each(n,function(r,n){var t="questions-cards-info";"0"==r.status?t="questions-cards-info":"1"==r.status?(t="questions-cards-success",e("#questions-card-"+r.exercise_id).attr("data-isdone","true")):"2"==r.status&&(t="questions-cards-danger",e("#questions-card-"+r.exercise_id).attr("data-isdone","false")),e("#questions-card-"+r.exercise_id).addClass(t)}),CAICUI.render.lastExerciseNid?CAICUI.render.questionsIndex=+CAICUI.render.lastExerciseNid:CAICUI.render.questionsIndex=0,CAICUI.render.taskProgress&&(CAICUI.render.questionsIndex=CAICUI.render.taskProgress),e("body #wrapper-cards .js-card-btn").eq(CAICUI.render.lastExerciseNid).addClass("questions-cards-active"),CAICUI.render.exerciseId=e(".js-card-btn").eq(CAICUI.render.questionsIndex).attr("data-exerciseid"),CAICUI.render.isDone=e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone"),CAICUI.render.isDone&&"1"==CAICUI.render.examExpress&&e("body .questions-body").addClass("questions-answerResolution-active"),CAICUI.render.this.getNidExerciseDetailAjax(function(){CAICUI.render.this.guide(),CAICUI.render.action="begintest",CAICUI.render.this.actionTaskProgress()})})})});var n=null;n=setInterval(function(){e("body .questions-cards-ul").find("li").length&&(window.CAICUI.myCardsScroll=CAICUI.iGlobal.iScroll("body .questions #wrapper-cards"),window.CAICUI.myCardsScroll.refresh(),clearInterval(n))},300)},openFeedbackPop:function(){CAICUI.render.feedbackType=["答案有异议","解析有误","错别字","排版错误","其他错误"];var n=r.template(e("#template-feedback-exam").html());CAICUI.render.feedbackTitle=CAICUI.render.this.getExerciseTitle(CAICUI.render.exerciseTitle,CAICUI.render.questionsType),e("body").append(n({currentTask:{progress:+CAICUI.render.questionsIndex+1,title:CAICUI.render.feedbackTitle},feedbackType:CAICUI.render.feedbackType})),CAICUI.Request.ajax({server:"member",data:{token:CAICUI.User.token},done:function(r){"success"==r.state?(CAICUI.render.member=r.data,e("body .pop-input-tel").val(CAICUI.render.member.mobile?CAICUI.render.member.mobile:CAICUI.render.member.email)):console.log("member:"+r)},fail:function(e){console.log("member:"+e)}}),this.feedbackAnimate(".pop-html"),this.feedbackEvent()},feedbackAnimate:function(r){e(r).animate({opacity:1},1e3)},feedbackEvent:function(){var r=e("#help-feedback-pop");r&&(r.on("click",".pop-radio-label",function(){var r=e(this);r.siblings().removeClass("active"),r.addClass("active")}),r.on("click",".pop-button-confirm",function(){var r=e(".pop-radio-label.active").index(),n=CAICUI.render.feedbackType[r],s=e(".pop-textarea").val();if(s){var i="",a=JSON.parse(e.cookie("questionBankCookie")),d={categoryName:a.categoryName,categoryId:a.categoryId,subjectName:a.subjectName,subjectId:a.subjectId,courseName:"真题模考",chapterName:"试题纠错",taskName:CAICUI.render.examenInfo.title,id:CAICUI.render.exerciseId};i+='<a class="content-addDom" data-nameJson="'+JSON.stringify(d)+'" href="javascript:;" data-course-id="'+CAICUI.render.courseId+'" data-chapter-id="'+CAICUI.render.chapterId+'" data-task-id="'+CAICUI.render.taskId+'" ';var o=0;i+='data-type="realImitate" data-sort="'+(o="0"==CAICUI.render.questionsIndex?"1":+CAICUI.render.questionsIndex+1)+'" data-exercise-id="'+CAICUI.render.exerciseId+'" data-title="'+CAICUI.render.examenInfo.title+'" ',s+=i+=">试题："+o+"题</a>";var C=e(".pop-input-tel").val();if(C){var I="MacIntel"==navigator.platform?"苹果":"",c=navigator.userAgent.split(" "),u=(c.length,c[c.length-2].split("/")[0]+"-"+c[c.length-1].split("/")[0]);CAICUI.render.this.feedbackAjax({memberId:CAICUI.User.memberId,memberName:CAICUI.User.nickname,cmptType:n,cmptContent:s,contactWay:C,deviceDesc:I+" "+u})}else t.msg("Sorry~ 请输入联系方式！",function(){})}else t.msg("Sorry~ 请输入内容！",function(){})}),r.on("click",".pop-button-cancel",function(){r.remove(),r.off()}))},feedbackAjax:function(r){CAICUI.Request.ajax({server:"addLMG",data:r,done:function(r){e(".pop-html").remove(),t.msg("提交成功",{icon:1,time:1e3},function(){e("#help-feedback-pop").remove(),e("#help-feedback-pop").off()})},fail:function(e){t.msg("Sorry~ ",function(){})}})},guide:function(r){CAICUI.render.questionsGuide=e.cookie("questionsGuide"),"true"!=CAICUI.render.questionsGuide?this.createGuide():this.callbackGuide()},createGuide:function(){var r=e("#template-questions-realImitate-guide").html(),n=CAICUI.iGlobal.getTemplate(r);e("body .questions").append(n)},removeGuide:function(){e("#questions-guide").remove(),e.cookie("questionsGuide",!0,{path:"/",expires:36500}),this.callbackGuide()},stepGuide:function(r){CAICUI.render.questionsGuideIndex=+CAICUI.render.questionsGuideIndex+1,CAICUI.render.questionsGuideIndex<6?e("body #questions-guide-content").attr("class","questions-guide-step-"+CAICUI.render.questionsGuideIndex):this.removeGuide()},callbackGuide:function(){CAICUI.render.this.clockTime(),document.onkeydown=function(e){var r=e||window.event||arguments.callee.caller.arguments[0];r&&37==r.keyCode&&CAICUI.render.this.questionsPrev(),r&&39==r.keyCode&&CAICUI.render.this.questionsNext()}},exerciseFilenameAjax:function(e){this.getExerciseId(function(r){CAICUI.render.exerciseFilenameArray=r,CAICUI.render.exerciseCount=r.length,e&&e()})},getExamenInfoAjax:function(e){CAICUI.Request.ajax({server:"getExamenInfo",data:{examenId:CAICUI.render.examId},done:function(r){CAICUI.render.examenInfo=r.data[0],e&&e(r.data)}})},exercisePointCountCacheAjax:function(e,r){CAICUI.Request.ajax({server:"exercisePointCountCache",data:{knowledge_points:e,type:4},done:function(e){r&&r(e.data)}})},exerciseKnowledgeMemberStatusAjax:function(e,r){var n="";CAICUI.render.myExamContinue&&(n=CAICUI.render.myExamContinue.examenNum),CAICUI.Request.ajax({server:"get_exercise_knowledge_member_status",data:{knowledge_points:e,type:4,member_id:CAICUI.User.memberId,examenNum:n},done:function(e){e&&e.data&&e.data.length?CAICUI.render.exerciseDoneCount=e.data[0].progress:CAICUI.render.exerciseDoneCount=0,r&&r(e.data)}})},userKnowledgePointExerciseListAjax:function(e){CAICUI.Request.ajax({server:"get_user_knowledge_point_exercise_list",data:{knowledge_point_id:CAICUI.render.examId,member_id:CAICUI.User.memberId,examenNum:CAICUI.render.examenNum},done:function(r){e&&e(r.data)}})},getNidExerciseDetailAjax:function(e){CAICUI.Request.ajax({server:"getNidExerciseDetail",data:{exerciseId:CAICUI.render.exerciseId},done:function(r){CAICUI.render.prevClick="",CAICUI.render.nextClick="",CAICUI.render.exerciseTitle="",CAICUI.render.exerciseDetail=r.data[0],console.log(CAICUI.render.exerciseId),console.log(r.data[0].id),CAICUI.render.exerciseId!==r.data[0].id&&(CAICUI.render.exerciseIdOld=CAICUI.render.exerciseId,CAICUI.render.exerciseIdNew=r.data[0].id,CAICUI.render.exerciseId=r.data[0].id),r.data[0].title&&(CAICUI.render.exerciseTitle+=r.data[0].title),r.data[0].background&&(CAICUI.render.exerciseTitle+=r.data[0].background),CAICUI.render.this.addDOMNidExerciseDetail(r.data[0]),e&&e(r.data)}})},addDOMNidExerciseDetail:function(r){0==CAICUI.render.lastExerciseNid?e("body .js-questions-btn-prev").hide():e("body .js-questions-btn-prev").show(),+CAICUI.render.lastExerciseNid+1!=CAICUI.render.exerciseCount||CAICUI.render.viewResolution?e("body .js-questions-btn-next").removeClass("questions-btn-done"):e("body .js-questions-btn-next").addClass("questions-btn-done");var n=r,t=e("#template-questions-realImitate-content").html(),s=CAICUI.iGlobal.getTemplate(t,{item:n});e("body .questions #scroller").html(s),e("body .questions #scroller").find("img").each(function(r){var n=e(this).attr("src"),t=n.substr(-3);"jpg"!=t&&"png"!=t&&"gif"!=t&&"svg"!=t||(n=CAICUI.Common.host.static+n),e(this).attr("src",n)}),setTimeout(function(){window.CAICUI.myScroll.refresh(),window.CAICUI.myScroll.scrollTo(0,0)},300)},setMemberExerciseLogAjax:function(r){if(CAICUI.render.viewResolution)return CAICUI.render.this.doneChange(),r&&r(),!1;this.questionsStatus(function(){if(CAICUI.render.isMyChecked){CAICUI.render.isMyChecked="",CAICUI.render.isDone=e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone"),1==CAICUI.render.status?e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone","true"):2==CAICUI.render.status&&e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone","false");for(var n=e("body .js-card-btn"),t=0,s=0,i=0,a=0;a<n.length;a++){var d=n.eq(a).attr("data-isdone");"true"==d?t++:"false"==d?s++:i++}if(CAICUI.render.exerciseRightCount=t,CAICUI.render.errorNum=s,CAICUI.render.exerciseDoneCount=t+s,CAICUI.render.exerciseNoDoneCount=i,CAICUI.render.exerciseIdOld&&CAICUI.render.exerciseIdNew){var o={knowledgePointId:CAICUI.render.knowledgepointid,exerciseId:CAICUI.render.exerciseIdOld,memberId:CAICUI.User.memberId,context:"'"+JSON.stringify(CAICUI.render.pushContext)+"'",status:CAICUI.render.status,progress:CAICUI.render.exerciseDoneCount,lastExerciseNid:CAICUI.render.lastExerciseNid,errorNum:CAICUI.render.errorNum,correctNum:CAICUI.render.exerciseRightCount,totalTime:CAICUI.render.ExerciseTotalTime,examenNum:CAICUI.render.examenNum,examenType:CAICUI.render.examType,isFinish:CAICUI.render.isFinish,currentProgress:+CAICUI.render.currentProgress,exerciseTitle:CAICUI.render.exerciseTitle,examenTotalNum:CAICUI.render.exerciseBaseInfo.length,examenName:CAICUI.render.examenInfo.title,subjectId:CAICUI.render.subjectId,categoryId:CAICUI.render.categoryId,courseId:CAICUI.render.courseId,chapterId:CAICUI.render.chapterId,taskId:videoController.currentTask.taskId,cacheKnowledgeLevel1Id:CAICUI.render.cacheKnowledgeLevel1Id,cacheKnowledgeLevel2Id:CAICUI.render.cacheKnowledgeLevel2Id,cacheKnowledgePath:CAICUI.render.cacheKnowledgePath};CAICUI.Request.ajax({server:"setMemberExerciseLog",data:o,done:function(e){for(var r=!1,n=0,t=0;t<CAICUI.render.questionsDataCacheArray.length;t++){(CAICUI.render.questionsDataCacheArray[t].exercise_id||CAICUI.render.questionsDataCacheArray[t].exerciseId)==CAICUI.render.exerciseIdOld&&(r=!0,n=t)}console.log(r+";"+n),r?CAICUI.render.questionsDataCacheArray[n].context=JSON.stringify(CAICUI.render.pushContext):CAICUI.render.questionsDataCacheArray.push(o)}})}o={knowledgePointId:CAICUI.render.knowledgepointid,exerciseId:CAICUI.render.exerciseId,memberId:CAICUI.User.memberId,context:"'"+JSON.stringify(CAICUI.render.pushContext)+"'",status:CAICUI.render.status,subjectId:CAICUI.render.subjectId,categoryId:CAICUI.render.categoryId,courseId:CAICUI.render.courseId,chapterId:CAICUI.render.chapterId,taskId:videoController.currentTask.taskId,cacheKnowledgeLevel1Id:CAICUI.render.cacheKnowledgeLevel1Id,cacheKnowledgeLevel2Id:CAICUI.render.cacheKnowledgeLevel2Id,cacheKnowledgePath:CAICUI.render.cacheKnowledgePath,progress:CAICUI.render.exerciseDoneCount,lastExerciseNid:CAICUI.render.lastExerciseNid,errorNum:CAICUI.render.errorNum,correctNum:CAICUI.render.exerciseRightCount,totalTime:CAICUI.render.ExerciseTotalTime,examenNum:CAICUI.render.examenNum,examenName:CAICUI.render.examenInfo.title,examenTotalNum:CAICUI.render.exerciseBaseInfo.length,examenType:CAICUI.render.examType,isFinish:CAICUI.render.isFinish,currentProgress:+CAICUI.render.currentProgress,exerciseTitle:CAICUI.render.exerciseTitle};CAICUI.Request.ajax({server:"setMemberExerciseLog",data:o,done:function(e){for(var n=!1,t=0,s=0;s<CAICUI.render.questionsDataCacheArray.length;s++){(CAICUI.render.questionsDataCacheArray[s].exercise_id||CAICUI.render.questionsDataCacheArray[s].exerciseId)==CAICUI.render.exerciseId&&(n=!0,t=s)}console.log(n+";"+t),n?CAICUI.render.questionsDataCacheArray[t].context=JSON.stringify(CAICUI.render.pushContext):CAICUI.render.questionsDataCacheArray.push(o),CAICUI.render.this.doneChange(),console.log(CAICUI.render.isFinish),CAICUI.render.this.actionTaskProgress(),r&&r(e)}})}else CAICUI.render.status=0,1==CAICUI.render.isFinish&&CAICUI.render.this.actionTaskProgress(),r&&r()})},doneChange:function(){1==CAICUI.render.status?e("body .js-card-btn").eq(CAICUI.render.questionsIndex).attr("data-isdone","true"):2==CAICUI.render.status&&e("body .js-card-btn").eq(CAICUI.render.questionsIndex).attr("data-isdone","false"),e("body .knowledge-point-number-"+CAICUI.render.knowledgepointid).text(CAICUI.render.exerciseDoneCount),e("body #knowledge-point-btn-"+CAICUI.render.knowledgepointid).attr("data-last-exercise-nid",CAICUI.render.lastExerciseNid),e("body #knowledge-point-btn-"+CAICUI.render.knowledgepointid).attr("data-exercise-progress",CAICUI.render.exerciseDoneCount),e("body #knowledge-point-btn-"+CAICUI.render.knowledgepointid).attr("data-exercise-total-time",CAICUI.render.ExerciseTotalTime),e("body #knowledge-point-btn-"+CAICUI.render.knowledgepointid).attr("data-errornum",CAICUI.render.errorNum),e(".exercise-done-count").text(CAICUI.render.exerciseDoneCount),e(".exercise-count").text(CAICUI.render.exerciseCount);var r=0;CAICUI.render.exerciseDoneCount&&((r=CAICUI.render.exerciseRightCount/CAICUI.render.exerciseDoneCount*100)>0&&r<1&&(r=1),r=r.toFixed(0));var n=0;CAICUI.render.exerciseCount&&((n=CAICUI.render.exerciseDoneCount/CAICUI.render.exerciseCount*100)>0&&n<1&&(n=1),n=n.toFixed(0)),e("body .questions-progress-show").attr("data-course-progress",n),e("body .questions-percentage").html(n),e("body .questions-progress-show").animate({width:n+"%"},1e3),e(".progress-round-count").text(r),e("#progress-round-question").attr("data-progress",r),CAICUI.iGlobal.canvasRound("progress-round-question",{borderColor:"#00A184",borderWidth:3,bg:!0,bgBorderColor:"#bgBorderWidth"})},analysis:function(r){CAICUI.iGlobal.getThat(r);var n=this.$el.find(".questions-answerResolution");n.hasClass("active")?(n.removeClass("active"),e("body .questions-body").removeClass("questions-answerResolution-active")):(e("body .questions-body").addClass("questions-answerResolution-active"),this.questionsStatus(function(){}),CAICUI.render.isMyChecked?e("body .js-card-btn").eq(+CAICUI.render.questionsIndex).trigger("click"):n.addClass("active")),window.CAICUI.myScroll.refresh()},cardBtn:function(r){var n=CAICUI.iGlobal.getThat(r),t=(n.find("button"),n.attr("data-index"));CAICUI.render.questionsIsSubmit&&(CAICUI.render.questionsIsSubmit=!1,CAICUI.render.prevClick||CAICUI.render.nextClick||(CAICUI.render.action="seektest"),this.setMemberExerciseLogAjax(function(r){CAICUI.render.this.questionsLoaderContent();var s="";s=CAICUI.render.exerciseIdOld?e("#questions-card-"+CAICUI.render.exerciseIdOld):e("#questions-card-"+CAICUI.render.exerciseId),1==CAICUI.render.status?s.removeClass("questions-cards-danger").addClass("questions-cards-success"):2==CAICUI.render.status&&s.removeClass("questions-cards-success").addClass("questions-cards-danger"),e("body .questions .js-card-btn").removeClass("questions-cards-active"),n.addClass("questions-cards-active"),CAICUI.render.exerciseId=n.attr("data-exerciseid"),CAICUI.render.lastExerciseNid=t,+CAICUI.render.ExerciseProgress<+t+1&&(CAICUI.render.ExerciseProgress=+t+1),CAICUI.render.questionsIndex=t,CAICUI.render.currentProgress=t,e("body .right-questions-item-count").text(+CAICUI.render.questionsIndex+1),CAICUI.render.isDone=n.attr("data-isdone"),CAICUI.render.exerciseIdOld="",CAICUI.render.exerciseIdNew="",CAICUI.render.isDoneNew="",CAICUI.render.this.getNidExerciseDetailAjax(function(){CAICUI.render.isDone&&"1"==CAICUI.render.examExpress?e("body .questions-body").addClass("questions-answerResolution-active"):e("body .questions-body").removeClass("questions-answerResolution-active"),CAICUI.render.questionsIsSubmit=!0,CAICUI.render.cardOpen&&(e("body .questions-card-button").trigger("click"),CAICUI.render.cardOpen=!1)})}))},questionsPrev:function(r){if(CAICUI.render.questionsIndex>0){var n=+CAICUI.render.questionsIndex-1;CAICUI.render.prevClick=!0,CAICUI.render.action="test",e("body .js-card-btn").eq(n).trigger("click")}},questionsNext:function(r){var n=CAICUI.iGlobal.getThat(r);if(+CAICUI.render.questionsIndex<+CAICUI.render.exerciseCount){+CAICUI.render.questionsIndex+1==+CAICUI.render.exerciseCount&&(CAICUI.render.viewResolution?t.msg("已经是最后一题了~",{time:2e3},function(){}):(n.hasClass("questions-btn-done")&&(CAICUI.render.action="submittest",CAICUI.render.isFinish=1,CAICUI.render.taskState=1),this.setMemberExerciseLogAjax(function(r){var n="";n=CAICUI.render.exerciseIdOld?e("#questions-card-"+CAICUI.render.exerciseIdOld):e("#questions-card-"+CAICUI.render.exerciseId),1==+CAICUI.render.status?n.removeClass("questions-cards-danger").addClass("questions-cards-success"):2==+CAICUI.render.status&&n.removeClass("questions-cards-success").addClass("questions-cards-danger"),CAICUI.render.exerciseDoneCount,CAICUI.render.exerciseCount,CAICUI.render.this.setMemberExamenFinish(),CAICUI.render.this.getMemberErrorExercise(function(){CAICUI.render.this.setMemberErrorExercise()}),t.msg("试卷已提交，进入我的试卷查看试卷解析",{time:2e3},function(){window.location.hash="#myExam"})})));var s=+CAICUI.render.questionsIndex+1;CAICUI.render.nextClick=!0,CAICUI.render.action="test",e("body .js-card-btn").eq(s).trigger("click")}},actionTaskProgress:function(){console.log(CAICUI.render.action);var e={action:CAICUI.render.action,token:CAICUI.User.token,memberId:CAICUI.User.memberId,progress:CAICUI.render.exerciseDoneCount,total:CAICUI.render.exerciseCount,taskId:videoController.currentTask.taskId,chapterId:videoController.currentChapter.chapterId,courseId:videoController.courseData.courseId,subjectId:videoController.courseData.subjectId,categoryId:videoController.courseData.categoryId,taskName:videoController.currentTask.title,chapterName:videoController.currentChapter.chapterTitle,courseName:videoController.courseData.courseName,subjectName:videoController.courseData.subjectName,categoryName:videoController.courseData.categoryName,state:CAICUI.render.taskState,memberName:CAICUI.User.nickname,isSupply:0,createDate:(new Date).getTime()};CAICUI.Request.ajax({server:"actionTaskProgress",data:{token:CAICUI.User.token,message:JSON.stringify(e)},done:function(e){}})},setMemberExamenFinish:function(){CAICUI.Request.ajax({server:"setMemberExamenFinish",data:{memberId:CAICUI.User.memberId,examenid:CAICUI.render.examId,examenNum:CAICUI.render.examenNum},done:function(e){}})},setMemberErrorExercise:function(){CAICUI.Request.ajax({server:"setMemberErrorExercise",data:{memberId:CAICUI.User.memberId,examenId:CAICUI.render.examId,errorexerciseids:CAICUI.render.errorexerciseids,correctexerciseids:CAICUI.render.correctexerciseids,errorexerciseRecords:JSON.stringify(CAICUI.render.errorexerciseRecords),examenName:CAICUI.render.examName},done:function(e){}})},getMemberErrorExercise:function(r){var n="",t="",s=[];e("body #wrapper-cards .js-card-btn").each(function(r,i){var a=e(this),d=a.attr("data-index"),o=a.attr("data-exerciseid");if(a.hasClass("questions-cards-success"))t+=o+",";else{var C=CAICUI.render.this.getExerciseTitle(CAICUI.render.exerciseBaseInfo[d].title,CAICUI.render.exerciseBaseInfo[d].questionTypes);n+=o+",",s.push({sort:d,exerciseid:o,exerciseTitle:C})}}),CAICUI.render.correctexerciseids=t,CAICUI.render.errorexerciseids=n,CAICUI.render.errorexerciseRecords=s,r&&r()},getExerciseTitle:function(e,r){var n="";if(e)n=e.replace(/<[^>]+>/g,"").replace(/(^\s+)|(\s+$)/g,"").replace(/(\r)|(\n)|(\t)/g,"");else switch(r){case"radio":n="单选题";break;case"checkbox":n="复选题";break;case"blank":n="填空题";break;case"question":n="简答题";break;case"matrixRadio":n="矩阵单选题";break;case"matrixCheckbox":n="矩阵复选题";break;case"matrixBlank":n="矩阵填空题";break;case"multiTask":n="多任务题"}return n},getQuestionsDataCacheIndex:function(r,n){for(var t=0,s=CAICUI.render.questionsDataCacheArray.length,i=0;i<s;i++){if((CAICUI.render.questionsDataCacheArray[i].exercise_id||CAICUI.render.questionsDataCacheArray[i].exerciseId)==CAICUI.render.exerciseId)return CAICUI.render.questionsDataCache=CAICUI.render.questionsDataCacheArray[i],"0"==CAICUI.render.questionsDataCache.status?CAICUI.render.isDone="":"1"==CAICUI.render.questionsDataCache.status?CAICUI.render.isDone="true":"2"==CAICUI.render.questionsDataCache.status&&(CAICUI.render.isDone="false"),CAICUI.render.questionsDataCacheArray[i];t++}console.log(t+";"+s),t==s&&(console.log("没有做题记录"),CAICUI.render.isDoneNew="none",CAICUI.render.exerciseIdOld&&CAICUI.render.exerciseIdNew&&(e("body #questions-card-"+CAICUI.render.exerciseIdOld).removeAttr("data-isdone"),e("body #questions-card-"+CAICUI.render.exerciseIdNew).removeAttr("data-isdone")))},filterQuestionsContent:function(e){var r={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"',"#39":"'"},n=e.replace(/&(lt|gt|nbsp|amp|quot|#39);/gi,function(e,n){return r[n]}),t=n.split('"false"');n="";for(var s=t.length,i=0;i<s;i++)n+=i==s-1?t[i]:t[i]+"false";var a=n.split('"true"');n="";for(s=a.length,i=0;i<s;i++)n+=i==s-1?a[i]:a[i]+"true";return n},questions:function(n,t,s){CAICUI.render.questionsAnswer="",CAICUI.render.typeHtml="",CAICUI.render.questionsType=n;var i=this.getQuestionsDataCacheIndex();if(CAICUI.render.isDone=e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone"),console.log(CAICUI.render.isDone),console.log(CAICUI.render.isDoneNew),CAICUI.render.isDone&&"none"!=CAICUI.render.isDoneNew){"active";var a=i.context,d=this.filterQuestionsContent(a);try{CAICUI.render.pushContext=JSON.parse(d)}catch(e){CAICUI.render.pushContext=JSON.parse(d.slice(1,d.length-1))}}else{CAICUI.render.isDone="";d=this.filterQuestionsContent(t);try{CAICUI.render.pushContext=JSON.parse(d)}catch(e){if("question"==CAICUI.render.exerciseDetail.questionTypes){var o=d.split('":"');console.log(o),CAICUI.render.pushContext=[{blank:o[1].substring(0,o[1].length-2)}]}}}return console.log(CAICUI.render.pushContext),CAICUI.render.answerResolution.context=s,"multiTask"===n?r.each(CAICUI.render.pushContext,function(e,r){CAICUI.render.typeHtml+='<div class="questions-options-box"><div class="questions-options-title">'+e.title+"</div>",CAICUI.render.this.questionsTypes(e.type,e.data,r),CAICUI.render.typeHtml+="</div>"}):(CAICUI.render.typeHtml+='<div class="questions-options-box">',CAICUI.render.this.questionsTypes(n,CAICUI.render.pushContext,0),CAICUI.render.typeHtml+="</div>"),CAICUI.render.typeHtml},questionsTypes:function(e,r,n,t){switch(e){case"checkbox":CAICUI.render.this.checkbox(r,n);break;case"radio":CAICUI.render.this.radio(r,n);break;case"question":CAICUI.render.this.question(r,n);break;case"blank":CAICUI.render.this.blank(r,n);break;case"matrixRadio":CAICUI.render.this.matrix("matrixRadio",r,n,t);break;case"matrixCheckbox":CAICUI.render.this.matrix("matrixCheckbox",r,n,t);break;case"matrixBlank":CAICUI.render.this.matrix("matrixBlank",r,n,t)}},checkbox:function(e,n){var t=!0,s="",i="";r.each(e,function(e,r){if(!CAICUI.render.this.optionRegExpTest(e.title)){var a="";e.isChecked&&(s+=CAICUI.render.answerArr[r]+" "),e.myChecked&&(a="active",i+=CAICUI.render.answerArr[r]+" "),e.isChecked!=e.myChecked&&(t=!1),CAICUI.render.typeHtml+='<div data-number="'+n+"-"+r+'" class="questions-hover questions-checkbox js-questions-option-click '+a+'"  data-mychecked='+e.myChecked+" data-ischecked="+e.isChecked+'><label><span class="questions-checkbox-input"></span><span class="questions-options-item">'+CAICUI.render.answerArr[r]+"：</span><div>"+e.title+"</div></label></div>"}}),CAICUI.render.answerResolution={status:t,rightAnswer:s,myAnswer:i}},radio:function(e,n){var t=!0,s="",i="";r.each(e,function(e,r){if(!CAICUI.render.this.optionRegExpTest(e.title)){var a="";e.isChecked&&(s+=CAICUI.render.answerArr[r]+" "),e.myChecked&&(a="active",i+=CAICUI.render.answerArr[r]+" "),e.isChecked!=e.myChecked&&(t=!1),CAICUI.render.typeHtml+='<div data-number="'+n+"-"+r+'" class="questions-hover questions-radio js-questions-option-click '+a+'" data-mychecked='+e.myChecked+" data-ischecked="+e.isChecked+'><label><span class="questions-radio-input"></span><span class="questions-options-item">'+CAICUI.render.answerArr[r]+"：</span><div>"+e.title+"</div></label></div>"}}),CAICUI.render.answerResolution={status:t,rightAnswer:s,myAnswer:i}},question:function(e,r){var n=!0,t="";e[0].myBlank&&(t=e[0].myBlank),e[0].blank!=e[0].myBlank&&(n=!1),CAICUI.render.typeHtml+='<div data-number="'+r+'-0" class="questions-question js-questions-option-keyup"><textarea '+CAICUI.render.readonly+" >"+t+"</textarea></div>",CAICUI.render.answerResolution={status:n,rightAnswer:e[0].blank,myAnswer:e[0].myBlank}},blank:function(e,r){var n=!0,t="";e[0].myBlank&&(t=e[0].myBlank),e[0].blank!=e[0].myBlank&&(n=!1),CAICUI.render.typeHtml+='<div data-number="'+r+'-0" class="questions-blank js-questions-option-keyup"><input '+CAICUI.render.readonly+' type="input" value='+t+"></div>",CAICUI.render.answerResolution={status:n,rightAnswer:e[0].blank,myAnswer:e[0].myBlank}},matrix:function(e,r,n,t){var s=r[0],i=(s.items.length,s.cols),a=s.rows;CAICUI.render.typeHtml+='<table class="questions-table questions-matrix questions-matrix-'+e+'"><tbody class="questions-tbody">';for(var d=0;d<a;d++){CAICUI.render.typeHtml+='<tr class="questions-tr">';for(var o=[],C=1;C<i;C++)o.push(C+d*i);for(var I=0;I<i;I++){var c=I+d*i,u=s.items[c],l="",A="";if(u.title&&c)CAICUI.render.typeHtml+='<td class="questions-td">'+u.title+"</td>";else if(c){switch(e){case"matrixRadio":u.myChecked&&(l=" active"),CAICUI.render.typeHtml+="<td data-mychecked="+u.myChecked+" data-rowsArray="+o+' data-number="'+n+"-"+c+'" class="questions-td  questions-radio js-questions-option-click'+l+'" data-ischecked='+u.isChecked+">",CAICUI.render.typeHtml+='<span class="questions-radio-input"></span>';break;case"matrixCheckbox":u.myChecked&&(l=" active"),CAICUI.render.typeHtml+="<td data-mychecked="+u.myChecked+' data-number="'+n+"-"+c+'" class="questions-td  questions-checkbox js-questions-option-click'+l+'" data-ischecked='+u.isChecked+">",CAICUI.render.typeHtml+='<span class="questions-checkbox-input"></span>';break;case"matrixBlank":u.myBlank&&(A=u.myBlank),CAICUI.render.typeHtml+='<td data-number="'+n+"-"+c+'" class="questions-td js-questions-option-keyup">',CAICUI.render.typeHtml+="<input "+CAICUI.render.readonly+' type="text" value="'+A+'" >'}CAICUI.render.typeHtml+="</td>"}else CAICUI.render.typeHtml+='<td class="questions-td"></td>'}CAICUI.render.typeHtml+="</tr>"}CAICUI.render.typeHtml+="</tbody></table>"},questionsResolution:function(n,t,s){if("string"==typeof(t=CAICUI.render.pushContext))try{t=JSON.parse(t)}catch(e){t=t}CAICUI.render.questionsAnswerHtml="",CAICUI.render.questionsAnswerHtml+='<p class="questions-answerResolution-p">问题解析</p>';var i=0,a="questions-answer-error",d=(CAICUI.render.exerciseIdOld?e("body #questions-card-"+CAICUI.render.exerciseIdOld):e("body #questions-card-"+CAICUI.render.exerciseId)).attr("data-isdone");return"true"==d?(i=1,CAICUI.render.questionsStatus="回答正确",a="questions-answer-success"):"false"==d?(i=2,CAICUI.render.questionsStatus="回答错误 正确答案是："):(i=0,CAICUI.render.questionsStatus="正确答案是："),1==i?(CAICUI.render.questionsAnswerHtml+='<div class="questions-answer-status '+a+'">',CAICUI.render.questionsAnswerHtml+='<span class="questions-answer ">'+CAICUI.render.questionsStatus+"</span>",CAICUI.render.questionsAnswerHtml+="</div>"):2==i&&("multiTask"==n?(CAICUI.render.questionsAnswerHtml+='<div class="questions-answer-status '+a+'">',CAICUI.render.questionsAnswerHtml+='<span class="questions-answer ">'+CAICUI.render.questionsStatus+"</span>",r.each(t,function(e,r){CAICUI.render.questionsAnswer="",CAICUI.render.questionsAnswerHtml+='<p class="questions-answerResolution-item">第'+(+r+1)+"题：</p>",CAICUI.render.this.questionsResolutionTypes(e.type,e.data,r,!0)})):(CAICUI.render.questionsAnswerHtml+='<div class="questions-answer-status '+a+'">',CAICUI.render.questionsAnswerHtml+='<span class="questions-answer ">'+CAICUI.render.questionsStatus+"</span>",this.questionsResolutionTypes(n,t,0,!0)),CAICUI.render.questionsAnswerHtml+="</div>"),CAICUI.render.questionsAnswerHtml+='<div class="questions-answerResolution-content">',CAICUI.render.questionsAnswerHtml+='<span class="questions-answerResolution-text">解析：</span>',CAICUI.render.questionsAnswerHtml+=s||"暂无解析",CAICUI.render.questionsAnswerHtml+="</div>",CAICUI.render.questionsAnswerHtml},questionsResolutionTypes:function(e,r,n,t){switch(e){case"checkbox":CAICUI.render.this.checkboxChecked(r,n),CAICUI.render.questionsAnswerHtml+='<span class="questions-answer">'+CAICUI.render.answerResolution.rightAnswer+"</span>";break;case"radio":CAICUI.render.this.radioChecked(r,n),CAICUI.render.questionsAnswerHtml+='<span class="questions-answer">'+CAICUI.render.answerResolution.rightAnswer+"</span>";break;case"question":CAICUI.render.this.questionChecked(r,n),CAICUI.render.questionsAnswerHtml+='<span class="questions-answer">'+CAICUI.render.answerResolution.rightAnswer+"</span>";break;case"blank":CAICUI.render.questionsAnswerHtml+='<span class="questions-answer">'+CAICUI.render.answerResolution.rightAnswer+"</span>";break;case"matrixRadio":CAICUI.render.this.matrixChecked("matrixRadio",r,n,t);break;case"matrixCheckbox":CAICUI.render.this.matrixChecked("matrixCheckbox",r,n,t);break;case"matrixBlank":CAICUI.render.this.matrixChecked("matrixBlank",r,n,t)}return CAICUI.render.questionsAnswerHtml},checkboxChecked:function(e,n){var t=!0,s="",i="";r.each(e,function(e,r){if(!CAICUI.render.this.optionRegExpTest(e.title)){var a="";e.isChecked&&(s+=CAICUI.render.answerArr[r]+" "),e.myChecked&&(a="active",i+=CAICUI.render.answerArr[r]+" "),e.isChecked!=e.myChecked&&(t=!1),CAICUI.render.typeHtml+='<div data-number="'+n+"-"+r+'" class="questions-hover questions-checkbox js-questions-option-click '+a+'"  data-mychecked='+e.myChecked+" data-ischecked="+e.isChecked+'><label><span class="questions-checkbox-input"></span><span class="questions-options-item">'+CAICUI.render.answerArr[r]+"：</span><div>"+e.title+"</div></label></div>"}}),CAICUI.render.answerResolution={status:t,rightAnswer:s,myAnswer:i}},radioChecked:function(e,n){var t=!0,s="",i="";r.each(e,function(e,r){if(!CAICUI.render.this.optionRegExpTest(e.title)){var a="";e.isChecked&&(s+=CAICUI.render.answerArr[r]+" "),e.myChecked&&(a="active",i+=CAICUI.render.answerArr[r]+" "),e.isChecked!=e.myChecked&&(t=!1),CAICUI.render.typeHtml+='<div data-number="'+n+"-"+r+'" class="questions-hover questions-radio js-questions-option-click '+a+'" data-mychecked='+e.myChecked+" data-ischecked="+e.isChecked+'><label><span class="questions-radio-input"></span><span class="questions-options-item">'+CAICUI.render.answerArr[r]+"：</span><div>"+e.title+"</div></label></div>"}}),CAICUI.render.answerResolution={status:t,rightAnswer:s,myAnswer:i}},questionChecked:function(e,r){var n=!0,t="";e[0].myBlank&&(t=e[0].myBlank),e[0].blank!=e[0].myBlank&&(n=!1),CAICUI.render.typeHtml+='<div data-number="'+r+'-0" class="questions-question js-questions-option-keyup"><textarea '+CAICUI.render.readonly+">"+t+"</textarea></div>",CAICUI.render.answerResolution={status:n,rightAnswer:e[0].blank,myAnswer:e[0].myBlank}},blankChecked:function(e,r){var n=!0,t="";e[0].myBlank&&(t=e[0].myBlank),e[0].blank!=e[0].myBlank&&(n=!1),CAICUI.render.typeHtml+='<div data-number="'+r+'-0" class="questions-blank js-questions-option-keyup"><input '+CAICUI.render.readonly+' type="input" value='+t+"></div>",CAICUI.render.answerResolution={status:n,rightAnswer:e[0].blank,myAnswer:e[0].myBlank}},matrixChecked:function(e,r,n,t){var s=r[0],i=(s.items.length,s.cols),a=s.rows,d=!1,o="",C="",I="",c="",u="";CAICUI.render.questionsAnswerHtml+='<table class="questions-table questions-matrix questions-matrix-'+e+'"><tbody class="questions-tbody">';for(var l=0;l<a;l++){CAICUI.render.questionsAnswerHtml+='<tr class="questions-tr">';for(var A=[],U=1;U<i;U++)A.push(U+l*i);for(var m=0;m<i;m++){var h=m+l*i,x=s.items[h];if(d=!1,o="",c="",C=" js-questions-option-click",I=" js-questions-option-keyup",x.title&&h)CAICUI.render.questionsAnswerHtml+='<td class="questions-td">'+x.title+"</td>";else if(h){switch(t&&(C="",I="",x.isChecked&&(d=!0,o=" active"),x.blank&&(console.log(x.blank),u="disabled",c=x.blank)),e){case"matrixRadio":CAICUI.render.questionsAnswerHtml+="<td data-mychecked="+d+" data-rowsArray="+A+' data-number="'+n+"-"+h+'" class="questions-td  questions-radio '+o+C+'" data-ischecked='+x.isChecked+">",CAICUI.render.questionsAnswerHtml+='<span class="questions-radio-input"></span>';break;case"matrixCheckbox":CAICUI.render.questionsAnswerHtml+="<td data-mychecked="+d+' data-number="'+n+"-"+h+'" class="questions-td  questions-checkbox '+o+C+'" data-ischecked='+x.isChecked+">",CAICUI.render.questionsAnswerHtml+='<span class="questions-checkbox-input"></span>';break;case"matrixBlank":CAICUI.render.questionsAnswerHtml+="<td data-mychecked="+d+' data-number="'+n+"-"+h+'" class="questions-td '+I+'">',CAICUI.render.questionsAnswerHtml+="<input "+CAICUI.render.readonly+' type="text" value="'+c+'" '+u+">"}CAICUI.render.questionsAnswerHtml+="</td>"}else CAICUI.render.questionsAnswerHtml+='<td class="questions-td"></td>'}CAICUI.render.questionsAnswerHtml+="</tr>"}CAICUI.render.questionsAnswerHtml+="</tbody></table>"},questionsOptionClick:function(e){if(e.preventDefault(),CAICUI.render.viewResolution)return!1;var r=CAICUI.iGlobal.getThat(e),n=r.attr("data-mychecked"),t=r.attr("data-number").split("-");"true"==n?(r.removeClass("active"),n=!1,r.attr("data-mychecked",n)):(r.hasClass("questions-radio")&&(r.siblings().attr("data-mychecked","false"),r.siblings().removeClass("active")),r.addClass("active"),n=!0,r.attr("data-mychecked",n)),"multiTask"==CAICUI.render.questionsType?this.changeMultiTaskQuestionsDataClick(CAICUI.render.pushContext[t[0]].type,t,n,r):this.changeQuestionsDataClick(CAICUI.render.questionsType,t,n,r)},changeQuestionsDataClick:function(e,n,t,s){switch(e){case"radio":r.each(CAICUI.render.pushContext,function(e,r){e.myChecked=!1}),CAICUI.render.pushContext[n[1]].myChecked=t;break;case"checkbox":CAICUI.render.pushContext[n[1]].myChecked=t;break;case"matrixRadio":var i=s.attr("data-rowsarray").split(",");r.each(i,function(e,r){CAICUI.render.pushContext[0].items[e].myChecked=!1}),CAICUI.render.pushContext[0].items[n[1]].myChecked=t;break;case"matrixCheckbox":CAICUI.render.pushContext[0].items[n[1]].myChecked=t}},changeMultiTaskQuestionsDataClick:function(e,n,t,s){switch(e){case"radio":r.each(CAICUI.render.pushContext[n[0]].data,function(e,r){e.myChecked=!1}),CAICUI.render.pushContext[n[0]].data[n[1]].myChecked=t;break;case"checkbox":CAICUI.render.pushContext[n[0]].data[n[1]].myChecked=t;break;case"matrixRadio":var i=s.attr("data-rowsarray").split(",");r.each(i,function(e,r){CAICUI.render.pushContext[n[0]].data[0].items[e].myChecked=!1}),CAICUI.render.pushContext[n[0]].data[0].items[n[1]].myChecked=t;break;case"matrixCheckbox":CAICUI.render.pushContext[n[0]].data[0].items[n[1]].myChecked=t}},questionsOptionKeyup:function(e){e.preventDefault();var r=CAICUI.iGlobal.getThat(e),n=r.attr("data-number").split("-"),t=r.children().val();"multiTask"==CAICUI.render.questionsType?this.changeMultiTaskQuestionsDataKeyup(CAICUI.render.pushContext[n[0]].type,n,t,r):this.changeQuestionsDataKeyup(CAICUI.render.questionsType,n,t,r)},changeQuestionsDataKeyup:function(e,r,n,t){switch(e){case"blank":case"question":CAICUI.render.pushContext[r[1]].myBlank=n;break;case"matrixQuestion":case"matrixBlank":CAICUI.render.pushContext[0].items[r[1]].myBlank=n}},changeMultiTaskQuestionsDataKeyup:function(e,r,n,t){switch(e){case"blank":case"question":CAICUI.render.pushContext[r[0]].data[0].myBlank=n;break;case"matrixQuestion":CAICUI.render.pushContext[0].items[r[1]].myBlank=n;break;case"matrixBlank":CAICUI.render.pushContext[r[0]].data[0].items[r[1]].myBlank=n}},questionsStatus:function(e){if("multiTask"==CAICUI.render.questionsType){var n=0;r.each(CAICUI.render.pushContext,function(e,r){CAICUI.render.this.questionsStatusMultiTask(e.type,r)&&n++}),n==CAICUI.render.pushContext.length?CAICUI.render.status=1:CAICUI.render.status=2}else{var t=CAICUI.render.this.questionsStatusOther(CAICUI.render.questionsType);CAICUI.render.status=t?1:2}e&&e()},questionsStatusMultiTask:function(e,n){var t="",s=CAICUI.render.pushContext;if("matrixRadio"==e){t=!0;var i=0,a=0,d=0;r.each(s[n].data[0].items,function(e,r){e.isChecked&&(a++,e.myChecked&&d++)}),t=a==d,d&&(CAICUI.render.isMyChecked=!0)}else if("matrixCheckbox"==e){t=!0;i=0,a=0,d=0;r.each(s[n].data[0].items,function(e,r){e.isChecked&&e.myChecked&&i++,e.isChecked&&a++,e.myChecked&&d++}),t=d==a&&!(!a||!i||a!=i),d&&(CAICUI.render.isMyChecked=!0)}else if("radio"==e)t=!0,r.each(s[n].data,function(e,r){e.isChecked&&(t=!!e.myChecked),e.myChecked&&(CAICUI.render.isMyChecked=!0)});else if("checkbox"==e){t=!0;i=0,a=0,d=0;r.each(s[n].data,function(e,r){e.isChecked&&e.myChecked&&i++,e.isChecked&&a++,e.myChecked&&(d++,CAICUI.render.isMyChecked=!0)}),t=d==a&&!(!a||!i||a!=i)}else if("blank"==e){var o=(C=s[n].data[0]).blank;t=o==C.myBlank,C.myBlank&&(CAICUI.render.isMyChecked=!0)}else if("question"==e){var C=s[n].data[0];console.log(C);o=C.blank;t=!!C.myBlank,C.myBlank&&(CAICUI.render.isMyChecked=!0)}else"matrixBlank"==e&&(t=!0,r.each(s[n].data[0].items,function(e,r){var n=e.blank;n&&(t=n==e.myBlank),e.myBlank&&(CAICUI.render.isMyChecked=!0)}));return t},questionsStatusOther:function(e){var n="",t=CAICUI.render.pushContext;if("radio"==e)n=!0,r.each(t,function(e,r){e.isChecked&&(n=!!e.myChecked),e.myChecked&&(CAICUI.render.isMyChecked=!0)});else if("checkbox"==e){n=!0;var s=0,i=0,a=0;r.each(t,function(e,r){e.isChecked&&e.myChecked&&s++,e.isChecked&&i++,e.myChecked&&(a++,CAICUI.render.isMyChecked=!0)}),n=a==i&&!(!i||!s||i!=s)}else if("blank"==e){var d=t[0].blank;n=d==t[0].myBlank,t[0].myBlank&&(CAICUI.render.isMyChecked=!0)}else if("question"==e){d=t[0].blank;n=!!t[0].myBlank,t[0].myBlank&&(CAICUI.render.isMyChecked=!0)}else if("matrixRadio"==e){n=!0;s=0,i=0,a=0;r.each(t[0].items,function(e,r){e.isChecked&&(i++,e.myChecked&&a++)}),n=i==a,a&&(CAICUI.render.isMyChecked=!0)}else if("matrixCheckbox"==e){n=!0;s=0,i=0,a=0;r.each(t[0].items,function(e,r){e.isChecked&&e.myChecked&&s++,e.isChecked&&i++,e.myChecked&&a++}),n=a==i&&!(!i||!s||i!=s),a&&(CAICUI.render.isMyChecked=!0)}else"matrixBlank"==e&&(n=!0,r.each(t[0].items,function(e,r){var t=e.blank;t&&(n=t==e.myBlank),e.myBlank&&(CAICUI.render.isMyChecked=!0)}));return n},removeAnimate:function(r){e("#animate").animate({height:"0",top:"50%"},300,function(){e("#animate").remove(),r&&r()})},toggleCards:function(r){var n=CAICUI.iGlobal.getThat(r);CAICUI.render.cardOpen?(CAICUI.render.cardOpen=!1,n.removeClass("active"),e("body .questions-cards").removeClass("active"),n.find(".questions-card-span").text("展开答题卡")):(CAICUI.render.cardOpen=!0,n.addClass("active"),e("body .questions-cards").addClass("active"),n.find(".questions-card-span").text("收起答题卡"))},exit:function(){this.exitMsg(function(){CAICUI.render.this.$el.find(".questions").remove(),CAICUI.render.cardOpen=!1,CAICUI.render.ExerciseTotalTime=0,CAICUI.render.errorNum=0,CAICUI.render.exerciseCount=0,CAICUI.render.exerciseDoneCount=0,CAICUI.render.exerciseNoDoneCount=0,CAICUI.render.exerciseRightCount=0,CAICUI.render.examenNum=0,CAICUI.render.myExamContinue={},CAICUI.render.viewResolution=!1,CAICUI.render.this.removeAnimate();var e=CAICUI.iGlobal.getUrlPara("return_link");"on"==CAICUI.iGlobal.getUrlPara("return_hash")?window.location.hash=e:window.location.href=e})},exitMsg:function(e){clearInterval(CAICUI.render.timer),CAICUI.render.this.undelegateEvents(),t.msg("已记录您本章的练习进度",{time:1e3},function(){e&&e()})},clearInitData:function(){CAICUI.render.this.$el.find(".questions").remove(),clearInterval(CAICUI.render.timer),CAICUI.render.this.undelegateEvents(),CAICUI.render.cardOpen=!1,CAICUI.render.ExerciseTotalTime=0,CAICUI.render.errorNum=0,CAICUI.render.exerciseCount=0,CAICUI.render.exerciseDoneCount=0,CAICUI.render.exerciseNoDoneCount=0,CAICUI.render.exerciseRightCount=0,CAICUI.render.examenNum=0,CAICUI.render.myExamContinue={},CAICUI.render.viewResolution=!1},clockTime:function(){CAICUI.render.timer=null;var e=CAICUI.render.ExerciseTotalTime,r=this.$el.find(".questions-times");function n(e){var n=parseInt(e),t=Math.floor(n/86400),s=Math.floor((n-24*t*60*60)/3600),i=Math.floor((n-24*t*60*60-3600*s)/60),a=Math.floor(n-24*t*60*60-3600*s-60*i);return s<10&&(s="0"+s),i<10&&(i="0"+i),a<10&&(a="0"+a),r.text(s+":"+i+":"+a),n}n(e),CAICUI.render.timer=setInterval(function(){e++,CAICUI.render.ExerciseTotalTime=n(e)},1e3)},questionsLoaderContent:function(){var r=e("#template-questions-realImitate-loader-content").html(),n=CAICUI.iGlobal.getTemplate(r);e("body .questions-body #scroller").append(n)},getExerciseId:function(e){CAICUI.Request.ajax({server:"getExerciseBaseInfo",data:{examenId:CAICUI.render.knowledgepointid},done:function(r){CAICUI.render.exerciseBaseInfo=r.data,e&&e(r.data)}})},createIframe:function(){var r=e("<iframe>");"http://localhost:3000"==window.location.origin?e(r).attr("src",CAICUI.Common.host.demoName+"/upload/caicui_cache/exercise/"+CAICUI.render.exerciseFilename):e(r).attr("src",window.location.origin+"/upload/caicui_cache/exercise/"+CAICUI.render.exerciseFilename),e(r).attr("name","iframe_name"),e(r).attr("id","iframe_name"),e("body .questions").append(r)},getIframeData:function(r){var n=[];e("#iframe_name").load(function(){var t=e("body").find("#iframe_name").contents().find("body").html();n=t.split("<\/script>").length>1?e.trim(t.split("<\/script>").slice(2)[0].split(",")).split(","):e.trim(t).split(","),r&&r(n)})},optionRegExpTest:function(e){var r=!1;if(e){var n=e.slice(0,2),t=e.slice(2);"选项"==n&&(r=new RegExp("点击这里编辑").test(t))}return r},openSidebar:function(r){CAICUI.render.cardOpen&&e("body .questions-card-button").trigger("click"),e("body .questions-cards").removeClass("active");var n=CAICUI.iGlobal.getThat(r).attr("data-control"),t=(e(this).index(),e("body .studycenter-video-main-right .questions-type-"+n));"hidden"==t.attr("data-display")?(e("body .right-questions-item-count").text(+CAICUI.render.questionsIndex+1),"note"==n?this.showNode():"quiz"==n&&this.showQuestions(),e("body .studycenter-video-right").addClass("hidden"),t.removeClass("hidden"),e("body .studycenter-video-right").attr("data-display","hidden"),t.attr("data-display","show"),e("body .questions-body-context").css({"padding-right":410}),e("body .studycenter-video-main-right").css({right:0})):(e("body .questions-body-context").css({"padding-right":168}),e("body .studycenter-video-main-right").css({right:-410}),t.addClass("hidden"),t.attr("data-display","hidden"))},animateSidebar:function(r,n){e("body .questions-body-context").css({"padding-right":r}),e("body .studycenter-video-main-right").css({right:-(410-r)})},closeSidebar:function(){e("body .studycenter-video-right").siblings().addClass("hidden"),this.animateSidebar(0,500)},showQuestions:function(){e("#ac-new-video").attr("src","script/libs/xneditor/ac-new-video.html")},showNode:function(){e("body .node-editor-textarea").val(""),e("body .add-photo-show").remove()},nodeEditorIsOpenButton:function(e){var r=CAICUI.iGlobal.getThat(e),n=r.prev();r.hasClass("active")?(r.removeClass("active"),n.text("私有"),CAICUI.render.isPublic=1):(r.addClass("active"),n.text("公开"),CAICUI.render.isPublic=0)},uploadFormFile:function(){CAICUI.iGlobal.fileUpload({formClass:"uploadForm"},function(e){CAICUI.iGlobal.fileUploadAddList("uploadForm",e)})},nodeEditorConfirm:function(){var r=e("body #node-editor-textarea").val();if(!r)return t.msg("Sorry~ 请输入内容！",function(){}),!1;if(CAICUI.render.imgPath="",CAICUI.render.imgPathArray.length)for(var n=0;n<CAICUI.render.imgPathArray.length;n++)CAICUI.render.imgPath+=n?","+CAICUI.render.imgPathArray[n]:CAICUI.render.imgPathArray[n];else CAICUI.render.imgPath="";CAICUI.Request.ajax({server:"nodesave",data:{token:CAICUI.User.token,id:"",content:r,clientType:CAICUI.render.clientType,title:CAICUI.render.chapterName,isPublic:CAICUI.render.isPublic,courseId:CAICUI.render.courseId,subjectId:CAICUI.render.subjectId,categoryId:CAICUI.render.categoryId,chapterId:CAICUI.render.chapterId,subjectName:CAICUI.render.subjectName,categoryName:CAICUI.render.categoryName,courseName:CAICUI.render.courseName,chapterName:CAICUI.render.chapterName,taskId:CAICUI.render.exerciseId,taskName:CAICUI.render.exerciseId,taskProgress:+CAICUI.render.questionsIndex+1+"题",imgPath:CAICUI.render.imgPath,clientType:"pc"},done:function(r){"success"==r.state&&t.msg("保存成功！",{shade:!0,icon:1,time:500},function(){CAICUI.render.this.closeSidebar(),e("body .right-title-input").val("")})},fail:function(e){t.msg("Sorry~ 笔记保存失败",function(){})}})},addPhotoRemove:function(r){for(var n=CAICUI.iGlobal.getThat(r),t=(n.prev(),n.attr("data-src")),s=0;s<CAICUI.render.imgPathArray.length;s++)if(CAICUI.render.imgPathArray[s]==t){CAICUI.render.imgPathArray.splice(s,1);break}n.parent().remove(),e("body .add-photo-show").length<5&&e("body #uploadForm").show()},viewOther:function(e){var r=CAICUI.iGlobal.getThat(e).attr("link");this.exitMsg(function(){window.location.hash=r})}})});