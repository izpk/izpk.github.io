define(["jquery","underscore","backbone","storage","views/questions","views/classCourse-courseDetail","views/classCourseTree","views/activationCourse","views/d3-stack","layer"],function(e,r,t,a,s,n,o,i,c,I){"use strict";return t.View.extend({el:"body #right",template:r.template(e("#template-class-course-courseStudy").html()),events:{"click .js-course-list-link":"openVideo","click .js-course-questions":"openQuestions","click .course-list-title-a":"courseNavToggle","click .js-course-study-change":"courseChange","click .option-a":"optionCourse","click .courseVersion-list-a":"courseVersionListA","click .courseVersion-show-btn":"courseVersionListShow","click .js-handout-down":"handoutDown","click .courseUpdate-close":"courseUpdateClose","click .courseUpdate-submit":"courseUpdateAjax","click .js-apply-editor-learningPlan":"applyEditorLearningPlan"},render:function(r){if(CAICUI.render.$this=this,CAICUI.render.thisCourseIndex=this,this.courseNavPreDefault=0,this.courseNavPre=0,this.courseNavAnimateTime=300,CAICUI.render.subjectId="",CAICUI.render.subjectName="",CAICUI.render.categoryId="",CAICUI.render.categoryName="",CAICUI.render.courseId=r,CAICUI.render.courseName="",CAICUI.render.chapterId="",CAICUI.render.chapterName="",CAICUI.render.isCoursePay=!1,CAICUI.render.questions=s,CAICUI.render.getTasksProgress="",CAICUI.render.handout="",CAICUI.render.course_info="",CAICUI.render.courseInfoExamTime="",CAICUI.render.courseInfoDueTime="",CAICUI.render.versionId="",CAICUI.render.courseInfo="",CAICUI.render.courseVersion="",CAICUI.render.courseActiveTime="",CAICUI.render.courseExpirationTime="",CAICUI.render.lastLearnChapter="",CAICUI.render.lastLearnChapterName="",CAICUI.render.lastLearnChapterLink="",CAICUI.render.percentage=0,CAICUI.render.lockStatus=!1,CAICUI.render.chaptersIdArray=[],CAICUI.render.handoutDown="",CAICUI.render.exerciseKnowledgeMemberStatus={},CAICUI.render.knowledgepointid="",CAICUI.render.lastExerciseNid=0,CAICUI.render.ExerciseProgress=0,CAICUI.render.ExerciseTotalTime=0,CAICUI.render.cacheKnowledgeLevel1Id="",CAICUI.render.cacheKnowledgeLevel2Id="",CAICUI.render.cacheKnowledgePath="",CAICUI.render.errorNum=0,CAICUI.render.exerciseFilename="",CAICUI.render.questionsIndex=0,CAICUI.render.exerciseCount=0,CAICUI.render.weekMaxBeoverdue=2,CAICUI.render.taskReturn){if(CAICUI.render.openCourse="",CAICUI.render.openCourseVideo=!1,CAICUI.render.myExamContinue={},CAICUI.render.viewResolution=!1,I.close(videoController.payInfoDialog),0==videoController.playerType);else if(2==videoController.playerType)WINAPI.SetPlayerHide(1),WINAPI.SetPlayerPause();else if(3==videoController.playerType){cc_winplayer.SetIframePlayerHide(1);cc_winplayer.sendMessageToIframe(JSON.stringify({type:101}))}e("#studycenter-video").remove(),videoController.removeAnimate(),CAICUI.render.action="closetask",videoController.saveProgress(),clearInterval(videoController.slideIntervalstop),clearInterval(videoController.saveVideoProgressSetinterval)}CAICUI.isNoneRender||(CAICUI.render.courseDetailRenderData=[],CAICUI.render.courseDetailRenderData.courseId=r,CAICUI.render.$this.$el.html(CAICUI.render.$this.template({data:{courseId:CAICUI.render.courseId}})),CAICUI.iGlobal.getTemplateCourseNav("body .courseIndex-header-right",{courseType:"classCourse",type:"study",courseId:CAICUI.render.courseId})),CAICUI.render.$this.classRender(function(r){r.classCourseList.studyIn.forEach(function(r,t){r.classCourse.forEach(function(t,a){if(t.courseId==CAICUI.render.courseId){var s=e("#template-class-course-nav").html(),n=CAICUI.iGlobal.getTemplate(s,{classId:r.classId,courseId:t.courseId,classCourseNav:r.classCourse});e("body .teachingPlan-course-nav").html(n)}})})}),CAICUI.render.$this.classCourseRender(function(r){e("body .course-change").attr("title",r.courseInfo.courseName),e("body .course-name").html(r.courseInfo.courseName),e("body .lastLearn").attr("href","javascript:;"),e("body .continue-learning").attr("href","javascript:;"),e("body .lastLearn").html(r.lastLearn.title),e("body .course-info-examTime").html(r.courseStatus.examinationDate),e("body .course-info-dueTime").html(r.courseStatus.courseExpirationTime),e("body .teachingPlan-span").each(function(t){e(this).text(r.courseStatus.countDownArray[t])}),e("body .task-number").html(r.tasksSummary.completed+"/"+r.tasksSummary.total),e("body .task-current-progress").css("width",r.studyInfo.studyProgressTotal),CAICUI.render.classCourseTreeRender=new o,e("body #scroller-courseStudy-list").html(CAICUI.render.classCourseTreeRender.render(r.planInfo).el)})},classRender:function(e){CAICUI.Request.ajax({server:"node-classCourseList",data:{token:CAICUI.nodeToken},done:function(r){e&&e(r)}})},classCourseRender:function(e){CAICUI.Request.ajax({server:"node-classCourseDetail",data:{token:CAICUI.nodeToken,memberId:CAICUI.nodeMemberId,courseId:CAICUI.render.courseId},done:function(r){e&&e(r)}})},refreshHtml:function(){},courseDetailRender:function(){CAICUI.render.courseDetailRender=new n,e("body #scroller-courseStudy-list").html(CAICUI.render.courseDetailRender.render(CAICUI.render.courseDetailRenderData).el),setTimeout(function(){window.CAICUI.myScrollCourseStudyList?window.CAICUI.myScrollCourseStudyList.refresh():window.CAICUI.myScrollCourseStudyList=CAICUI.iGlobal.iScroll("body #wrapper-courseStudy-list")},30),CAICUI.render.courseDetailData&&(CAICUI.render.courseDetailData.isPlan&&r.each(CAICUI.render.courseDetailData.courseDetailWeekList,function(e,r){e.weekIsFinish&&e.isFinish||CAICUI.render.$this.updateplanAjax(e)}),CAICUI.render.courseDetailData.coursePercentage&&e("body .task-current-progress").animate({width:"40%"},1e3),e("body .task-number").html(CAICUI.render.courseDetailData.courseTaskTotalCompleted+"/"+CAICUI.render.courseDetailData.courseTaskTotal))},changeTasksProgress:function(t){var a=[];r.each(t,function(e,r){e.chapterId==CAICUI.render.openChapterId&&a.push(e)}),r.each(a,function(r,t){var a="#video/"+r.courseId+"/"+r.chapterId+"/"+r.taskId;r.progress&&(a+="/"+r.progress);var s=0;(s=r.state&&1==r.state?100:CAICUI.iGlobal.getPercentage(r.progress,r.total))?100==s?(e("body #courseDetail-weekList-taskA-"+r.taskId).attr("class","js-toTask courseDetail-weekList-taskA task-completed"),e("body .tasks-info-progress").html(CAICUI.render.courseDetailData.coursePercentage),e("body .tasks-info-doneNum").html(CAICUI.render.courseDetailData.courseTaskTotalCompleted)):e("body #courseDetail-weekList-taskA-"+r.taskId).attr("class","js-toTask courseDetail-weekList-taskA task-ongoing"):e("body #courseDetail-weekList-taskA-"+r.taskId).attr("class","js-toTask courseDetail-weekList-taskA task-notstarted"),a+="?return_link=courseStudy/"+r.courseId+"&return_hash=on",e("body #courseDetail-weekList-taskA-"+r.taskId).attr("link",a),e("body #task-progressBar-width-"+r.taskId).css("width",s+"%"),e("body #task-progress-number-"+r.taskId).html(s+"%")})},updateplanAjax:function(e,r){e.weekTaskBeoverdue,e.weekTaskCompleted,e.weekTaskNotstarted,e.weekTaskOngoing;CAICUI.Request.ajax({server:"updateplan",data:{token:CAICUI.User.token,id:e.planId,taskTime:e.weekTaskTime,taskSum:e.tasksNum,learnTime:e.weekStudyTime,learnSum:e.weekTaskCompleted,ingSum:e.weekTaskOngoing,isFinish:e.weekIsFinish},done:function(e){r&&r()},fail:function(e){}})},getMaxOverplanAjax:function(e){CAICUI.Request.ajax({server:"getMaxOverplan",data:{token:CAICUI.User.token,courseCategoryId:CAICUI.render.subjectId},done:function(r){e&&e()},fail:function(e){}})},courseUpdate:function(){CAICUI.render.$this.searchCourseAlterationsByVersionId()},searchCourseAlterationsByVersionId:function(e,r){CAICUI.Request.ajax({server:"searchCourseAlterationsByVersionId",data:{versionId:CAICUI.render.versionId},done:function(e){if(e.data&&e.data.length){var r=CAICUI.render.$this.formatCourseUpdate(e.data);r&&CAICUI.render.$this.createcourseUpdate(r)}},fail:function(e){}})},createcourseUpdate:function(r){var t=.618*e(window).width(),a=605.64;t<a?t=a:t>988.8&&(t=988.8),CAICUI.render.courseUpdate=I.open({type:1,title:!1,shade:!0,scrollbar:!1,area:[t+"px","auto"],closeBtn:0,content:e("#courseUpdate"),success:function(){e("body #courseUpdate .courseUpdate-content").html(r)}})},formatCourseUpdate:function(e){var r="",t=0;CAICUI.render.courseProgress&&CAICUI.render.courseProgress.createDate?t=parseInt(CAICUI.render.courseProgress.createDate):CAICUI.render.courseActiveTime&&(t=CAICUI.render.courseActiveTime);for(var a=0;a<e.length;a++)t<e[a].createDate&&(r+=e[a].message,r+='<p class="courseUpdate-time">变更时间 '+CAICUI.iGlobal.getDate(e[a].createDate)+"</p>");return r},courseUpdateClose:function(){I.close(CAICUI.render.courseUpdate)},courseUpdateAjax:function(e){I.close(CAICUI.render.courseUpdate)},handoutDown:function(e){CAICUI.iGlobal.getThat(e);var r=document.getElementById("handoutDown");CAICUI.render.handoutDown?r.click():CAICUI.render.$this.handoutAjax(function(){CAICUI.render.handout&&CAICUI.render.handout[0]&&CAICUI.render.handout[0].handoutFilePath?(r.setAttribute("download","true"),r.setAttribute("href",CAICUI.Common.host.img+CAICUI.render.handout[0].handoutFilePath),CAICUI.render.handoutDown=CAICUI.Common.host.img+CAICUI.render.handout[0].handoutFilePath,r.click()):I.msg("Sorry~暂无讲义",{time:2e3},function(){})})},actionGetCourseProgress:function(e){CAICUI.Request.ajax({server:"actionGetCourseProgress",data:{token:CAICUI.User.token,memberId:CAICUI.User.memberId,courseId:CAICUI.render.courseId},done:function(r){CAICUI.render.courseProgress=r.data[0],r.data[0]&&(CAICUI.render.percentage=r.data[0].courseProgress),e&&e()}})},courseChange:function(r){var t=CAICUI.iGlobal.getThat(r),a=t.attr("data-click");if(t.hasClass("active"))t.removeClass("active"),e("body .option-ul").removeClass("active");else if(CAICUI.render.learningcourseData&&CAICUI.render.learningcourseData.length){var s=e("#template-class-courseStudy-courseList").html(),n=CAICUI.iGlobal.getTemplate(s,{courseNameArray:CAICUI.render.courseNameArray});e("body .course-change-ul").html(n),t.addClass("active"),e("body .option-ul").addClass("active")}else"true"!=a&&(t.attr("data-click","true"),CAICUI.render.$this.learningcourseAjax(function(){var r=e("#template-class-courseStudy-courseList").html(),a=CAICUI.iGlobal.getTemplate(r,{courseNameArray:CAICUI.render.courseNameArray});e("body .course-change-ul").html(a),t.addClass("active"),e("body .option-ul").addClass("active")}))},learningcourseAjax:function(e){CAICUI.Request.ajax({server:"learningcourse",data:{token:CAICUI.User.token,pageNo:0,pageSize:CAICUI.defaultPageSize},done:function(r){if(!r.data.courselist||!r.data.courselist.length)return!1;CAICUI.render.learningcourseData=r.data.courselist;var t=r.data.courselist;CAICUI.render.courseNameArray=[];for(var a=0;a<t.length;a++){var s=!0;if(CAICUI.render.courseNameArray&&CAICUI.render.courseNameArray.length)for(var n=0;n<CAICUI.render.courseNameArray.length;n++)CAICUI.render.courseNameArray[n].courseId==t[a].courseId&&(s=!1);s&&CAICUI.render.courseNameArray.push({courseId:t[a].courseId,courseName:t[a].courseName})}e&&e()},fail:function(){CAICUI.render.learningcourseData={},CAICUI.CACHE.RecentCourse={}}})},courseDetailAjax:function(e){CAICUI.Request.ajax({server:"courseDetail",data:{courseId:CAICUI.render.courseId},done:function(r){var t=r.data[0];CAICUI.render.courseDetailRenderData.chapters=t.chapters,CAICUI.CACHE.courseDetail=t,CAICUI.render.courseDetail=t,CAICUI.render.knowledgePointIdTotal=CAICUI.render.courseDetail.knowledgePointId,CAICUI.render.$this.courseDetailDone&&CAICUI.render.$this.courseDetailDone(CAICUI.render.courseDetail,e)}})},courseDetailDone:function(e,r){CAICUI.render.versionId=e.versionId,CAICUI.render.subjectId=e.subjectId,CAICUI.render.subjectName=e.subjectName,CAICUI.render.categoryId=e.categoryId,CAICUI.render.categoryName=e.categoryName,CAICUI.render.courseId=e.courseId,CAICUI.render.courseName=e.courseName,CAICUI.render.chapterId=e.chapterId,CAICUI.render.chapterName=e.chapterName,r&&r()},memberGetplanAjax:function(e){CAICUI.Request.ajax({server:"memberGetplan",data:{token:CAICUI.User.token,courseCategoryId:CAICUI.render.courseDetail.subjectId,courseId:CAICUI.render.courseId},done:function(r){e&&e(r.data)},fail:function(r){e&&e(r.data)}})},getChaptersIdArray:function(e){e.chapterNum;r.each(e.chapters,function(e,t){CAICUI.render.chaptersIdArray.push(e.chapterId),e.children&&e.children.length&&r.each(e.children,function(e,t){CAICUI.render.chaptersIdArray.push(e.chapterId),e.children&&e.children.length&&r.each(e.children,function(e,r){CAICUI.render.chaptersIdArray.push(e.chapterId)})})}),CAICUI.render.chaptersIdArray=CAICUI.render.chaptersIdArray.toString()},exercisePointCountCacheAjax:function(e){CAICUI.Request.ajax({server:"exercisePointCountCache",data:{knowledge_points:CAICUI.render.knowledgePointIdTotal,type:6},done:function(r){e&&e(r.data)}})},exerciseKnowledgeMemberStatusAjax:function(e){CAICUI.Request.ajax({server:"exerciseKnowledgeMemberStatus",data:{knowledge_points:CAICUI.render.knowledgePointIdTotal,type:4,member_id:CAICUI.User.memberId},done:function(r){e&&e(r.data)}})},courseActiveStateAjax:function(e){CAICUI.Request.ajax({server:"coursestatus",data:{token:CAICUI.User.token,versionId:CAICUI.render.versionId},done:function(r){if(r.data){for(var t=0,a=0;a<r.data.length;a++)0===r.data[a].lockStatus&&t++;t||(CAICUI.render.lockStatus=!0)}CAICUI.render.coursestatus=r.data,CAICUI.render.$this.courseByInFo(r.data),e&&e()},fail:function(e){I.msg("Sorry~ 获取课程授权信息失败，请刷新页面重试。",function(){})}})},courseVersionDataAjax:function(e){CAICUI.Request.ajax({server:"version",data:{versionId:CAICUI.render.versionId},done:function(r){if(!r.data||!r.data.length)return!1;CAICUI.render.courseVersion=r.data,e&&e()},fail:function(e){I.msg("Sorry~ 网络错误，请刷新页面重试。",function(){})}})},getTasksProgressAjax:function(e){CAICUI.Request.ajax({server:"actionGetTasksProgress",data:{token:CAICUI.User.token,memberId:CAICUI.User.memberId,courseId:CAICUI.render.courseId},done:function(t){t.data;if(CAICUI.render.courseDetailRenderData.taskProgress=t.data,CAICUI.CACHE.getTasksProgress=t.data,CAICUI.render.getTasksProgress=t.data,CAICUI.render.getTasksProgress&&CAICUI.render.getTasksProgress.length){CAICUI.render.lastLearnChapter=r.max(CAICUI.render.getTasksProgress,function(e){return e.createDate});var a="",s="";CAICUI.render.lastLearnChapter&&!CAICUI.render.lastLearnChapterName?(a="#video/"+CAICUI.render.courseId+"/"+CAICUI.render.lastLearnChapter.chapterId+"/"+CAICUI.render.lastLearnChapter.taskId+"/"+CAICUI.render.lastLearnChapter.progress+"?return_link=courseStudy/"+CAICUI.render.courseId+"&return_hash=on",s='上次学到：<span class="lastLearn-chapterName">'+CAICUI.render.lastLearnChapter.chapterName+' </span><i class="icon icon-course-arrow-right"></i>'):(a=CAICUI.render.lastLearnChapterLink?t.lastLearnChapterLink:CAICUI.render.courseDetail.chapters[0].children?"#video/"+CAICUI.render.courseId+"/"+CAICUI.render.courseDetail.chapters[0].children[0].chapterId+"?return_link=courseStudy/"+CAICUI.render.courseId+"&return_hash=on":"#video/"+CAICUI.render.courseId+"/"+CAICUI.render.courseDetail.chapters[0].chapterId+"?return_link=courseStudy/"+CAICUI.render.courseId+"&return_hash=on",s=CAICUI.render.lastLearnChapterName?'上次学到：<span class="lastLearn-chapterName">'+CAICUI.render.lastLearnChapterName+' </span><i class="icon icon-course-arrow-right"></i>':'<i class="icon icon-course-arrow-right"></i><span class="lastLearn-chapterName">开始学习本课程</span>'),CAICUI.render.lastLearnChapterLink=a,CAICUI.render.lastLearnChapterName=s}e&&e(t.data)},fail:function(){CAICUI.CACHE.getTasksProgress={},CAICUI.render.getTasksProgress={}}})},courseInfoAjax:function(e){CAICUI.Request.ajax({server:"getExamDate",data:{memberId:CAICUI.User.memberId},done:function(r){var t=-1;if(r.data&&r.data.length)for(var a=0;a<r.data.length;a++)CAICUI.render.subjectId,r.data[a].courseCategoryId,CAICUI.render.courseId==r.data[a].id&&(r=r.data[a],t=parseInt(((new Date).getTime()-r.examinationDate)/864e5));CAICUI.CACHE.course_info=r.data,CAICUI.render.course_info=r.data,CAICUI.render.courseInfoExamTime=t<0?"本科目考试时间未确定":0===t?"请留意,本科目<strong>今天</strong>开始考试":"距本科目考试还有<strong>"+t+"</strong>天",e&&e()},fail:function(e){CAICUI.CACHE.course_info={},CAICUI.render.course_info={}}})},handoutAjax:function(e){CAICUI.Request.ajax({server:"handout",data:{idType:0,courseId:CAICUI.render.courseId},done:function(r){CAICUI.CACHE.handout=r.data,CAICUI.render.handout=r.data,e&&e()},fail:function(e){CAICUI.CACHE.handout={},CAICUI.render.handout={}}})},setTasksProgress:function(e){CAICUI.render.getTasksProgress;r.each(e.chapters,function(t,a){t.children&&t.children.length?r.each(t.children,function(t,s){t.children&&t.children.length?r.each(t.children,function(t,n){t.tasks&&t.tasks.length&&r.each(t.tasks,function(t,o){r.each(CAICUI.CACHE.getTasksProgress,function(r,i){t.taskId==r.taskId&&(e.chapters[a].children[s].children[n].tasks[o].progress=r.progress,e.chapters[a].children[s].children[n].tasks[o].total=r.total,e.chapters[a].children[s].children[n].tasks[o].state=r.state)})})}):t.tasks&&t.tasks.length&&r.each(t.tasks,function(t,n){r.each(CAICUI.CACHE.getTasksProgress,function(r,o){t.taskId==r.taskId&&(e.chapters[a].children[s].tasks[n].progress=r.progress,e.chapters[a].children[s].tasks[n].total=r.total,e.chapters[a].children[s].tasks[n].state=r.state)})})}):t.tasks&&t.tasks.length&&r.each(t.tasks,function(t,s){r.each(CAICUI.CACHE.getTasksProgress,function(r,n){t.taskId==r.taskId&&(e.chapters[a].tasks[s].progress=r.progress,e.chapters[a].tasks[s].total=r.total,e.chapters[a].tasks[s].state=r.state)})})}),CAICUI.render.courseDetail=e,a.setsingle("courseProgress-"+CAICUI.render.courseId,e)},updateTasksProgress:function(){CAICUI.render.courseDetail;var t=[];r.each(CAICUI.render.getTasksProgress,function(e,r){e.chapterId==CAICUI.render.openChapterId&&t.push(e)});var a="no",s=0,n=0,o="icon-course-list-default";if(t)if(o="icon-course-list-learning",t.length==CAICUI.render.openTasksNum){switch(r.each(t,function(e,r){"1"==e.state?s++:"0"==e.state&&n++}),s==CAICUI.render.openTasksNum?a="end":(n||s)&&(a="ing"),a){case"no":o="icon-course-list-default";break;case"ing":o="icon-course-list-learning";break;case"end":o="icon-course-list-completed"}e("body #icon-progress-"+CAICUI.render.openChapterId).attr("class","icon icon-left "+o)}else e("body #icon-progress-"+CAICUI.render.openChapterId).attr("class","icon icon-left "+o);else e("body #icon-progress-"+CAICUI.render.openChapterId).attr("class","icon icon-left "+o)},courseByInFo:function(r){var t=0;if(e.isArray(r)){for(var a=r.length,s=0;s<a;s++)"false"==r[s].isExpiration&&"acitve"==r[s].activeState&&(CAICUI.render.courseActiveTime=1e3*r[s].activeTime,CAICUI.render.courseExpirationTime=r[s].expirationTime);for(var n=Date.parse(new Date)/1e3,o=0;o<a;o++){if("acitve"==r[o].activeState&&r[o].expirationTime>n&&t<3){t=3;break}"init"==r[o].activeState&&t<2?t=2:"acitve"==r[o].activeState&&r[o].expirationTime<n&&t<1&&(t=1)}}t&&CAICUI.render.lockStatus&&(t=4),CAICUI.render.courseDetailRenderData.courseActiveState=t,CAICUI.render.courseDetail.courseActiveState=t},openVideo:function(r){var t=CAICUI.render.courseDetail.courseActiveState,s=CAICUI.iGlobal.getThat(r),n=s.attr("link"),o=s.attr("data-chapterid"),i=s.attr("data-taskslength");"javascript:;"!==n?(CAICUI.render.openChapterId=o,CAICUI.render.openTasksNum=i,CAICUI.render.formCourseStudy=!0,CAICUI.NavVideo=!1,e("body .course-desc").attr("href",n),CAICUI.render.lastLearnChapterName=s.find(".course-list-desc").text(),CAICUI.render.lastLearnChapterLink=n,a.setsingle("playlist-index"+CAICUI.render.courseId,"c|"+s.attr("data-index")),window.location.hash=n):4==t?I.msg("Sorry~ 您当前的课程已锁定",function(){}):2==t?I.msg("Sorry~ 您当前的课程未激活",function(){}):1==t?I.msg("Sorry~ 您当前的课程已过期",function(){}):0===t&&I.msg("Sorry~ 您未购买当前的课程",function(){})},openQuestions:function(e){e.stopPropagation();var r=CAICUI.iGlobal.getThat(e);CAICUI.render.chapterId=r.attr("data-chapterId"),CAICUI.render.chapterName=r.attr("data-chapterName"),CAICUI.render.knowledgepointid=r.attr("data-knowledgepointid"),CAICUI.render.cacheKnowledgeLevel1Id=r.attr("data-cache-knowledge-level1-id"),CAICUI.render.cacheKnowledgeLevel2Id=r.attr("data-cache-knowledge-level2-id"),CAICUI.render.cacheKnowledgePath=r.attr("data-cache-knowledge-path"),CAICUI.render.exerciseFilename=r.attr("data-exercise-filename"),CAICUI.render.errorNum=+r.attr("data-errornum")||0,CAICUI.render.lastExerciseNid=+r.attr("data-last-exercise-nid")||0,CAICUI.render.ExerciseProgress=+r.attr("data-exercise-progress")||0,CAICUI.render.ExerciseTotalTime=+r.attr("data-exercise-total-time")||0,CAICUI.render.exerciseCount=+r.attr("data-exercise-count"),this.addAnimate(function(){(new s).render()})},addAnimate:function(r){var t=e(window).width(),a=e(window).height();e("body").prepend('<div id="animate" style="width:'+t+'px;"></div>'),e("#animate").animate({height:a,top:"0"},300,function(){r&&r()})},addRecentCourse:function(e){if(CAICUI.render.learningcourseData&&CAICUI.CACHE.RecentCourse)for(var r=0;r<CAICUI.render.learningcourseData.length;r++)if(CAICUI.render.learningcourseData[r].courseId==e){for(var t=!0,a=0;a<CAICUI.CACHE.RecentCourse.length;a++)CAICUI.CACHE.RecentCourse[a].courseId==e&&(t=!1);return t&&CAICUI.CACHE.RecentCourse.push(CAICUI.render.learningcourseData[r]),void(CAICUI.CACHE.RecentCourse.length>2&&CAICUI.CACHE.RecentCourse.splice(0,1))}},filterLearningcourse:function(e){for(var t=r.chain(e).map(function(e){return e.categoryName}).uniq().value(),a=r.chain(e).map(function(e){return e.categoryIndex}).uniq().value(),s=[],n=0;n<t.length;n++)s.push({categoryName:t[n],categoryIndex:a[n],list:[]}),r.each(e,function(e,r,a){e.categoryName==t[n]&&(s&&s[n]&&s[n].list?s[n].list.push(e):s[n].list=[e])});for(n=0;n<s.length;n++){s[n].newList=[];for(var o=s[n].list,i=r.chain(o).map(function(e){return e.subjectName}).uniq().value(),c=r.chain(o).map(function(e){return e.subjectIndex}).uniq().value(),I=0;I<i.length;I++)s[n].newList.push({subjectName:i[I],subjectIndex:c[I],list:[]}),r.each(s[n].list,function(e,t,a){if(e.subjectName==i[I])if(s[n].newList[I].list){var o=!0;r.each(s[n].newList[I].list,function(r,t,a){e.courseId==r.courseId&&(o=!1)}),o&&s[n].newList[I].list.push(e)}else s[n].newList[I].list=[e]})}s=r.sortBy(s,"categoryIndex");return r.each(s,function(e,t){s[t].newList=r.sortBy(e.newList,"subjectIndex"),r.each(s[t].newList,function(e,a){s[t].newList[a].list=r.sortBy(e.list,"courseIndex")})}),s},courseVersionListShow:function(r){var t=CAICUI.iGlobal.getThat(r),a=e(".courseVersion-list"),s=t.attr("data-click");if(a.hasClass("active"))a.removeClass("active");else if(CAICUI.render.versionId)if(CAICUI.render.courseVersion&&CAICUI.render.courseVersion.length){var n=e("#template-class-courseStudy-courseVersionList").html(),o=CAICUI.iGlobal.getTemplate(n,{courseVersion:CAICUI.render.courseVersion,courseActiveTime:CAICUI.render.courseActiveTime,categoryName:CAICUI.render.courseDetail.categoryName});e("body .courseVersion-list").html(o),a.addClass("active")}else"true"!=s&&(t.attr("data-click","true"),CAICUI.render.$this.courseVersionDataAjax(function(){var r=e("#template-class-courseStudy-courseVersionList").html(),t=CAICUI.iGlobal.getTemplate(r,{courseVersion:CAICUI.render.courseVersion,courseActiveTime:CAICUI.render.courseActiveTime,categoryName:CAICUI.render.courseDetail.categoryName});e("body .courseVersion-list").html(t),a.addClass("active")}))},courseVersionListA:function(r){var t=CAICUI.iGlobal.getThat(r);t.hasClass("active")||(t.siblings().removeClass("active"),t.addClass("active"));e(".courseVersion-list").removeClass("active")},optionCourse:function(e){CAICUI.iGlobal.getThat(e);CAICUI.render.lastLearnChapterName="",CAICUI.render.lastLearnChapterLink=""},courseNavToggle:function(r){var t=r.currentTarget,a=e(t),s=a.parent();CAICUI.render.courseId=a.attr("data-courseid"),s.toggleClass("active"),window.CAICUI.myScrollCourseStudyList.refresh()},courseNavUlLeave:function(e){CAICUI.iGlobal.getThat(e);this.courseNavPreAnimate(this.courseNavPre),this.courseNavPre=this.courseNavPreDefault,CAICUI.render.$this.$(".courseIndex-li").eq(this.courseNavPre).addClass("hover"),this.courseNavAnimate(this.$(".courseIndex-active-box").eq(this.courseNavPre),this.courseNavPre),CAICUI.render.$this.$(".courseIndex-ul").removeClass("hover")},courseNavLiLeave:function(e){},courseNavLiEnter:function(e){var r=CAICUI.iGlobal.getThat(e),t=r.index(),a=r.find(".courseIndex-active-box");if(t==this.courseNavPre)return!1;r.addClass("hover"),this.courseNavPreAnimate(this.courseNavPre),this.courseNavAnimate(a,t),this.courseNavPre=t},courseNavPreAnimate:function(e){var r=this.$(".courseIndex-li").eq(e),t=!1;CAICUI.render.$this.$(".courseIndex-ul").hasClass("hover")||(t=!0),this.$(".courseIndex-active-box").eq(e).stop(!0,!1).animate({width:34,marginLeft:0},this.courseNavAnimateTime,function(){r.removeClass("hover"),t&&(CAICUI.render.$this.$(".courseIndex-ul").addClass("hover"),t=!1)})},courseNavAnimate:function(e,r){e.stop(!0,!1).animate({width:"148px"},this.courseNavAnimateTime)},openCourseBaseInfo:function(){var r=e("#template-class-course-baseInfo").html(),t=CAICUI.iGlobal.getTemplate(r);e("body #layout").append(t),e("body .courseIndex-baseInfo-btn").addClass("hidden"),e("body .course-baseInfo-closeBtn").on("click",function(){e("body .course-baseInfo").remove(),e("body .courseIndex-baseInfo-btn").removeClass("hidden")}),CAICUI.render.activationCourse=new i,e("body .course-baseInfo-content").append(CAICUI.render.activationCourse.render({coursesBaseInfo:CAICUI.render.courseDetail,isActivationCourse:!1,isPlan:CAICUI.render.courseDetailRenderData.weekList}).el),e("body .course-activation-acca-content").find("img").each(function(r){var t=e(this).attr("src"),a=t.substr(-3);"jpg"!=a&&"png"!=a&&"gif"!=a&&"svg"!=a||(t=window.static+t),e(this).attr("src",t)}),setTimeout(function(){window.CAICUI.myScrollCourseModel=CAICUI.iGlobal.iScroll("body #wrapper-courseModel")},50),window.CAICUI.myScrollActivationAcca=CAICUI.iGlobal.iScroll("body #wrapper-activation-acca")},applyEditorLearningPlan:function(){var r=e("#template-class-apply-editor-learningPlan").html(),t=CAICUI.iGlobal.getTemplate(r);e("body #right").append(t),CAICUI.render.applyEditorLearningPlanCheckbox=!0,e("body .apply-editor-learningPlan-checkbox").on("click",function(){var r=e(this);r.hasClass("active")?(r.removeClass("active"),CAICUI.render.applyEditorLearningPlanCheckbox=!1):(r.addClass("active"),CAICUI.render.applyEditorLearningPlanCheckbox=!0)}),e("body .apply-editor-learningPlan-cancel").on("click",function(){I.close(CAICUI.render.applyEditorLearningPlan),e("body .apply-editor-learningPlan").remove()}),e("body .apply-editor-learningPlan-confirm").on("click",function(){I.close(CAICUI.render.applyEditorLearningPlan),e("body .apply-editor-learningPlan").remove(),CAICUI.Request.ajax({server:"saveExtension",data:{token:CAICUI.User.token,courseCategoryId:CAICUI.render.courseDetail.subjectId,courseId:CAICUI.render.courseId},done:function(e){I.msg("申请成功~",{icon:1})},fail:function(e){I.msg("Sorry~申请失败")}})}),CAICUI.render.applyEditorLearningPlan=I.open({type:1,title:!1,shade:!0,scrollbar:!1,closeBtn:0,skin:"layui-skin layui-apply-editor-learningPlan",area:["425px","250px"],content:e("#apply-editor-learningPlan"),success:function(){}})}})});