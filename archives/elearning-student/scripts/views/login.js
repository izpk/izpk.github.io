define(["jquery","underscore","backbone","layer"],function(e,n,t,a){"use strict";return t.View.extend({el:"body",template:n.template(e("#template-login").html()),events:{"click #login":"loginClick"},render:function(n){e("body #layout").append(this.template()),CAICUI.render.$this=this,CAICUI.render.$prePage=n},loginClick:function(e){CAICUI.iGlobal.getThat(e);this.login()},getToken:function(e){CAICUI.Request.ajax({server:"token",done:function(n){e(n)},fail:function(e){console.log(e)}})},login:function(){var n=e("body #name").val(),t=e("body #password").val();n?t?CAICUI.Request.ajax({server:"node-login",data:{type:"pcWeb",username:n,password:t},done:function(n){window.localStorage.clear();var t='{"login_time":"'+(new Date).getTime()+'","memberId":"'+n.data.memberId+'","nickname":"'+n.data.nickName+'","nickName":"'+n.data.nickName+'","token":"'+n.data.token+'","avatar":"'+n.data.avatar+'"}';e.cookie("User",t,{path:"/",expires:36500}),e.cookie("loginInfo",t,{path:"/",expires:36500}),CAICUI.CACHE={},CAICUI.render.$this.undelegateEvents(),window.CAICUI.User=JSON.parse(t),window.location.reload()},fail:function(e){a.msg("Sorry~ 登录失败",function(){})}}):a.msg("Sorry~ 请输入密码",{time:1500},function(){}):a.msg("Sorry~ 请输入用户名",{time:1500},function(){})}})});