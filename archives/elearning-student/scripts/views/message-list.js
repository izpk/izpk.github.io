define(["jquery","underscore","backbone","views/ac-desc","views/message-desc","layer"],function(e,s,t,a,r,i){"use strict";return t.View.extend({id:"wrapper-message-list",className:"wrapper",template:s.template(e("#template-message-list").html()),events:{"click .message-list-li":"messageListLi"},type:"",render:function(e){return this.$el.html(this.template(e)),this},bbsdetail:function(e){CAICUI.Request.ajax({server:"bbsdetail",data:{token:CAICUI.User.token,id:CAICUI.render.replayId,pageNo:1,pageSize:20},done:function(s){CAICUI.render.messageBbsDetail=s.data,e&&e(s.data)},fail:function(e){i.msg("Sorry~ 获取信息失败，请刷新页面重试。",function(){})}})},messageListLi:function(s){CAICUI.iGlobal.loading("body .message-right",{height:e(".message-right").height()+"px"});var t=CAICUI.iGlobal.getThat(s);t.siblings().removeClass("active"),t.addClass("active");var d=t.index(),n=CAICUI.render.messageList[d];CAICUI.render.messageId=n.id;var l=n.status,o=0;if("1"==n.msgType&&"意见反馈"==n.title?o=2:"1"==n.msgType&&"意见反馈"!=n.title?o=1:"0"==n.msgType&&(o=3),CAICUI.render.messageType=o,3==o){var I={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"',"#39":"'"},m="<div>"+n.content.replace(/&(lt|gt|nbsp|amp|quot|#39);/gi,function(e,s){return I[s]})+"<div>";CAICUI.render.replayId=e(m).find(".bbsid").val()}if("0"==l&&(t.attr("data-status","1"),n.status="1",CAICUI.render.isAll="0",this.updateStatus()),CAICUI.render.replayId)this.bbsdetail(function(s){var t=new a;e("body .message-right").html(t.render({data:s}).el),setTimeout(function(){window.CAICUI.acScroll=CAICUI.iGlobal.iScroll("body #wrapper-ac"),CAICUI.render.messageBbsDetail.imgPath&&"imgpath"!==CAICUI.render.messageBbsDetail.imgPath&&i.photos({photos:".discussQA-imgPath",shift:0})},300)});else{var C=new r;e("body .message-right").html(C.render(n).el),window.CAICUI.messageDesc=new IScroll("body #wrapper-message-desc",{probeType:3,mouseWheel:!0,scrollbars:"custom"})}},updateStatus:function(s){CAICUI.Request.ajax({server:"updateStatus",data:{token:CAICUI.User.token,messageId:CAICUI.render.messageId,isall:CAICUI.render.isAll},done:function(t){CAICUI.render.isNoReadNum&&(CAICUI.render.isNoReadNum--,CAICUI.render.isNoReadNum||e("body .message").removeClass("redRead"),e("body .message-noRead-number").text(CAICUI.render.isNoReadNum),e("body .message-isReadNum").text(CAICUI.render.isNoReadNum),e("body #message-list-"+CAICUI.render.messageId).find(".message-unread-tips").remove()),s&&s()},fail:function(e){console.log(e)}})}})});