define(["jquery","underscore","backbone","views/learningPlan","jqueryBase64"],function(e,n,a,i){"use strict";return a.View.extend({tagName:"div",className:"activationCourse-main",template:n.template(e("#template-activation-course").html()),events:{"click .js-course-activation-acca-close":"courseActivationAccaClose","click .course-activation-acca-li":"changeCourseModel","click .learning-plan-activation":"learningPlanActivation","click .learningPlan-apply-editor-confirm":"learningPlanApplyEditorConfirm"},render:function(n){return this.$el.html(this.template(n)),e("body .course-activation-acca-btn").one("click",function(){CAICUI.render.$this.selectLearningPlan()}),n.isActivationCourse&&this.subjectTimeListAjax(function(n){var a=e("body .learning-plan-activation");if(n.length){var i=e("#template-learning-plan-examTime").html(),t=CAICUI.iGlobal.getTemplate(i,{timeList:n});e("body .learning-plan-examTime-input").html(t),e("body .learning-plan-examTime-input").find("option").eq(0).attr("selected",!0),CAICUI.render.courseExamTime=n[0].time,a.addClass("active")}else a.removeClass("active")}),this},subjectTimeListAjax:function(e){CAICUI.Request.ajax({server:"subjectTimeList",data:{subjectId:CAICUI.render.subjectID},done:function(n){e&&e(n.data)},fail:function(e){}})},selectLearningPlan:function(){CAICUI.render.learningPlan=new i,e("body #right").append(CAICUI.render.learningPlan.render().el),window.CAICUI.render.myScrollLearningPlanStep1=CAICUI.iGlobal.iScroll("body #wrapper-learning-plan-step1"),window.CAICUI.render.myScrollLearningPlanStep2=CAICUI.iGlobal.iScroll("body #wrapper-learning-plan-step2"),window.CAICUI.render.myScrollLearningPlanStep3=CAICUI.iGlobal.iScroll("body #wrapper-learning-plan-step3")},courseActivationAccaClose:function(){CAICUI.render.activationCourse?CAICUI.render.activationCourse.remove():e("body .activationCourse-main").remove()},changeCourseModel:function(n){var a=CAICUI.iGlobal.getThat(n);if(!a.hasClass("active")){var i=a.index();a.siblings().removeClass("active"),a.addClass("active"),e("body .course-activation-acca-content-li").removeClass("active"),e("body .course-activation-acca-content-li").eq(i).addClass("active"),window.CAICUI.myScrollCourseModel.refresh()}},learningPlanActivation:function(n){CAICUI.iGlobal.getThat(n).hasClass("active")&&(e("body .learning-plan-activation").addClass("hidden"),e("body .learning-plan-activationing").removeClass("hidden"),this.courseActive())},courseActive:function(n){CAICUI.Request.ajax({server:"active",data:{token:CAICUI.User.token,courseId:CAICUI.render.courseId,isU:CAICUI.render.isU,orderItemId:CAICUI.render.orderItemId,examTime:CAICUI.iGlobal.getDate(CAICUI.render.courseExamTime,"-")},done:function(n){"success"==n.state?window.location.hash="#courseStudy/"+CAICUI.render.courseId:layer.msg("Sorry~ 课程激活失败！",function(){e("body .learning-plan-activation").removeClass("hidden"),e("body .learning-plan-activationing").addClass("hidden")})},fail:function(n){layer.msg("Sorry~ 课程激活失败！",function(){e("body .learning-plan-activation").removeClass("hidden"),e("body .learning-plan-activationing").addClass("hidden")})}})},learningPlanApplyEditorConfirm:function(){e("body .course-baseInfo").remove(),e("body .courseIndex-baseInfo-btn").removeClass("hidden"),CAICUI.Request.ajax({server:"saveExtension",data:{token:CAICUI.User.token,courseCategoryId:CAICUI.render.courseDetail.subjectId,courseId:CAICUI.render.courseId},done:function(e){layer.msg("申请成功~",{icon:1})},fail:function(e){layer.msg("Sorry~申请失败")}})}})});