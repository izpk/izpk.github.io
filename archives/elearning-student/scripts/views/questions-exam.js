define(["jquery","underscore","backbone","layer"],function(e,r,t,s){"use strict";return t.View.extend({el:"body",template:r.template(e("#template-questions-exam").html()),events:{"click .questions-card-button":"toggleCards","click .js-card-btn":"cardBtn","click .js-questions-btn-prev":"questionsPrev","click .js-questions-btn-next":"questionsNext","click .questions-correction-btn":"openFeedbackPop","click .questions-analysis-btn":"analysis","click .js-questions-option-click":"questionsOptionClick","keyup .js-questions-option-keyup":"questionsOptionKeyup","click .js-open-sidebar":"openSidebar","click .js-close-sidebar":"closeSidebar","click .node-editor-isOpen-button":"nodeEditorIsOpenButton","click .node-editor-confirm":"nodeEditorConfirm","change #uploadForm-file":"uploadFormFile","click .view-other-btn":"viewOther","click #questions-guide-content":"stepGuide","click .questions-exit":"exit"},render:function(r){CAICUI.render.knowledgepointid=r,CAICUI.render.answerArr=["A","B","C","D","E","F","G","H"],CAICUI.render.this=this,CAICUI.render.typeHtml="",CAICUI.render.questionsType="",CAICUI.render.questionsStatus="",CAICUI.render.pushContext="",CAICUI.render.isDone="",CAICUI.render.exerciseId="",CAICUI.render.questionsDataCache="",CAICUI.render.questionsDataCacheArray=[],CAICUI.render.isMyChecked="",CAICUI.render.cardOpen=!1,CAICUI.render.exerciseIdOld="",CAICUI.render.exerciseIdNew="",CAICUI.render.exerciseNoDoneCount=0,CAICUI.render.exerciseRightCount=0,CAICUI.render.isPublic=1,CAICUI.render.currentProgress=0,CAICUI.render.isFinish=0,CAICUI.render.taskState=0,CAICUI.render.answerResolution={context:"",status:!0,rightAnswer:"",myAnswer:""},CAICUI.render.imgPathArray=[],CAICUI.render.questionsGuide="",CAICUI.render.questionsGuideIndex=1,CAICUI.render.this.questionsAnswer="",CAICUI.render.questionsIsSubmit=!0,CAICUI.render.readonly="",CAICUI.render.viewResolution&&(CAICUI.render.readonly='readonly="readonly"'),CAICUI.render.isDoneNew="",e("body .studycenter-video").append(CAICUI.render.this.template()),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body .questions #wrapper"),this.init()},init:function(){this.exerciseFilenameAjax(function(){var t=e("#template-questions-exam-cards").html(),s=CAICUI.iGlobal.getTemplate(t,{data:CAICUI.render.exerciseFilenameArray});e("body .studycenter-video .questions").append(s),CAICUI.render.this.userKnowledgePointExerciseListAjax(function(t){CAICUI.render.myExamContinue&&CAICUI.render.myExamContinue.examenNum||(t=[]),CAICUI.render.questionsDataCacheArray=t,CAICUI.render.exerciseNoDoneCount=CAICUI.render.exerciseCount-CAICUI.render.exerciseDoneCount,CAICUI.render.exerciseRightCount=CAICUI.render.exerciseDoneCount-CAICUI.render.errorNum;var s=0;CAICUI.render.exerciseDoneCount&&((s=CAICUI.render.exerciseRightCount/CAICUI.render.exerciseDoneCount*100)>0&&s<1&&(s=1),s=s.toFixed(0));var n=0;CAICUI.render.exerciseCount&&((n=CAICUI.render.exerciseDoneCount/CAICUI.render.exerciseCount*100)>0&&n<1&&(n=1),n=n.toFixed(0)),e("body .questions-progress-show").attr("data-course-progress",n),e("body .questions-percentage").html(n),e("body .questions-progress-show").animate({width:n+"%"},1e3),e(".exercise-done-count").text(CAICUI.render.exerciseDoneCount),e(".exercise-count").text(CAICUI.render.exerciseCount),e(".progress-round-count").text(s),e("#progress-round-question").attr("data-progress",s),CAICUI.iGlobal.canvasRound("progress-round-question",{borderColor:"#00A184",borderWidth:3,bg:!0,bgBorderColor:"#8CD5C8"}),r.each(t,function(r,t){var s="questions-cards-info";"0"==r.status?s="questions-cards-info":"1"==r.status?(s="questions-cards-success",e("#questions-card-"+r.exercise_id).attr("data-isdone","true")):"2"==r.status&&(s="questions-cards-danger",e("#questions-card-"+r.exercise_id).attr("data-isdone","false")),e("#questions-card-"+r.exercise_id).addClass(s)}),CAICUI.render.lastExerciseNid?CAICUI.render.questionsIndex=+CAICUI.render.lastExerciseNid:CAICUI.render.questionsIndex=0,CAICUI.render.taskProgress&&(CAICUI.render.questionsIndex=CAICUI.render.taskProgress),e("body #wrapper-cards .js-card-btn").eq(CAICUI.render.lastExerciseNid).addClass("questions-cards-active"),CAICUI.render.exerciseId=e(".js-card-btn").eq(CAICUI.render.questionsIndex).attr("data-exerciseid"),CAICUI.render.isDone=e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone"),CAICUI.render.isDone&&"1"==CAICUI.render.examExpress&&e("body .questions-body").addClass("questions-answerResolution-active"),CAICUI.render.this.getNidExerciseDetailAjax(function(){CAICUI.render.this.guide(),CAICUI.render.formCourseStudy&&CAICUI.CACHE.getTasksProgress?CAICUI.render.this.initTasksProgress(CAICUI.CACHE.getTasksProgress):CAICUI.Request.ajax({server:"actionGetTasksProgress",data:{token:CAICUI.User.token,memberId:CAICUI.User.memberId,courseId:CAICUI.render.courseId},done:function(e){CAICUI.CACHE.getTasksProgress=e.data,CAICUI.render.this.initTasksProgress(CAICUI.CACHE.getTasksProgress)},fail:function(e){}})})})});var t=null;t=setInterval(function(){e("body .questions-cards-ul").find("li").length&&(window.CAICUI.myCardsScroll=CAICUI.iGlobal.iScroll("body .questions #wrapper-cards"),window.CAICUI.myCardsScroll.refresh(),clearInterval(t))},300)},initTasksProgress:function(e){CAICUI.render.studyTime=0,CAICUI.render.taskStudyTotalTime=0,r.each(e,function(e,r){e.taskId==CAICUI.render.taskId&&(CAICUI.render.studyTime=e.studyTime,CAICUI.render.taskStudyTotalTime=e.taskStudyTotalTime)}),setTimeout(function(){CAICUI.render.action="begintest",CAICUI.render.this.actionTaskProgress()},30)},actionTaskProgress:function(){console.log(CAICUI.render.action);var e={action:CAICUI.render.action,token:CAICUI.User.token,memberId:CAICUI.User.memberId,progress:CAICUI.render.exerciseDoneCount,total:CAICUI.render.exerciseCount,taskId:videoController.currentTask.taskId,chapterId:videoController.currentChapter.chapterId,courseId:videoController.courseData.courseId,subjectId:videoController.courseData.subjectId,categoryId:videoController.courseData.categoryId,taskName:videoController.currentTask.title,chapterName:videoController.currentChapter.chapterTitle,courseName:videoController.courseData.courseName,subjectName:videoController.courseData.subjectName,categoryName:videoController.courseData.categoryName,state:CAICUI.render.taskState,memberName:CAICUI.User.nickname,isSupply:0,createDate:(new Date).getTime()};switch(CAICUI.render.action){case"begintest":case"seektest":case"test":case"submittest":CAICUI.iGlobal.clearTimer()}CAICUI.timer.time?(e.studyTime=CAICUI.timer.time,e.taskStudyTotalTime=CAICUI.timer.time+CAICUI.render.taskStudyTotalTime):(e.studyTime=0,e.taskStudyTotalTime=CAICUI.render.taskStudyTotalTime),CAICUI.timer.time=0,CAICUI.iGlobal.timer(),CAICUI.Request.ajax({server:"actionTaskProgress",data:{token:CAICUI.User.token,message:JSON.stringify(e)},done:function(e){}})},setMemberExamenFinish:function(){CAICUI.Request.ajax({server:"setMemberExamenFinish",data:{memberId:CAICUI.User.memberId,examenid:CAICUI.render.examId,examenNum:CAICUI.render.examenNum},done:function(e){}})},openFeedbackPop:function(){CAICUI.render.feedbackType=["答案有异议","解析有误","错别字","排版错误","其他错误"];var t=r.template(e("#template-feedback-exam").html());CAICUI.render.feedbackTitle=CAICUI.render.this.getExerciseTitle(CAICUI.render.exerciseTitle,CAICUI.render.questionsType),e("body").append(t({currentTask:{progress:+CAICUI.render.questionsIndex+1,title:CAICUI.render.feedbackTitle},feedbackType:CAICUI.render.feedbackType})),CAICUI.Request.ajax({server:"member",data:{token:CAICUI.User.token},done:function(r){"success"==r.state?(CAICUI.render.member=r.data,e("body .pop-input-tel").val(CAICUI.render.member.mobile?CAICUI.render.member.mobile:CAICUI.render.member.email)):console.log("member:"+r)},fail:function(e){console.log("member:"+e)}}),this.feedbackAnimate(".pop-html"),this.feedbackEvent()},feedbackAnimate:function(r){e(r).animate({opacity:1},1e3)},feedbackEvent:function(){var r=e("#help-feedback-pop");r&&(r.on("click",".pop-radio-label",function(){var r=e(this);r.siblings().removeClass("active"),r.addClass("active")}),r.on("click",".pop-button-confirm",function(){var r=e(".pop-radio-label.active").index(),t=CAICUI.render.feedbackType[r],n=e(".pop-textarea").val();if(n){var i="",a={categoryName:videoController.courseData.categoryName,categoryId:videoController.courseData.categoryId,subjectName:videoController.courseData.subjectName,subjectId:videoController.courseData.subjectId,courseName:videoController.courseData.courseName,courseId:videoController.courseData.courseId,chapterName:videoController.currentChapter.chapterTitle,chapterName:videoController.currentChapter.chapterName,taskName:videoController.currentTask.title,taskId:videoController.currentTask.taskId,id:CAICUI.render.exerciseId};i+='<a class="content-addDom" data-nameJson="'+JSON.stringify(a)+'" href="javascript:;" data-course-id="'+CAICUI.render.courseId+'" data-chapter-id="'+CAICUI.render.chapterId+'" data-task-id="'+CAICUI.render.taskId+'" ';var d=0;i+='data-type="exam" data-sort="'+(d="0"==CAICUI.render.ExerciseProgress?"1":CAICUI.render.ExerciseProgress)+'" data-exercise-id="'+CAICUI.render.exerciseId+'" data-title="'+CAICUI.render.examName+'" ',n+=i+=">试题："+d+"题</a>";var o=e(".pop-input-tel").val();if(o){var C="MacIntel"==navigator.platform?"苹果":"",I=navigator.userAgent.split(" "),c=(I.length,I[I.length-2].split("/")[0]+"-"+I[I.length-1].split("/")[0]);CAICUI.render.this.feedbackAjax({memberId:CAICUI.User.memberId,memberName:CAICUI.User.nickname,cmptType:t,cmptContent:n,contactWay:o,deviceDesc:C+" "+c})}else s.msg("Sorry~ 请输入联系方式！",function(){})}else s.msg("Sorry~ 请输入内容！",function(){})}),r.on("click",".pop-button-cancel",function(){r.remove(),r.off()}))},feedbackAjax:function(r){CAICUI.Request.ajax({server:"addLMG",data:r,done:function(r){e(".pop-html").remove(),s.msg("提交成功",{icon:1,time:1e3},function(){e("#help-feedback-pop").remove(),e("#help-feedback-pop").off()})},fail:function(e){s.msg("Sorry~ ",function(){})}})},guide:function(r){CAICUI.render.questionsGuide=e.cookie("questionsGuide"),"true"!=CAICUI.render.questionsGuide?this.createGuide():this.callbackGuide()},createGuide:function(){var r=e("#template-questions-exam-guide").html(),t=CAICUI.iGlobal.getTemplate(r);e("body .questions").append(t)},removeGuide:function(){e("#questions-guide").remove(),e.cookie("questionsGuide",!0,{path:"/",expires:36500}),this.callbackGuide()},stepGuide:function(r){CAICUI.render.questionsGuideIndex=+CAICUI.render.questionsGuideIndex+1,CAICUI.render.questionsGuideIndex<6?e("body #questions-guide-content").attr("class","questions-guide-step-"+CAICUI.render.questionsGuideIndex):this.removeGuide()},callbackGuide:function(){CAICUI.render.this.clockTime(),document.onkeydown=function(e){var r=e||window.event||arguments.callee.caller.arguments[0];r&&37==r.keyCode&&CAICUI.render.this.questionsPrev(),r&&39==r.keyCode&&CAICUI.render.this.questionsNext()}},exerciseFilenameAjax:function(e){this.getExerciseId(function(r){CAICUI.render.exerciseFilenameArray=r,CAICUI.render.exerciseCount=r.length,e&&e()})},userKnowledgePointExerciseListAjax:function(e){CAICUI.Request.ajax({server:"get_user_knowledge_point_exercise_list",data:{knowledge_point_id:CAICUI.render.knowledgepointid,member_id:CAICUI.User.memberId,examenNum:CAICUI.render.examenNum},done:function(r){e&&e(r.data)}})},getNidExerciseDetailAjax:function(e){CAICUI.Request.ajax({server:"getNidExerciseDetail",data:{exerciseId:CAICUI.render.exerciseId},done:function(r){CAICUI.render.prevClick="",CAICUI.render.nextClick="",CAICUI.render.exerciseTitle="",CAICUI.render.exerciseDetail=r.data[0],CAICUI.render.exerciseId!==r.data[0].id&&(CAICUI.render.exerciseIdOld=CAICUI.render.exerciseId,CAICUI.render.exerciseIdNew=r.data[0].id,CAICUI.render.exerciseId=r.data[0].id),r.data[0].title&&(CAICUI.render.exerciseTitle+=r.data[0].title),r.data[0].background&&(CAICUI.render.exerciseTitle+=r.data[0].background),CAICUI.render.this.addDOMNidExerciseDetail(r.data[0]),e&&e(r.data)}})},addDOMNidExerciseDetail:function(r){0==CAICUI.render.lastExerciseNid?e("body .js-questions-btn-prev").hide():e("body .js-questions-btn-prev").show(),+CAICUI.render.lastExerciseNid+1!=CAICUI.render.exerciseCount||CAICUI.render.viewResolution?e("body .js-questions-btn-next").removeClass("questions-btn-done"):e("body .js-questions-btn-next").addClass("questions-btn-done");var t=r,s=e("#template-questions-exam-content").html(),n=CAICUI.iGlobal.getTemplate(s,{item:t});e("body .questions #scroller").html(n),e("body .questions #scroller").find("img").each(function(r){var t=e(this).attr("src"),s=t.substr(-3);"jpg"!=s&&"png"!=s&&"gif"!=s&&"svg"!=s||(t=CAICUI.Common.host.static+t),e(this).attr("src",t)}),setTimeout(function(){window.CAICUI.myScroll.refresh(),window.CAICUI.myScroll.scrollTo(0,0)},300)},setMemberExerciseLogAjax:function(r){if(CAICUI.render.viewResolution)return CAICUI.render.this.doneChange(),r&&r(),!1;this.questionsStatus(function(){if(CAICUI.render.isMyChecked){CAICUI.render.isMyChecked="",CAICUI.render.isDone=e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone"),1==CAICUI.render.status?e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone","true"):2==CAICUI.render.status&&e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone","false");for(var t=e("body .js-card-btn"),s=0,n=0,i=0,a=0;a<t.length;a++){var d=t.eq(a).attr("data-isdone");"true"==d?s++:"false"==d?n++:i++}if(CAICUI.render.exerciseRightCount=s,CAICUI.render.errorNum=n,CAICUI.render.exerciseDoneCount=s+n,CAICUI.render.exerciseNoDoneCount=i,CAICUI.render.exerciseIdOld&&CAICUI.render.exerciseIdNew){var o={knowledgePointId:CAICUI.render.knowledgepointid,exerciseId:CAICUI.render.exerciseIdOld,memberId:CAICUI.User.memberId,context:"'"+JSON.stringify(CAICUI.render.pushContext)+"'",status:CAICUI.render.status,subjectId:CAICUI.render.subjectId,categoryId:CAICUI.render.categoryId,courseId:CAICUI.render.courseId,chapterId:CAICUI.render.chapterId,taskId:videoController.currentTask.taskId,cacheKnowledgeLevel1Id:CAICUI.render.cacheKnowledgeLevel1Id,cacheKnowledgeLevel2Id:CAICUI.render.cacheKnowledgeLevel2Id,cacheKnowledgePath:CAICUI.render.cacheKnowledgePath,progress:CAICUI.render.exerciseDoneCount,lastExerciseNid:CAICUI.render.lastExerciseNid,errorNum:CAICUI.render.errorNum,correctNum:CAICUI.render.exerciseRightCount,totalTime:CAICUI.render.ExerciseTotalTime,examenNum:CAICUI.render.examenNum,examenName:videoController.currentTask.title,examenTotalNum:videoController.currentTask.totalCount,examenType:"chapter",isFinish:CAICUI.render.isFinish,currentProgress:+CAICUI.render.currentProgress,exerciseTitle:CAICUI.render.exerciseTitle};CAICUI.Request.ajax({server:"setMemberExerciseLog",data:o,done:function(e){for(var r=!1,t=0,s=0;s<CAICUI.render.questionsDataCacheArray.length;s++){(CAICUI.render.questionsDataCacheArray[s].exercise_id||CAICUI.render.questionsDataCacheArray[s].exerciseId)==CAICUI.render.exerciseIdOld&&(r=!0,t=s)}console.log(r+";"+t),r?CAICUI.render.questionsDataCacheArray[t].context=JSON.stringify(CAICUI.render.pushContext):CAICUI.render.questionsDataCacheArray.push(o)}})}o={knowledgePointId:CAICUI.render.knowledgepointid,exerciseId:CAICUI.render.exerciseId,memberId:CAICUI.User.memberId,context:"'"+JSON.stringify(CAICUI.render.pushContext)+"'",status:CAICUI.render.status,subjectId:CAICUI.render.subjectId,categoryId:CAICUI.render.categoryId,courseId:CAICUI.render.courseId,chapterId:CAICUI.render.chapterId,taskId:videoController.currentTask.taskId,cacheKnowledgeLevel1Id:CAICUI.render.cacheKnowledgeLevel1Id,cacheKnowledgeLevel2Id:CAICUI.render.cacheKnowledgeLevel2Id,cacheKnowledgePath:CAICUI.render.cacheKnowledgePath,progress:CAICUI.render.exerciseDoneCount,lastExerciseNid:CAICUI.render.lastExerciseNid,errorNum:CAICUI.render.errorNum,correctNum:CAICUI.render.exerciseRightCount,totalTime:CAICUI.render.ExerciseTotalTime,examenNum:CAICUI.render.examenNum,examenName:videoController.currentTask.title,examenTotalNum:videoController.currentTask.totalCount,examenType:"chapter",isFinish:CAICUI.render.isFinish,currentProgress:+CAICUI.render.currentProgress,exerciseTitle:CAICUI.render.exerciseTitle};CAICUI.Request.ajax({server:"setMemberExerciseLog",data:o,done:function(e){for(var t=!1,s=0,n=0;n<CAICUI.render.questionsDataCacheArray.length;n++){(CAICUI.render.questionsDataCacheArray[n].exercise_id||CAICUI.render.questionsDataCacheArray[n].exerciseId)==CAICUI.render.exerciseId&&(t=!0,s=n)}console.log(t+";"+s),t?CAICUI.render.questionsDataCacheArray[s].context=JSON.stringify(CAICUI.render.pushContext):CAICUI.render.questionsDataCacheArray.push(o),CAICUI.render.this.doneChange(),console.log(CAICUI.render.isFinish),CAICUI.render.this.actionTaskProgress(),r&&r(e)}})}else CAICUI.render.status=0,1==CAICUI.render.isFinish&&CAICUI.render.this.actionTaskProgress(),r&&r()})},doneChange:function(){1==CAICUI.render.status?e("body .js-card-btn").eq(CAICUI.render.questionsIndex).attr("data-isdone","true"):2==CAICUI.render.status&&e("body .js-card-btn").eq(CAICUI.render.questionsIndex).attr("data-isdone","false"),e("body .knowledge-point-number-"+CAICUI.render.knowledgepointid).text(CAICUI.render.exerciseDoneCount),e("body #knowledge-point-btn-"+CAICUI.render.knowledgepointid).attr("data-last-exercise-nid",CAICUI.render.lastExerciseNid),e("body #knowledge-point-btn-"+CAICUI.render.knowledgepointid).attr("data-exercise-progress",CAICUI.render.exerciseDoneCount),e("body #knowledge-point-btn-"+CAICUI.render.knowledgepointid).attr("data-exercise-total-time",CAICUI.render.ExerciseTotalTime),e("body #knowledge-point-btn-"+CAICUI.render.knowledgepointid).attr("data-errornum",CAICUI.render.errorNum),e(".exercise-done-count").text(CAICUI.render.exerciseDoneCount),e(".exercise-count").text(CAICUI.render.exerciseCount);var r=0;CAICUI.render.exerciseDoneCount&&((r=CAICUI.render.exerciseRightCount/CAICUI.render.exerciseDoneCount*100)>0&&r<1&&(r=1),r=r.toFixed(0));var t=0;CAICUI.render.exerciseCount&&((t=CAICUI.render.exerciseDoneCount/CAICUI.render.exerciseCount*100)>0&&t<1&&(t=1),t=t.toFixed(0)),e("body .questions-progress-show").attr("data-course-progress",t),e("body .questions-percentage").html(t),e("body .questions-progress-show").animate({width:t+"%"},1e3),e(".progress-round-count").text(r),e("#progress-round-question").attr("data-progress",r),CAICUI.iGlobal.canvasRound("progress-round-question",{borderColor:"#00A184",borderWidth:3,bg:!0,bgBorderColor:"#bgBorderWidth"})},analysis:function(r){CAICUI.iGlobal.getThat(r);var t=this.$el.find(".questions-answerResolution");t.hasClass("active")?(t.removeClass("active"),e("body .questions-body").removeClass("questions-answerResolution-active")):(e("body .questions-body").addClass("questions-answerResolution-active"),this.questionsStatus(function(){}),CAICUI.render.isMyChecked?e("body .js-card-btn").eq(+CAICUI.render.questionsIndex).trigger("click"):t.addClass("active")),window.CAICUI.myScroll.refresh()},cardBtn:function(r){var t=CAICUI.iGlobal.getThat(r),s=(t.find("button"),t.attr("data-index"));CAICUI.render.questionsIsSubmit&&(CAICUI.render.questionsIsSubmit=!1,CAICUI.render.prevClick||CAICUI.render.nextClick||(CAICUI.render.action="seektest"),this.setMemberExerciseLogAjax(function(r){CAICUI.render.this.questionsLoaderContent();var n="";n=CAICUI.render.exerciseIdOld?e("#questions-card-"+CAICUI.render.exerciseIdOld):e("#questions-card-"+CAICUI.render.exerciseId),1==CAICUI.render.status?n.removeClass("questions-cards-danger").addClass("questions-cards-success"):2==CAICUI.render.status&&n.removeClass("questions-cards-success").addClass("questions-cards-danger"),e("body .questions .js-card-btn").removeClass("questions-cards-active"),t.addClass("questions-cards-active"),CAICUI.render.exerciseId=t.attr("data-exerciseid"),CAICUI.render.lastExerciseNid=s,+CAICUI.render.ExerciseProgress<+s+1&&(CAICUI.render.ExerciseProgress=+s+1),CAICUI.render.questionsIndex=s,CAICUI.render.currentProgress=s,e("body .right-questions-item-count").text(+CAICUI.render.questionsIndex+1),CAICUI.render.isDone=t.attr("data-isdone"),CAICUI.render.exerciseIdOld="",CAICUI.render.exerciseIdNew="",CAICUI.render.isDoneNew="",CAICUI.render.this.getNidExerciseDetailAjax(function(){CAICUI.render.isDone&&"1"==CAICUI.render.examExpress?e("body .questions-body").addClass("questions-answerResolution-active"):e("body .questions-body").removeClass("questions-answerResolution-active"),CAICUI.render.questionsIsSubmit=!0,CAICUI.render.cardOpen&&(e("body .questions-card-button").trigger("click"),CAICUI.render.cardOpen=!1)})}))},questionsPrev:function(r){if(CAICUI.render.questionsIndex>0){var t=+CAICUI.render.questionsIndex-1;CAICUI.render.prevClick=!0,CAICUI.render.action="test",e("body .js-card-btn").eq(t).trigger("click")}},questionsNext:function(r){var t=CAICUI.iGlobal.getThat(r);if(+CAICUI.render.questionsIndex<+CAICUI.render.exerciseCount){+CAICUI.render.questionsIndex+1==+CAICUI.render.exerciseCount&&(CAICUI.render.viewResolution?s.msg("已经是最后一题了~",{time:2e3},function(){}):(t.hasClass("questions-btn-done")&&(CAICUI.render.action="submittest",CAICUI.render.isFinish=1,CAICUI.render.taskState=1),this.setMemberExerciseLogAjax(function(r){var t="";t=CAICUI.render.exerciseIdOld?e("#questions-card-"+CAICUI.render.exerciseIdOld):e("#questions-card-"+CAICUI.render.exerciseId),1==+CAICUI.render.status?t.removeClass("questions-cards-danger").addClass("questions-cards-success"):2==+CAICUI.render.status&&t.removeClass("questions-cards-success").addClass("questions-cards-danger"),CAICUI.render.exerciseDoneCount,CAICUI.render.exerciseCount,CAICUI.render.this.setMemberExamenFinish(),CAICUI.render.this.getMemberErrorExercise(function(){CAICUI.render.this.setMemberErrorExercise()}),s.msg("试卷已提交，进入我的试卷查看试卷解析",{time:1500},function(){CAICUI.render.this.clearInitData(),window.location.hash="#myExam"})})));var n=+CAICUI.render.questionsIndex+1;CAICUI.render.nextClick=!0,CAICUI.render.action="test",e("body .js-card-btn").eq(n).trigger("click")}},setMemberErrorExercise:function(){CAICUI.Request.ajax({server:"setMemberErrorExercise",data:{memberId:CAICUI.User.memberId,examenId:CAICUI.render.examId,errorexerciseids:CAICUI.render.errorexerciseids,correctexerciseids:CAICUI.render.correctexerciseids,errorexerciseRecords:JSON.stringify(CAICUI.render.errorexerciseRecords),examenName:CAICUI.render.examName},done:function(e){}})},getMemberErrorExercise:function(r){var t="",s="",n=[];e("body #wrapper-cards .js-card-btn").each(function(r,i){var a=e(this),d=a.attr("data-index"),o=a.attr("data-exerciseid");if(a.hasClass("questions-cards-success"))s+=o+",";else{var C=CAICUI.render.this.getExerciseTitle(CAICUI.render.exerciseBaseInfo[d].title,CAICUI.render.exerciseBaseInfo[d].questionTypes);t+=o+",",n.push({sort:d,exerciseid:o,exerciseTitle:C})}}),CAICUI.render.correctexerciseids=s,CAICUI.render.errorexerciseids=t,CAICUI.render.errorexerciseRecords=n,r&&r()},getExerciseTitle:function(e,r){var t="";if(e)t=e.replace(/<[^>]+>/g,"").replace(/(^\s+)|(\s+$)/g,"").replace(/(\r)|(\n)|(\t)/g,"");else switch(r){case"radio":t="单选题";break;case"checkbox":t="复选题";break;case"blank":t="填空题";break;case"question":t="简答题";break;case"matrixRadio":t="矩阵单选题";break;case"matrixCheckbox":t="矩阵复选题";break;case"matrixBlank":t="矩阵填空题";break;case"multiTask":t="多任务题"}return t},getQuestionsDataCacheIndex:function(r,t){for(var s=0,n=CAICUI.render.questionsDataCacheArray.length,i=0;i<n;i++){if((CAICUI.render.questionsDataCacheArray[i].exercise_id||CAICUI.render.questionsDataCacheArray[i].exerciseId)==CAICUI.render.exerciseId)return CAICUI.render.questionsDataCache=CAICUI.render.questionsDataCacheArray[i],"0"==CAICUI.render.questionsDataCache.status?CAICUI.render.isDone="":"1"==CAICUI.render.questionsDataCache.status?CAICUI.render.isDone="true":"2"==CAICUI.render.questionsDataCache.status&&(CAICUI.render.isDone="false"),CAICUI.render.questionsDataCacheArray[i];s++}s==n&&(console.log("没有做题记录"),CAICUI.render.isDoneNew="none",CAICUI.render.exerciseIdOld&&CAICUI.render.exerciseIdNew&&(e("body #questions-card-"+CAICUI.render.exerciseIdOld).removeAttr("data-isdone"),e("body #questions-card-"+CAICUI.render.exerciseIdNew).removeAttr("data-isdone")))},filterQuestionsContent:function(e){var r={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"',"#39":"'"},t=e.replace(/&(lt|gt|nbsp|amp|quot|#39);/gi,function(e,t){return r[t]}),s=t.split('"false"');t="";for(var n=s.length,i=0;i<n;i++)t+=i==n-1?s[i]:s[i]+"false";var a=t.split('"true"');t="";for(n=a.length,i=0;i<n;i++)t+=i==n-1?a[i]:a[i]+"true";return t},questions:function(t,s,n){CAICUI.render.questionsAnswer="",CAICUI.render.typeHtml="",CAICUI.render.questionsType=t;var i=this.getQuestionsDataCacheIndex();if(CAICUI.render.isDone=e("body #questions-card-"+CAICUI.render.exerciseId).attr("data-isdone"),CAICUI.render.isDone&&"none"!=CAICUI.render.isDoneNew){"active";var a=i.context,d=this.filterQuestionsContent(a);try{CAICUI.render.pushContext=JSON.parse(d)}catch(e){CAICUI.render.pushContext=JSON.parse(d.slice(1,d.length-1))}}else{CAICUI.render.isDone="";d=this.filterQuestionsContent(s);try{CAICUI.render.pushContext=JSON.parse(d)}catch(e){if("question"==CAICUI.render.exerciseDetail.questionTypes){var o=d.split('":"');console.log(o),CAICUI.render.pushContext=[{blank:o[1].substring(0,o[1].length-2)}]}}}return console.log(CAICUI.render.pushContext),CAICUI.render.answerResolution.context=n,"multiTask"===t?r.each(CAICUI.render.pushContext,function(e,r){CAICUI.render.typeHtml+='<div class="questions-options-box"><div class="questions-options-title">'+e.title+"</div>",CAICUI.render.this.questionsTypes(e.type,e.data,r),CAICUI.render.typeHtml+="</div>"}):(CAICUI.render.typeHtml+='<div class="questions-options-box">',CAICUI.render.this.questionsTypes(t,CAICUI.render.pushContext,0),CAICUI.render.typeHtml+="</div>"),CAICUI.render.typeHtml},questionsTypes:function(e,r,t,s){switch(e){case"checkbox":CAICUI.render.this.checkbox(r,t);break;case"radio":CAICUI.render.this.radio(r,t);break;case"question":CAICUI.render.this.question(r,t);break;case"blank":CAICUI.render.this.blank(r,t);break;case"matrixRadio":CAICUI.render.this.matrix("matrixRadio",r,t,s);break;case"matrixCheckbox":CAICUI.render.this.matrix("matrixCheckbox",r,t,s);break;case"matrixBlank":CAICUI.render.this.matrix("matrixBlank",r,t,s)}},checkbox:function(e,t){var s=!0,n="",i="";r.each(e,function(e,r){if(!CAICUI.render.this.optionRegExpTest(e.title)){var a="";e.isChecked&&(n+=CAICUI.render.answerArr[r]+" "),e.myChecked&&(a="active",i+=CAICUI.render.answerArr[r]+" "),e.isChecked!=e.myChecked&&(s=!1),CAICUI.render.typeHtml+='<div data-number="'+t+"-"+r+'" class="questions-hover questions-checkbox js-questions-option-click '+a+'"  data-mychecked='+e.myChecked+" data-ischecked="+e.isChecked+'><label><span class="questions-checkbox-input"></span><span class="questions-options-item">'+CAICUI.render.answerArr[r]+"：</span><div>"+e.title+"</div></label></div>"}}),CAICUI.render.answerResolution={status:s,rightAnswer:n,myAnswer:i}},radio:function(e,t){var s=!0,n="",i="";r.each(e,function(e,r){if(!CAICUI.render.this.optionRegExpTest(e.title)){var a="";e.isChecked&&(n+=CAICUI.render.answerArr[r]+" "),e.myChecked&&(a="active",i+=CAICUI.render.answerArr[r]+" "),e.isChecked!=e.myChecked&&(s=!1),CAICUI.render.typeHtml+='<div data-number="'+t+"-"+r+'" class="questions-hover questions-radio js-questions-option-click '+a+'" data-mychecked='+e.myChecked+" data-ischecked="+e.isChecked+'><label><span class="questions-radio-input"></span><span class="questions-options-item">'+CAICUI.render.answerArr[r]+"：</span><div>"+e.title+"</div></label></div>"}}),CAICUI.render.answerResolution={status:s,rightAnswer:n,myAnswer:i}},question:function(e,r){var t=!0,s="";e[0].myBlank&&(s=e[0].myBlank),e[0].blank!=e[0].myBlank&&(t=!1),CAICUI.render.typeHtml+='<div data-number="'+r+'-0" class="questions-question js-questions-option-keyup"><textarea '+CAICUI.render.readonly+" >"+s+"</textarea></div>",CAICUI.render.answerResolution={status:t,rightAnswer:e[0].blank,myAnswer:e[0].myBlank}},blank:function(e,r){var t=!0,s="";e[0].myBlank&&(s=e[0].myBlank),e[0].blank!=e[0].myBlank&&(t=!1),CAICUI.render.typeHtml+='<div data-number="'+r+'-0" class="questions-blank js-questions-option-keyup"><input '+CAICUI.render.readonly+' type="input" value='+s+"></div>",CAICUI.render.answerResolution={status:t,rightAnswer:e[0].blank,myAnswer:e[0].myBlank}},matrix:function(e,r,t,s){var n=r[0],i=(n.items.length,n.cols),a=n.rows;CAICUI.render.typeHtml+='<table class="questions-table questions-matrix questions-matrix-'+e+'"><tbody class="questions-tbody">';for(var d=0;d<a;d++){CAICUI.render.typeHtml+='<tr class="questions-tr">';for(var o=[],C=1;C<i;C++)o.push(C+d*i);for(var I=0;I<i;I++){var c=I+d*i,u=n.items[c],l="",A="";if(u.title&&c)CAICUI.render.typeHtml+='<td class="questions-td">'+u.title+"</td>";else if(c){switch(e){case"matrixRadio":u.myChecked&&(l=" active"),CAICUI.render.typeHtml+="<td data-mychecked="+u.myChecked+" data-rowsArray="+o+' data-number="'+t+"-"+c+'" class="questions-td  questions-radio js-questions-option-click'+l+'" data-ischecked='+u.isChecked+">",CAICUI.render.typeHtml+='<span class="questions-radio-input"></span>';break;case"matrixCheckbox":u.myChecked&&(l=" active"),CAICUI.render.typeHtml+="<td data-mychecked="+u.myChecked+' data-number="'+t+"-"+c+'" class="questions-td  questions-checkbox js-questions-option-click'+l+'" data-ischecked='+u.isChecked+">",CAICUI.render.typeHtml+='<span class="questions-checkbox-input"></span>';break;case"matrixBlank":u.myBlank&&(A=u.myBlank),CAICUI.render.typeHtml+='<td data-number="'+t+"-"+c+'" class="questions-td js-questions-option-keyup">',CAICUI.render.typeHtml+="<input "+CAICUI.render.readonly+' type="text" value="'+A+'" >'}CAICUI.render.typeHtml+="</td>"}else CAICUI.render.typeHtml+='<td class="questions-td"></td>'}CAICUI.render.typeHtml+="</tr>"}CAICUI.render.typeHtml+="</tbody></table>"},questionsResolution:function(t,s,n){if("string"==typeof(s=CAICUI.render.pushContext))s=JSON.parse(s);CAICUI.render.questionsAnswerHtml="",CAICUI.render.questionsAnswerHtml+='<p class="questions-answerResolution-p">问题解析</p>';var i=0,a="questions-answer-error",d=(CAICUI.render.exerciseIdOld?e("body #questions-card-"+CAICUI.render.exerciseIdOld):e("body #questions-card-"+CAICUI.render.exerciseId)).attr("data-isdone");return"true"==d?(i=1,CAICUI.render.questionsStatus="回答正确",a="questions-answer-success"):"false"==d?(i=2,CAICUI.render.questionsStatus="回答错误 正确答案是："):(i=0,CAICUI.render.questionsStatus="正确答案是："),1==i?(CAICUI.render.questionsAnswerHtml+='<div class="questions-answer-status '+a+'">',CAICUI.render.questionsAnswerHtml+='<span class="questions-answer ">'+CAICUI.render.questionsStatus+"</span>",CAICUI.render.questionsAnswerHtml+="</div>"):2==i&&("multiTask"==t?(CAICUI.render.questionsAnswerHtml+='<div class="questions-answer-status '+a+'">',CAICUI.render.questionsAnswerHtml+='<span class="questions-answer ">'+CAICUI.render.questionsStatus+"</span>",r.each(s,function(e,r){CAICUI.render.questionsAnswer="",CAICUI.render.questionsAnswerHtml+='<p class="questions-answerResolution-item">第'+(+r+1)+"题：</p>",CAICUI.render.this.questionsResolutionTypes(e.type,e.data,r,!0)})):(CAICUI.render.questionsAnswerHtml+='<div class="questions-answer-status '+a+'">',CAICUI.render.questionsAnswerHtml+='<span class="questions-answer ">'+CAICUI.render.questionsStatus+"</span>",this.questionsResolutionTypes(t,s,0,!0)),CAICUI.render.questionsAnswerHtml+="</div>"),CAICUI.render.questionsAnswerHtml+='<div class="questions-answerResolution-content">',CAICUI.render.questionsAnswerHtml+='<span class="questions-answerResolution-text">解析：</span>',CAICUI.render.questionsAnswerHtml+=n||"暂无解析",CAICUI.render.questionsAnswerHtml+="</div>",CAICUI.render.questionsAnswerHtml},questionsResolutionTypes:function(e,r,t,s){switch(e){case"checkbox":CAICUI.render.this.checkboxChecked(r,t),CAICUI.render.questionsAnswerHtml+='<span class="questions-answer">'+CAICUI.render.answerResolution.rightAnswer+"</span>";break;case"radio":CAICUI.render.this.radioChecked(r,t),CAICUI.render.questionsAnswerHtml+='<span class="questions-answer">'+CAICUI.render.answerResolution.rightAnswer+"</span>";break;case"question":CAICUI.render.this.questionChecked(r,t),CAICUI.render.questionsAnswerHtml+='<span class="questions-answer">'+CAICUI.render.answerResolution.rightAnswer+"</span>";break;case"blank":CAICUI.render.questionsAnswerHtml+='<span class="questions-answer">'+CAICUI.render.answerResolution.rightAnswer+"</span>";break;case"matrixRadio":CAICUI.render.this.matrixChecked("matrixRadio",r,t,s);break;case"matrixCheckbox":CAICUI.render.this.matrixChecked("matrixCheckbox",r,t,s);break;case"matrixBlank":CAICUI.render.this.matrixChecked("matrixBlank",r,t,s)}return CAICUI.render.questionsAnswerHtml},checkboxChecked:function(e,t){var s=!0,n="",i="";r.each(e,function(e,r){if(!CAICUI.render.this.optionRegExpTest(e.title)){var a="";e.isChecked&&(n+=CAICUI.render.answerArr[r]+" "),e.myChecked&&(a="active",i+=CAICUI.render.answerArr[r]+" "),e.isChecked!=e.myChecked&&(s=!1),CAICUI.render.typeHtml+='<div data-number="'+t+"-"+r+'" class="questions-hover questions-checkbox js-questions-option-click '+a+'"  data-mychecked='+e.myChecked+" data-ischecked="+e.isChecked+'><label><span class="questions-checkbox-input"></span><span class="questions-options-item">'+CAICUI.render.answerArr[r]+"：</span><div>"+e.title+"</div></label></div>"}}),CAICUI.render.answerResolution={status:s,rightAnswer:n,myAnswer:i}},radioChecked:function(e,t){var s=!0,n="",i="";r.each(e,function(e,r){if(!CAICUI.render.this.optionRegExpTest(e.title)){var a="";e.isChecked&&(n+=CAICUI.render.answerArr[r]+" "),e.myChecked&&(a="active",i+=CAICUI.render.answerArr[r]+" "),e.isChecked!=e.myChecked&&(s=!1),CAICUI.render.typeHtml+='<div data-number="'+t+"-"+r+'" class="questions-hover questions-radio js-questions-option-click '+a+'" data-mychecked='+e.myChecked+" data-ischecked="+e.isChecked+'><label><span class="questions-radio-input"></span><span class="questions-options-item">'+CAICUI.render.answerArr[r]+"：</span><div>"+e.title+"</div></label></div>"}}),CAICUI.render.answerResolution={status:s,rightAnswer:n,myAnswer:i}},questionChecked:function(e,r){var t=!0,s="";e[0].myBlank&&(s=e[0].myBlank),e[0].blank!=e[0].myBlank&&(t=!1),CAICUI.render.typeHtml+='<div data-number="'+r+'-0" class="questions-question js-questions-option-keyup"><textarea '+CAICUI.render.readonly+">"+s+"</textarea></div>",CAICUI.render.answerResolution={status:t,rightAnswer:e[0].blank,myAnswer:e[0].myBlank}},blankChecked:function(e,r){var t=!0,s="";e[0].myBlank&&(s=e[0].myBlank),e[0].blank!=e[0].myBlank&&(t=!1),CAICUI.render.typeHtml+='<div data-number="'+r+'-0" class="questions-blank js-questions-option-keyup"><input '+CAICUI.render.readonly+' type="input" value='+s+"></div>",CAICUI.render.answerResolution={status:t,rightAnswer:e[0].blank,myAnswer:e[0].myBlank}},matrixChecked:function(e,r,t,s){var n=r[0],i=(n.items.length,n.cols),a=n.rows,d=!1,o="",C="",I="",c="",u="";CAICUI.render.questionsAnswerHtml+='<table class="questions-table questions-matrix questions-matrix-'+e+'"><tbody class="questions-tbody">';for(var l=0;l<a;l++){CAICUI.render.questionsAnswerHtml+='<tr class="questions-tr">';for(var A=[],U=1;U<i;U++)A.push(U+l*i);for(var m=0;m<i;m++){var h=m+l*i,x=n.items[h];if(d=!1,o="",c="",C=" js-questions-option-click",I=" js-questions-option-keyup",x.title&&h)CAICUI.render.questionsAnswerHtml+='<td class="questions-td">'+x.title+"</td>";else if(h){switch(s&&(C="",I="",x.isChecked&&(d=!0,o=" active"),x.blank&&(console.log(x.blank),u="disabled",c=x.blank)),e){case"matrixRadio":CAICUI.render.questionsAnswerHtml+="<td data-mychecked="+d+" data-rowsArray="+A+' data-number="'+t+"-"+h+'" class="questions-td  questions-radio '+o+C+'" data-ischecked='+x.isChecked+">",CAICUI.render.questionsAnswerHtml+='<span class="questions-radio-input"></span>';break;case"matrixCheckbox":CAICUI.render.questionsAnswerHtml+="<td data-mychecked="+d+' data-number="'+t+"-"+h+'" class="questions-td  questions-checkbox '+o+C+'" data-ischecked='+x.isChecked+">",CAICUI.render.questionsAnswerHtml+='<span class="questions-checkbox-input"></span>';break;case"matrixBlank":CAICUI.render.questionsAnswerHtml+="<td data-mychecked="+d+' data-number="'+t+"-"+h+'" class="questions-td '+I+'">',CAICUI.render.questionsAnswerHtml+="<input "+CAICUI.render.readonly+' type="text" value="'+c+'" '+u+">"}CAICUI.render.questionsAnswerHtml+="</td>"}else CAICUI.render.questionsAnswerHtml+='<td class="questions-td"></td>'}CAICUI.render.questionsAnswerHtml+="</tr>"}CAICUI.render.questionsAnswerHtml+="</tbody></table>"},questionsOptionClick:function(e){if(e.preventDefault(),CAICUI.render.viewResolution)return!1;var r=CAICUI.iGlobal.getThat(e),t=r.attr("data-mychecked"),s=r.attr("data-number").split("-");"true"==t?(r.removeClass("active"),t=!1,r.attr("data-mychecked",t)):(r.hasClass("questions-radio")&&(r.siblings().attr("data-mychecked","false"),r.siblings().removeClass("active")),r.addClass("active"),t=!0,r.attr("data-mychecked",t)),"multiTask"==CAICUI.render.questionsType?this.changeMultiTaskQuestionsDataClick(CAICUI.render.pushContext[s[0]].type,s,t,r):this.changeQuestionsDataClick(CAICUI.render.questionsType,s,t,r)},changeQuestionsDataClick:function(e,t,s,n){switch(e){case"radio":r.each(CAICUI.render.pushContext,function(e,r){e.myChecked=!1}),CAICUI.render.pushContext[t[1]].myChecked=s;break;case"checkbox":CAICUI.render.pushContext[t[1]].myChecked=s;break;case"matrixRadio":var i=n.attr("data-rowsarray").split(",");r.each(i,function(e,r){CAICUI.render.pushContext[0].items[e].myChecked=!1}),CAICUI.render.pushContext[0].items[t[1]].myChecked=s;break;case"matrixCheckbox":CAICUI.render.pushContext[0].items[t[1]].myChecked=s}},changeMultiTaskQuestionsDataClick:function(e,t,s,n){switch(e){case"radio":r.each(CAICUI.render.pushContext[t[0]].data,function(e,r){e.myChecked=!1}),CAICUI.render.pushContext[t[0]].data[t[1]].myChecked=s;break;case"checkbox":CAICUI.render.pushContext[t[0]].data[t[1]].myChecked=s;break;case"matrixRadio":var i=n.attr("data-rowsarray").split(",");r.each(i,function(e,r){CAICUI.render.pushContext[t[0]].data[0].items[e].myChecked=!1}),CAICUI.render.pushContext[t[0]].data[0].items[t[1]].myChecked=s;break;case"matrixCheckbox":CAICUI.render.pushContext[t[0]].data[0].items[t[1]].myChecked=s}},questionsOptionKeyup:function(e){e.preventDefault();var r=CAICUI.iGlobal.getThat(e),t=r.attr("data-number").split("-"),s=r.children().val();"multiTask"==CAICUI.render.questionsType?this.changeMultiTaskQuestionsDataKeyup(CAICUI.render.pushContext[t[0]].type,t,s,r):this.changeQuestionsDataKeyup(CAICUI.render.questionsType,t,s,r)},changeQuestionsDataKeyup:function(e,r,t,s){switch(e){case"blank":case"question":CAICUI.render.pushContext[r[1]].myBlank=t;break;case"matrixQuestion":case"matrixBlank":CAICUI.render.pushContext[0].items[r[1]].myBlank=t}},changeMultiTaskQuestionsDataKeyup:function(e,r,t,s){switch(e){case"blank":case"question":CAICUI.render.pushContext[r[0]].data[0].myBlank=t;break;case"matrixQuestion":CAICUI.render.pushContext[0].items[r[1]].myBlank=t;break;case"matrixBlank":CAICUI.render.pushContext[r[0]].data[0].items[r[1]].myBlank=t}},questionsStatus:function(e){if("multiTask"==CAICUI.render.questionsType){var t=0;r.each(CAICUI.render.pushContext,function(e,r){CAICUI.render.this.questionsStatusMultiTask(e.type,r)&&t++}),t==CAICUI.render.pushContext.length?CAICUI.render.status=1:CAICUI.render.status=2}else{var s=CAICUI.render.this.questionsStatusOther(CAICUI.render.questionsType);CAICUI.render.status=s?1:2}e&&e()},questionsStatusMultiTask:function(e,t){var s="",n=CAICUI.render.pushContext;if("matrixRadio"==e){s=!0;var i=0,a=0,d=0;r.each(n[t].data[0].items,function(e,r){e.isChecked&&(a++,e.myChecked&&d++)}),s=a==d,d&&(CAICUI.render.isMyChecked=!0)}else if("matrixCheckbox"==e){s=!0;i=0,a=0,d=0;r.each(n[t].data[0].items,function(e,r){e.isChecked&&e.myChecked&&i++,e.isChecked&&a++,e.myChecked&&d++}),s=d==a&&!(!a||!i||a!=i),d&&(CAICUI.render.isMyChecked=!0)}else if("radio"==e)s=!0,r.each(n[t].data,function(e,r){e.isChecked&&(s=!!e.myChecked),e.myChecked&&(CAICUI.render.isMyChecked=!0)});else if("checkbox"==e){s=!0;i=0,a=0,d=0;r.each(n,function(e,r){e.isChecked&&e.myChecked&&i++,e.isChecked&&a++,e.myChecked&&(d++,CAICUI.render.isMyChecked=!0)}),s=d==a&&!(!a||!i||a!=i)}else if("blank"==e){var o=(C=n[t].data[0]).blank;s=o==C.myBlank,C.myBlank&&(CAICUI.render.isMyChecked=!0)}else if("question"==e){var C;o=(C=n[t].data[0]).blank;s=!!C.myBlank,C.myBlank&&(CAICUI.render.isMyChecked=!0)}else"matrixBlank"==e&&(s=!0,r.each(n[t].data[0].items,function(e,r){var t=e.blank;t&&(s=t==e.myBlank),e.myBlank&&(CAICUI.render.isMyChecked=!0)}));return s},questionsStatusOther:function(e){var t="",s=CAICUI.render.pushContext;if("radio"==e)t=!0,r.each(s,function(e,r){e.isChecked&&(t=!!e.myChecked),e.myChecked&&(CAICUI.render.isMyChecked=!0)});else if("checkbox"==e){t=!0;var n=0,i=0,a=0;r.each(s,function(e,r){e.isChecked&&e.myChecked&&n++,e.isChecked&&i++,e.myChecked&&(a++,CAICUI.render.isMyChecked=!0)}),t=a==i&&!(!i||!n||i!=n)}else if("blank"==e){var d=s[0].blank;t=d==s[0].myBlank,s[0].myBlank&&(CAICUI.render.isMyChecked=!0)}else if("question"==e){d=s[0].blank;t=!!s[0].myBlank,s[0].myBlank&&(CAICUI.render.isMyChecked=!0)}else if("matrixRadio"==e){t=!0;n=0,i=0,a=0;r.each(s[0].items,function(e,r){e.isChecked&&(i++,e.myChecked&&a++)}),t=i==a,a&&(CAICUI.render.isMyChecked=!0)}else if("matrixCheckbox"==e){t=!0;n=0,i=0,a=0;r.each(s[0].items,function(e,r){e.isChecked&&e.myChecked&&n++,e.isChecked&&i++,e.myChecked&&a++}),t=a==i&&!(!i||!n||i!=n),a&&(CAICUI.render.isMyChecked=!0)}else"matrixBlank"==e&&(t=!0,r.each(s[0].items,function(e,r){var s=e.blank;s&&(t=s==e.myBlank),e.myBlank&&(CAICUI.render.isMyChecked=!0)}));return t},removeAnimate:function(r){e("#animate").animate({height:"0",top:"50%"},300,function(){e("#animate").remove(),r&&r()})},toggleCards:function(r){var t=CAICUI.iGlobal.getThat(r);CAICUI.render.cardOpen?(CAICUI.render.cardOpen=!1,t.removeClass("active"),e("body .questions-cards").removeClass("active"),t.find(".questions-card-span").text("展开答题卡")):(CAICUI.render.cardOpen=!0,t.addClass("active"),e("body .questions-cards").addClass("active"),t.find(".questions-card-span").text("收起答题卡"))},exit:function(){this.exitMsg(function(){CAICUI.render.this.$el.find("#studycenter-video").remove(),CAICUI.render.cardOpen=!1,CAICUI.render.ExerciseTotalTime=0,CAICUI.render.errorNum=0,CAICUI.render.exerciseCount=0,CAICUI.render.exerciseDoneCount=0,CAICUI.render.exerciseNoDoneCount=0,CAICUI.render.exerciseRightCount=0,CAICUI.render.examenNum=0,CAICUI.render.myExamContinue={},CAICUI.render.viewResolution=!1,CAICUI.render.this.removeAnimate(function(){})})},exitMsg:function(e){clearInterval(CAICUI.render.timer),CAICUI.render.this.undelegateEvents(),s.msg("已记录您本章的练习进度",{time:1e3},function(){e&&e()})},clearInitData:function(){CAICUI.render.this.$el.find("#studycenter-video").remove(),clearInterval(CAICUI.render.timer),CAICUI.render.this.undelegateEvents(),CAICUI.render.cardOpen=!1,CAICUI.render.ExerciseTotalTime=0,CAICUI.render.errorNum=0,CAICUI.render.exerciseCount=0,CAICUI.render.exerciseDoneCount=0,CAICUI.render.exerciseNoDoneCount=0,CAICUI.render.exerciseRightCount=0,CAICUI.render.examenNum=0,CAICUI.render.myExamContinue={},CAICUI.render.viewResolution=!1},clockTime:function(){CAICUI.render.timer=null;var e=CAICUI.render.ExerciseTotalTime,r=this.$el.find(".questions-times");function t(e){var t=parseInt(e),s=Math.floor(t/86400),n=Math.floor((t-24*s*60*60)/3600),i=Math.floor((t-24*s*60*60-3600*n)/60),a=Math.floor(t-24*s*60*60-3600*n-60*i);return n<10&&(n="0"+n),i<10&&(i="0"+i),a<10&&(a="0"+a),r.text(n+":"+i+":"+a),t}t(e),CAICUI.render.timer=setInterval(function(){e++,CAICUI.render.ExerciseTotalTime=t(e)},1e3)},questionsLoaderContent:function(){var r=e("#template-questions-exam-loader-content").html(),t=CAICUI.iGlobal.getTemplate(r);e("body .questions-body #scroller").append(t)},getExerciseId:function(e){CAICUI.Request.ajax({server:"getExerciseBaseInfo",data:{examenId:CAICUI.render.knowledgepointid},done:function(r){CAICUI.render.exerciseBaseInfo=r.data,e&&e(r.data)}})},createIframe:function(){var r=e("<iframe>");"http://localhost:3000"==window.location.origin?e(r).attr("src",CAICUI.Common.host.demoName+"/upload/caicui_cache/exercise/"+CAICUI.render.exerciseFilename):e(r).attr("src",window.location.origin+"/upload/caicui_cache/exercise/"+CAICUI.render.exerciseFilename),e(r).attr("name","iframe_name"),e(r).attr("id","iframe_name"),e("body .questions").append(r)},getIframeData:function(r){var t=[];e("#iframe_name").load(function(){var s=e("body").find("#iframe_name").contents().find("body").html();t=s.split("<\/script>").length>1?e.trim(s.split("<\/script>").slice(2)[0].split(",")).split(","):e.trim(s).split(","),r&&r(t)})},optionRegExpTest:function(e){var r=!1;if(e){var t=e.slice(0,2),s=e.slice(2);"选项"==t&&(r=new RegExp("点击这里编辑").test(s))}return r},openSidebar:function(r){CAICUI.render.cardOpen&&e("body .questions-card-button").trigger("click"),e("body .questions-cards").removeClass("active");var t=CAICUI.iGlobal.getThat(r).attr("data-control"),s=(e(this).index(),e("body .studycenter-video-main-right .questions-type-"+t));"hidden"==s.attr("data-display")?(e("body .right-questions-item-count").text(+CAICUI.render.questionsIndex+1),"note"==t?this.showNode():"quiz"==t&&this.showQuestions(),e("body .studycenter-video-right").addClass("hidden"),s.removeClass("hidden"),e("body .studycenter-video-right").attr("data-display","hidden"),s.attr("data-display","show"),e("body .questions-body-context").css({"padding-right":410}),e("body .studycenter-video-main-right").css({right:0})):(e("body .questions-body-context").css({"padding-right":168}),e("body .studycenter-video-main-right").css({right:-410}),s.addClass("hidden"),s.attr("data-display","hidden"))},animateSidebar:function(r,t){e("body .questions-body-context").css({"padding-right":r}),e("body .studycenter-video-main-right").css({right:-(410-r)})},closeSidebar:function(){e("body .studycenter-video-right").siblings().addClass("hidden"),this.animateSidebar(0,500)},showQuestions:function(){e("#ac-new-video").attr("src","script/libs/xneditor/ac-new-video.html")},showNode:function(){e("body .node-editor-textarea").val(""),e("body .add-photo-show").remove()},nodeEditorIsOpenButton:function(e){var r=CAICUI.iGlobal.getThat(e),t=r.prev();r.hasClass("active")?(r.removeClass("active"),t.text("私有"),CAICUI.render.isPublic=1):(r.addClass("active"),t.text("公开"),CAICUI.render.isPublic=0)},uploadFormFile:function(){CAICUI.iGlobal.fileUpload({formClass:"uploadForm"},function(e){CAICUI.iGlobal.fileUploadAddList("uploadForm",e)})},nodeEditorConfirm:function(){var r=e("body #node-editor-textarea").val();if(!r)return s.msg("Sorry~ 请输入内容！",function(){}),!1;if(CAICUI.render.imgPath="",CAICUI.render.imgPathArray.length)for(var t=0;t<CAICUI.render.imgPathArray.length;t++)CAICUI.render.imgPath+=t?","+CAICUI.render.imgPathArray[t]:CAICUI.render.imgPathArray[t];else CAICUI.render.imgPath="";CAICUI.Request.ajax({server:"nodesave",data:{token:CAICUI.User.token,id:"",content:r,clientType:CAICUI.render.clientType,title:CAICUI.render.chapterName,isPublic:CAICUI.render.isPublic,courseId:CAICUI.render.courseId,subjectId:CAICUI.render.subjectId,categoryId:CAICUI.render.categoryId,chapterId:CAICUI.render.chapterId,subjectName:CAICUI.render.subjectName,categoryName:CAICUI.render.categoryName,courseName:CAICUI.render.courseName,chapterName:CAICUI.render.chapterName,taskId:CAICUI.render.exerciseId,taskName:CAICUI.render.exerciseId,taskProgress:+CAICUI.render.questionsIndex+1+"题",imgPath:CAICUI.render.imgPath,clientType:"pc"},done:function(r){"success"==r.state&&s.msg("保存成功！",{shade:!0,icon:1,time:500},function(){CAICUI.render.this.closeSidebar(),e("body .right-title-input").val("")})},fail:function(e){s.msg("Sorry~ 笔记保存失败",function(){})}})},addPhotoRemove:function(r){for(var t=CAICUI.iGlobal.getThat(r),s=(t.prev(),t.attr("data-src")),n=0;n<CAICUI.render.imgPathArray.length;n++)if(CAICUI.render.imgPathArray[n]==s){CAICUI.render.imgPathArray.splice(n,1);break}t.parent().remove(),e("body .add-photo-show").length<5&&e("body #uploadForm").show()},viewOther:function(e){var r=CAICUI.iGlobal.getThat(e).attr("link");this.exitMsg(function(){window.location.hash=r})}})});