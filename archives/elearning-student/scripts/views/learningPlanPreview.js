define(["jquery","underscore","backbone","views/courseDetail"],function(e,r,n,a){"use strict";return n.View.extend({tagName:"div",className:"learning-plan-preview-main",template:r.template(e("#template-learning-plan-preview").html()),events:{"click .learning-plan-preview-nav-a":"learningPlanPreviewChange","click .js-learning-plan-preview-close":"learningPlanPreviewClose"},type:"",render:function(r){CAICUI.render.thisLearningPreview=this,CAICUI.render.planPreviewList=r,this.$el.html(this.template({plansData:r})),CAICUI.render.previewAjaxTotal=r.length,CAICUI.render.previewAjaxNum=0,CAICUI.render.previewInterval="",CAICUI.render.previewCourseDetailRenderData=[],CAICUI.render.previewCourseTasksTotalNum=0,CAICUI.render.previewCourseTimeTotalNum=0;for(var n=0;n<r.length;n++)CAICUI.render.previewCourseDetailRenderData.push({courseId:r[n].courseId,weekList:"",chapters:"",isPreview:!0}),this.previewRender(this,n);return CAICUI.render.previewInterval=setInterval(function(){if(CAICUI.render.previewAjaxTotal==CAICUI.render.previewAjaxNum){clearInterval(CAICUI.render.previewInterval);for(var r=0;r<CAICUI.render.previewCourseDetailRenderData.length;r++)CAICUI.render.courseDetail=new a,e("body .learning-plan-preview-item-"+(r+1)).html(CAICUI.render.courseDetail.render(CAICUI.render.previewCourseDetailRenderData[r]).el);e("body .learning-plan-preview-courseTimeTotalNum").html(CAICUI.iGlobal.formatSeconds(CAICUI.render.previewCourseTimeTotalNum,"h")),e("body .learning-plan-preview-courseTasksTotalNum").html(CAICUI.render.previewCourseTasksTotalNum),window.CAICUI.myScrollLearningPlanPreview=CAICUI.iGlobal.iScroll("body #wrapper-learning-plan-Preview")}},300),this},getPreviewAjax:function(e,r){CAICUI.Request.ajax({server:"getPreview",data:{token:CAICUI.User.token,planIds:e.planId,examinationDate:CAICUI.iGlobal.getDate(e.examinationDate,"-"),activeTime:CAICUI.iGlobal.getDate(e.activeTime,"-")},done:function(e){r&&r(e.data)},fail:function(e){}})},courseDetailAjax:function(e,r){CAICUI.Request.ajax({server:"courseDetail",data:{courseId:e},done:function(e){r&&r(e.data[0].chapters)},fail:function(e){}})},previewRender:function(r,n){var i=CAICUI.render.planPreviewList[n];CAICUI.render.planPreviewList[n].isRender?setTimeout(function(){CAICUI.render.courseDetail=new a,e("body .learning-plan-preview-item-"+(n+1)).html(CAICUI.render.courseDetail.render({courseId:i.courseId,weekList:CAICUI.render.weekListData,chapters:CAICUI.render.previewCourseDetailData}).el),window.CAICUI.myScrollLearningPlanPreview=CAICUI.iGlobal.iScroll("body #wrapper-learning-plan-Preview")},300):r.getPreviewAjax(i,function(e){CAICUI.render.previewCourseDetailRenderData[n].weekList=e,r.courseDetailAjax(i.courseId,function(e){CAICUI.render.previewCourseDetailRenderData[n].chapters=e,CAICUI.render.previewAjaxNum++})})},learningPlanPreviewChange:function(r){var n=CAICUI.iGlobal.getThat(r),a=n.index();n.siblings().removeClass("active"),n.addClass("active");var i=e("body .learning-plan-preview-item");i.siblings().removeClass("active"),i.eq(a).addClass("active"),window.CAICUI.myScrollLearningPlanPreview.refresh()},learningPlanPreviewClose:function(){CAICUI.render.planPreviewList=[],CAICUI.render.learningPlanPreview?CAICUI.render.learningPlanPreview.remove():e("body .learning-plan-preview-main").remove()}})});