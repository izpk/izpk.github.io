define(["jquery","underscore","backbone","layer"],function(e,n,t,a){"use strict";var o=t.View.extend({el:"body",template:n.template(e("#template-login").html()),events:{"click #login":"loginClick"},render:function(e){window.location.href=CAICUI.Common.loginLink,this.$el.html(this.template()),CAICUI.render.$this=this,CAICUI.render.$prePage=e},loginClick:function(e){CAICUI.iGlobal.getThat(e);this.login()},getToken:function(e){CAICUI.Request.ajax({server:"token",done:function(n){e(n)},fail:function(n){CAICUI.render.$this.getToken(e)}})},login:function(){this.getToken(function(n){CAICUI.Request.ajax({server:"login",data:{account:e("#name").val(),password:e("#password").val(),token:n.data.token},done:function(n){window.localStorage.clear();var t='{"memberId":"'+n.data.memberId+'","nickname":"'+n.data.nickName+'","nickName":"'+n.data.nickName+'","token":"'+n.data.token+'","avatar":"'+n.data.avatar+'"}';e.cookie("User",t,{path:"/",expires:36500}),e.cookie("loginInfo",t,{path:"/",expires:36500}),CAICUI.CACHE={},CAICUI.render.$this.undelegateEvents(),window.CAICUI.User=JSON.parse(t),window.location.hash="#studycenterIndex"},fail:function(e){a.msg("Sorry~ 登陆失败",function(){})}})})}});return o});