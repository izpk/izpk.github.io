define(["jquery","underscore","backbone"],function(e,t,n){"use strict";var s=n.View.extend({el:"body #right",template:t.template(e("#template-course-activated").html()),events:{"mouseenter .studyin-content-subjects":"subjectEnter","mouseleave .studyin-content-subjects":"subjectLeave","click .studyin-content-subjects":"subjectClick","click .studyin-content-header":"iconClick","click .studyin-type":"typeClick"},render:function(){CAICUI.render.$this=this,this.expirationcourse(function(t){CAICUI.render.$this.$el.html(CAICUI.render.$this.template({data:t})),e(".current-progress").each(function(){var t=e(this),n=parseInt(t.attr("data-progress"));n&&(t.addClass("active"),t.animate({width:n},1e3))}),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper")})},expirationcourse:function(e){CAICUI.Request.ajax({server:"expirationcourse",data:{token:CAICUI.User.token,pageNo:0,pageSize:CAICUI.defaultPageSize},done:function(n){for(var s=n.data.courselist,i=t.chain(s).map(function(e){return e.categoryName}).uniq().value(),a=t.chain(s).map(function(e){return e.categoryIndex}).uniq().value(),c=[],r=0;r<i.length;r++)c.push({categoryName:i[r],categoryIndex:a[r],list:[]}),t.each(s,function(e,t,n){e.categoryName==i[r]&&(c&&c[r]&&c[r].list?c[r].list.push(e):c[r].list=[e])});for(var r=0;r<c.length;r++){c[r].newList=[];for(var u=c[r].list,o=t.chain(u).map(function(e){return e.subjectName}).uniq().value(),l=t.chain(u).map(function(e){return e.subjectIndex}).uniq().value(),d=0;d<o.length;d++)c[r].newList.push({subjectName:o[d],subjectIndex:l[d],list:[]}),t.each(c[r].list,function(e,n,s){if(e.subjectName==o[d])if(c[r].newList[d].list){var i=!0;t.each(c[r].newList[d].list,function(t,n,s){e.courseId==t.courseId&&(i=!1)}),i&&c[r].newList[d].list.push(e)}else c[r].newList[d].list=[e]})}var c=t.sortBy(c,"categoryIndex");t.each(c,function(e,n){c[n].newList=t.sortBy(e.newList,"subjectIndex"),t.each(c[n].newList,function(e,s){c[n].newList[s].list=t.sortBy(e.list,"courseIndex")})}),console.log(c),e({courseListNav:i,courseLists:c})},fail:function(t){e({courseListNav:{},courseLists:{}})}})},subjectEnter:function(t){var n=t.currentTarget,s=e(n),i=(s.index(),s.find(".subject-lf").find(".subject-mask")),a=s.find(".subject-rt");i.stop(!0,!1).animate({left:"0"});var c={mask:i,rt:a};return c},subjectLeave:function(e){var t=this.subjectEnter(e).mask;t.stop(!0,!1).animate({left:"-160px"})},subjectClick:function(e){var t=this.subjectEnter(e).rt;t.parent().parent().addClass("active").siblings().removeClass("active")},iconClick:function(t){var n=t.currentTarget,s=e(n);s.find(".subject-type-rt").toggleClass("stop"),s.next(".studyin-content-subject").toggleClass("stop"),CAICUI.myScroll.refresh()},typeClick:function(t){var n=t.currentTarget,s=e(n),i=s.index();s.addClass("active").siblings().removeClass("active"),e(".studyin-contents").removeClass("active").eq(i).addClass("active"),CAICUI.myScroll.refresh()}});return s});