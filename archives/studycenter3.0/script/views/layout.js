define(["jquery","underscore","backbone","views/message","views/message-list","views/message-desc"],function(e,t,i,a,s,n){"use strict";var o=i.View.extend({el:"body",template:t.template(e("#template-layout").html()),events:{"mouseenter .nav":"navEnter","mouseleave .nav":"navLeave","click .nav-li":"addActive","click .exit":"exitOptionShow","click .message":"messageShow","click .message-list-li":"messageListLi","click .message-close":"messageClose","click .sign-out":"signOut","click .js-pagination-li":"paginationChange","click .js-pagination-prev":"paginationPrev","click .js-pagination-next":"paginationNext"},render:function(e){this.$el.find("#layout").length&&this.$el.find("#layout").remove(),this.$el.html(this.template({nav:e})),CAICUI.render.navAnimateTime=250,CAICUI.render.$this=this,CAICUI.render.pageNo=1,CAICUI.render.pageSize=20,CAICUI.render.$layout=this.$("#layout"),this.$messageMain=this.$(".message-main"),this.$exitOption=this.$(".exit-option")},signOut:function(t){CAICUI.iGlobal.getThat(t);CAICUI.Request.ajax({server:"logout",data:{token:CAICUI.User.token},done:function(t){window.localStorage.clear(),e.removeCookie("User",{path:"/"}),e.removeCookie("loginInfo",{path:"/"}),e.removeCookie("Token",{path:"/"}),e.removeCookie("token",{path:"/",expires:-1}),CAICUI.isNav=!0,window.location.href=CAICUI.Common.loginLink},fail:function(t){window.localStorage.clear(),e.removeCookie("User",{path:"/"}),e.removeCookie("loginInfo",{path:"/"}),e.removeCookie("Token",{path:"/"}),e.removeCookie("token",{path:"/",expires:-1}),CAICUI.isNav=!0,window.location.href=CAICUI.Common.loginLink}})},messageList:function(e){CAICUI.Request.ajax({server:"message-list",data:{token:CAICUI.User.token,type:1,pageNo:CAICUI.render.pageNo,pageSize:CAICUI.render.pageSize},done:function(t){e(t)},fail:function(t){e({})}})},messageRender:function(){var e=new a;this.$(".message-content").html(e.render().el),this.$messageLeftContent=this.$(".message-left-content"),this.$messageListContent=this.$("#scroller-message-list"),this.$messageRight=this.$(".message-right")},messageListRender:function(){var e=this;this.messageList(function(t){var i=new s;e.$messageLeftContent.html(i.render({data:{messageList:t.data,pageNo:t.pageNo,pageSize:t.pageSize,totalCount:t.totalCount}}).el),window.CAICUI.scrollMessageList=CAICUI.iGlobal.iScroll("body #wrapper-message-list")})},messageListLi:function(e){function t(){console.log(this.y)}var i=this.getThat(e);i.siblings().removeClass("active"),i.addClass("active");var a=JSON.parse(i.children().attr("data-content")),s=new n;this.$messageRight.html(s.render(a).el),console.log(s.render(a).el),window.CAICUI.messageDesc=new IScroll("body #wrapper-message-desc",{probeType:3,mouseWheel:!0,scrollbars:"custom"}),window.CAICUI.messageDesc.on("scroll",t),document.addEventListener("touchmove",function(e){e.preventDefault()},!1)},getThat:function(t){return e(t.currentTarget)},addActive:function(e){var t=CAICUI.iGlobal.getThat(e);t.siblings().removeClass("active").end().addClass("active")},navEnter:function(){this.$(".main").stop(!0,!1).animate({"padding-left":"180px"},CAICUI.render.navAnimateTime),this.$(".left").stop(!0,!1).animate({width:"180px"},CAICUI.render.navAnimateTime,function(){})},navLeave:function(){this.$(".main").stop(!0,!1).animate({"padding-left":"60px"},CAICUI.render.navAnimateTime),this.$(".left").stop(!0,!1).animate({width:"60px"},CAICUI.render.navAnimateTime,function(){})},exitOptionShow:function(e){this.getThat(e);this.$exitOption.toggleClass("active")},messageShow:function(e){var t=this;this.$messageMain.hasClass("active")?this.$messageMain.addClass("active"):(this.$messageMain.addClass("active"),this.messageRender(),t.messageListRender())},messageClose:function(e){var t=this.getThat(e);t.parents(".message-main").removeClass("active")},paginationChange:function(t){CAICUI.iGlobal.loading("body #scroller-message-list",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh();var i=CAICUI.iGlobal.getThat(t);CAICUI.render.pageNo=i.attr("data-pageno"),this.messageListRender()},paginationPrev:function(t){this.pageNo>1&&(CAICUI.iGlobal.loading("body #scroller-message-list",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=CAICUI.render.pageNo--,this.messageListRender())},paginationNext:function(t){this.pageNo<this.pageTotal-1&&(CAICUI.iGlobal.loading("body #scroller-message-list",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=CAICUI.render.pageNo++,this.messageListRender())}});return o});