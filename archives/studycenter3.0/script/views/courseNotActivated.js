define(["jquery","underscore","backbone","layer"],function(e,t,c,n){"use strict";var s=c.View.extend({el:"body #right",template:t.template(e("#template-course-notActivated").html()),events:{"mouseenter .studyin-content-subjects":"subjectEnter","mouseleave .studyin-content-subjects":"subjectLeave","click .studyin-content-subjects":"subjectClick","click .studyin-content-header":"iconClick","click .studyin-type":"typeClick","click .js-course-notActivated":"acivated","click .ca-btn-no":"closeAcivated","click .ca-btn-ok":"caBtnOk"},render:function(){CAICUI.render.$this=this,CAICUI.render.closeActbut="",CAICUI.render.courseId="",CAICUI.render.orderItemId="",CAICUI.render.isU="",CAICUI.render.title="",CAICUI.render.effectiveDay="",this.noActivecourse(function(t){CAICUI.render.$this.$el.html(CAICUI.render.$this.template({data:t})),e(".current-progress").each(function(){var t=e(this),c=parseInt(t.attr("data-progress"));c&&(t.addClass("active"),t.animate({width:c},1e3))}),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper")})},noActivecourse:function(e){CAICUI.Request.ajax({server:"noActivecourse",data:{token:CAICUI.User.token,pageNo:0,pageSize:CAICUI.defaultPageSize},done:function(c){for(var n=c.data.courselist,s=t.chain(n).map(function(e){return e.categoryName}).uniq().value(),a=t.chain(n).map(function(e){return e.categoryIndex}).uniq().value(),i=[],r=0;r<s.length;r++)i.push({categoryName:s[r],categoryIndex:a[r],list:[]}),t.each(n,function(e,t,c){e.categoryName==s[r]&&(i&&i[r]&&i[r].list?i[r].list.push(e):i[r].list=[e])});for(var r=0;r<i.length;r++){i[r].newList=[];for(var o=i[r].list,l=t.chain(o).map(function(e){return e.subjectName}).uniq().value(),u=t.chain(o).map(function(e){return e.subjectIndex}).uniq().value(),d=0;d<l.length;d++)i[r].newList.push({subjectName:l[d],subjectIndex:u[d],list:[]}),t.each(i[r].list,function(e,c,n){if(e.subjectName==l[d])if(i[r].newList[d].list){var s=!0;t.each(i[r].newList[d].list,function(t,c,n){e.courseId==t.courseId&&(s=!1)}),s&&i[r].newList[d].list.push(e)}else i[r].newList[d].list=[e]})}var i=t.sortBy(i,"categoryIndex");t.each(i,function(e,c){i[c].newList=t.sortBy(e.newList,"subjectIndex"),t.each(i[c].newList,function(e,n){i[c].newList[n].list=t.sortBy(e.list,"courseIndex")})}),console.log(i),e({courseListNav:s,courseLists:i})},fail:function(t){e({courseListNav:{},courseLists:{}})}})},subjectEnter:function(t){var c=t.currentTarget,n=e(c),s=(n.index(),n.find(".subject-lf").find(".subject-mask")),a=n.find(".subject-rt");s.stop(!0,!1).animate({left:"0"});var i={mask:s,rt:a};return i},subjectLeave:function(e){var t=this.subjectEnter(e).mask;t.stop(!0,!1).animate({left:"-160px"})},subjectClick:function(e){var t=this.subjectEnter(e).rt;t.parent().parent().addClass("active").siblings().removeClass("active")},iconClick:function(t){var c=t.currentTarget,n=e(c);n.find(".subject-type-rt").toggleClass("stop"),n.next(".studyin-content-subject").toggleClass("stop"),CAICUI.myScroll.refresh()},typeClick:function(t){var c=t.currentTarget,n=e(c),s=n.index();n.addClass("active").siblings().removeClass("active"),e(".studyin-contents").removeClass("active").eq(s).addClass("active"),CAICUI.myScroll.refresh()},courseActive:function(t){CAICUI.Request.ajax({server:"active",data:{token:t.token,courseId:t.courseId,isU:t.isU,orderItemId:t.orderItemId,examTime:t.examTime},done:function(t){"success"==t.state?(e(".layui-layer-shade").remove(),window.location.hash="#courseStudy/"+CAICUI.render.courseId):console.log(t)},fail:function(e){n.msg("Sorry~ 课程激活失败！",function(){})}})},acivated:function(c){var s=CAICUI.iGlobal.getThat(c);CAICUI.render.courseId=s.attr("data-courseid"),CAICUI.render.orderItemId=s.attr("data-orderitemid"),CAICUI.render.isU=s.attr("data-isu"),CAICUI.render.title=s.attr("data-title"),CAICUI.render.effectiveDay=s.attr("data-effectiveday"),e(".ca-select select option").each(function(){e(this).remove()}),CAICUI.Request.ajax({server:"timeList",data:{token:CAICUI.User.token,courseId:CAICUI.render.courseId},done:function(c){console.log(c),c.data&&c.data.length>0?(e(".ca-select").css("display",""),e(".ca-select select").append("<option value='0'>选择考试时间</option>"),t.each(c.data,function(t,c){e(".ca-select select").append("<option value='"+CAICUI.iGlobal.getLocalTime(t.time)+"'>"+CAICUI.iGlobal.getLocalTime(t.time)+"</option>")}),e(".ca-select").css("opacity","1"),e(".form-control").css({display:"block"})):(e(".ca-select select").append("<option value='0'>选择考试时间</option>"),e(".ca-select select").append("<option value='-1' selected>"+CAICUI.iGlobal.getLocalTime(0)+"</option>"),e(".ca-select").css({opacity:"0"}),e(".form-control").css({display:"none"}))}}),CAICUI.render.closeActbut=n.open({type:1,title:["课程激活","background: #ffffff; height: 48px; font-size: 16px; color: #4d4d4d; line-height: 48px;"],shade:!0,scrollbar:!1,skin:"layui-skin",area:["500px","auto"],content:e("#courseActivation"),success:function(){e(".layui-layer-shade").css("filter","alpha(opacity=50)"),e(".ca-h3 font").html("&nbsp;"+CAICUI.render.title),e(".ca-checkbox label input").prop("checked",""),e(".effectiveDay").text(CAICUI.render.effectiveDay)}})},closeAcivated:function(){n.close(CAICUI.render.closeActbut)},caBtnOk:function(){if(e(".ca-checkbox label input").is(":checked")){var t=e("select.form-control").val();if(0==t)return n.msg("请选择考试时间",function(){}),!1;"-1"==t&&(t="");var c={token:CAICUI.User.token,courseId:CAICUI.render.courseId,isU:CAICUI.render.isU,orderItemId:CAICUI.render.orderItemId,examTime:t};this.courseActive(c)}else n.msg("请确认激活",function(){})}});return s});