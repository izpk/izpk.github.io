define(["jquery","underscore","backbone"],function(e,t,s){"use strict";var n=s.View.extend({el:"body #right",template:t.template(e("#template-course-studyIn").html()),events:{"mouseenter .studyin-content-subjects":"subjectEnter","mouseleave .studyin-content-subjects":"subjectLeave","click .studyin-content-subjects":"subjectClick","click .studyin-content-header":"iconClick","click .studyin-type":"typeClick"},render:function(){CAICUI.render.$this=this,this.learningcourse(function(t){CAICUI.render.$this.$el.html(CAICUI.render.$this.template({data:t})),e(".current-progress").each(function(){var t=e(this),s=parseInt(t.attr("data-progress"));s&&(t.addClass("active"),t.animate({width:s},1e3))}),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper")})},learningcourse:function(e){if(CAICUI.CACHE.Learningcourse&&CAICUI.CACHE.Learningcourse.length){var t=this.filterLearningcourseData(CAICUI.CACHE.Learningcourse);e({courseListNav:t.courseListNav,courseLists:t.courseLists})}else CAICUI.Request.ajax({server:"learningcourse",data:{token:CAICUI.User.token,pageNo:0,pageSize:CAICUI.defaultPageSize},done:function(t){CAICUI.CACHE.Learningcourse=t.data.courselist,CAICUI.CACHE.RecentCourse=t.data.courselist.slice(0,2);var s=CAICUI.render.$this.filterLearningcourseData(CAICUI.CACHE.Learningcourse);e({courseListNav:s.courseListNav,courseLists:s.courseLists})},fail:function(t){e({courseListNav:{},courseLists:{}})}})},filterLearningcourseData:function(e){for(var s=e,n=t.chain(s).map(function(e){return e.categoryName}).uniq().value(),r=t.chain(s).map(function(e){return e.categoryIndex}).uniq().value(),i=[],a=0;a<n.length;a++)i.push({categoryName:n[a],categoryIndex:r[a],list:[]}),t.each(s,function(e,t,s){e.categoryName==n[a]&&(i&&i[a]&&i[a].list?i[a].list.push(e):i[a].list=[e])});for(var a=0;a<i.length;a++){i[a].newList=[];for(var c=i[a].list,u=t.chain(c).map(function(e){return e.subjectName}).uniq().value(),o=t.chain(c).map(function(e){return e.subjectIndex}).uniq().value(),l=0;l<u.length;l++)i[a].newList.push({subjectName:u[l],subjectIndex:o[l],list:[]}),t.each(i[a].list,function(e,s,n){if(e.subjectName==u[l])if(i[a].newList[l].list){var r=!0;t.each(i[a].newList[l].list,function(t,s,n){e.courseId==t.courseId&&(r=!1)}),r&&i[a].newList[l].list.push(e)}else i[a].newList[l].list=[e]})}var i=t.sortBy(i,"categoryIndex");return t.each(i,function(e,s){i[s].newList=t.sortBy(e.newList,"subjectIndex"),t.each(i[s].newList,function(e,n){i[s].newList[n].list=t.sortBy(e.list,"courseIndex")})}),console.log(i),{courseListNav:n,courseLists:i}},subjectEnter:function(t){var s=t.currentTarget,n=e(s),r=(n.index(),n.find(".subject-lf").find(".subject-mask")),i=n.find(".subject-rt");r.stop(!0,!1).animate({left:"0"});var a={mask:r,rt:i};return a},subjectLeave:function(e){var t=this.subjectEnter(e).mask;t.stop(!0,!1).animate({left:"-160px"})},subjectClick:function(e){var t=this.subjectEnter(e).rt;t.parent().parent().addClass("active").siblings().removeClass("active")},iconClick:function(t){var s=t.currentTarget,n=e(s);n.find(".subject-type-rt").toggleClass("stop"),n.next(".studyin-content-subject").toggleClass("stop"),CAICUI.myScroll.refresh()},typeClick:function(t){var s=t.currentTarget,n=e(s),r=n.index();n.addClass("active").siblings().removeClass("active"),e(".studyin-contents").removeClass("active").eq(r).addClass("active"),CAICUI.myScroll.refresh()}});return n});