define(["jquery","underscore","backbone","views/exam-list","layer"],function(e,a,t,r,i){"use strict";var n=t.View.extend({el:"body #right",template:a.template(e("#template-my-exam").html()),events:{"click body":"layout","click .js-pagination-li":"paginationChange","click .js-pagination-prev":"paginationPrev","click .js-pagination-next":"paginationNext"},render:function(){CAICUI.render.$this=this,CAICUI.render.pageNo=1,CAICUI.render.pageSize=20,this.examList(function(e){CAICUI.render.$this.$el.html(CAICUI.render.$this.template(e)),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper"),window.CAICUI.examTypeScroll=CAICUI.iGlobal.iScroll("body #wrapper-exam-type")})},examList:function(e){CAICUI.Request.ajax({server:"exam-list",data:{token:CAICUI.User.token,pageNo:CAICUI.render.pageNo,pageSize:CAICUI.render.pageSize},done:function(t){console.log(t);for(var r=CAICUI.iGlobal.getDate((new Date).getTime()),i=t.data,n=a.chain(i).map(function(e){return CAICUI.iGlobal.getDate(e.testTime)}).uniq().value(),o=[],l=0;l<n.length;l++){var C=n[l]==r?"TODAY":n[l];o.push({testTime:C,list:[]}),a.each(t.data,function(e,a,t){CAICUI.iGlobal.getDate(e.testTime)==n[l]&&(o&&o[l]&&o[l].list?o[l].list.push(e):o[l].list=[e])})}e({data:{examList:o,pageNo:t.pageNo,pageSize:t.pageSize,totalCount:t.totalCount}})},fail:function(a){e({data:{examList:{},pageNo:1,pageSize:20,totalCount:0}})}})},paginationChange:function(a){CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh();var t=CAICUI.iGlobal.getThat(a);CAICUI.render.pageNo=t.attr("data-pageno"),this.examList(function(a){var t=new r;e("body #scroller").html(t.render(a).el),window.CAICUI.myScroll.refresh()})},paginationPrev:function(a){CAICUI.render.pageNo>1&&(CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=+CAICUI.render.pageNo-1,this.examList(function(a){var t=new r;e("body #scroller").html(t.render(a).el),window.CAICUI.myScroll.refresh()}))},paginationNext:function(a){CAICUI.render.pageNo<=CAICUI.render.pageTotal-1&&(CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=+CAICUI.render.pageNo+1,this.examList(function(a){var t=new r;e("body #scroller").html(t.render(a).el),window.CAICUI.myScroll.refresh()}))}});return n});