define(["jquery","underscore","backbone","views/ac-list","views/ac-desc","layer","layerExt"],function(e,a,r,t,n){"use strict";var i=r.View.extend({el:"body #right",template:a.template(e("#template-my-ac").html()),events:{"click .myAc-nav-li":"myAcNavLi","mouseleave .ac-select-box":"selectBoxLeave","click .ac-select-a":"acSelectA","click .courseAc-option-li":"addActive","click .js-ac-list-active":"acListActive","click .courseAc-Ad-close":"courseAcAdClose","click .option-li":"acOptionChoose","click .js-pagination-li":"paginationChange","click .js-pagination-prev":"paginationPrev","click .js-pagination-next":"paginationNext","click .ac-desc-like-a":"likeAc","click .ac-search-a":"searchAc","click .ac-list-info-video":"acVideoLink","click .ac-list-remove":"acRemove","click .ac-answer-replys":"acAnswerReplys","click .js-ac-load-cancel":"acLoadCancel","click .js-ac-load-confirm":"acLoadConfirm","click .js-acReply-load-cancel":"acReplyLoadCancel","click .js-acReply-load-confirm":"acReplyLoadConfirm"},render:function(a){this.$el.html(this.template({data:{type:0}})),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper"),CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px",position:"relative"}),this.$scroller=this.$("#scroller"),this.$courseAcContent=this.$(".ac-content"),this.$courseAcRight=this.$(".ac-right"),CAICUI.render.$this=this,CAICUI.render.navType=0,CAICUI.render.self=1,CAICUI.render.type=3,CAICUI.render.ordertype=1,CAICUI.render.pageNo=1,CAICUI.render.pageSize=20,CAICUI.render.search="",CAICUI.render.totalCount="",CAICUI.render.pageTotal=0,CAICUI.render.bbsId="",CAICUI.render.bbsType=0,CAICUI.render.listActive="",CAICUI.render.replayId="",CAICUI.render.replayContent="",CAICUI.render.parentsAcListActive="",CAICUI.render.acRemoveLoad="",CAICUI.render.parentLi="",CAICUI.render.acReplayRemoveLoad="",CAICUI.render.removeReplayNum=0,this.myAcList(function(){e("body .js-ac-list-active").eq(0).trigger("click")})},bbslist:function(e){CAICUI.Request.ajax({server:"bbslist",data:{token:CAICUI.User.token,type:CAICUI.render.type,subjectId:"",keyWords:CAICUI.render.search,self:CAICUI.render.self,ordertype:CAICUI.render.ordertype,pageNo:CAICUI.render.pageNo,pageSize:CAICUI.render.pageSize},done:function(a){CAICUI.render.pageTotal=Math.ceil(a.totalCount/a.pageSize),e(a)},fail:function(a){e({})}})},bbslistMyJoin:function(e){CAICUI.Request.ajax({server:"bbslist_myJoin",data:{token:CAICUI.User.token,type:CAICUI.render.type,subjectId:"",keyWords:CAICUI.render.search,ordertype:CAICUI.render.ordertype,pageNo:CAICUI.render.pageNo,pageSize:CAICUI.render.pageSize},done:function(a){e(a)},fail:function(a){e({})}})},bbsdetail:function(e){CAICUI.Request.ajax({server:"bbsdetail",data:{token:CAICUI.User.token,id:CAICUI.render.replayId,pageNo:1,pageSize:20},done:function(a){e(a.data)},fail:function(a){e({})}})},likeAc:function(){CAICUI.Request.ajax({server:"bbs_praise",data:{token:CAICUI.User.token,id:CAICUI.render.replayId,action:2},done:function(a){CAICUI.render.listActive.find(".ac-list-info-like-num").text(a.data.totalCount),e(".ac-desc-like-num").text(a.data.totalCount)},fail:function(e){layer.msg("Sorry~ ",function(){})}})},bbs_del:function(e){CAICUI.Request.ajax({server:"bbs_del",data:{token:CAICUI.User.token,id:CAICUI.render.bbsId,type:CAICUI.render.bbsType},done:function(a){e&&e()},fail:function(e){layer.msg("Sorry~ 您没有当前帖子的删除权限",function(){})}})},acListActive:function(a){a.stopPropagation();var r=CAICUI.iGlobal.getThat(a),t=r.parents(".ac-list-li");CAICUI.render.listActive=r,t.siblings().removeClass("active"),t.addClass("active"),CAICUI.render.replayId=t.attr("data-id"),CAICUI.render.replayId?(CAICUI.iGlobal.loading(".ac-right"),this.bbsdetail(function(a){console.log(a);var r=new n;e(".ac-content").find(".ac-right").remove(),e(".ac-content").append(r.render({data:a,isme:!0}).el),window.CAICUI.acScroll=CAICUI.iGlobal.iScroll("body #wrapper-ac"),layer.photos({photos:".discussQA-imgPath",shift:0})})):layer.msg("Sorry~ 原帖已删除",function(){})},getThat:function(a){return e(a.currentTarget)},myAcNavLi:function(a){var r=this.getThat(a),t=r.index();switch(this.addActive(a),CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=1,CAICUI.render.navType=t,CAICUI.render.navType){case 0:this.myAcList();break;case 1:this.myJoin()}},myAcList:function(e){var a=new t;this.bbslist(function(r){CAICUI.render.$this.$scroller.html(a.render({data:{acType:"myAc",type:0,bbslist:r.data,pageNo:r.pageNo,pageSize:r.pageSize,totalCount:r.totalCount}}).el),window.CAICUI.myScroll.refresh(),e&&e()})},myJoin:function(){var e=new t;this.bbslistMyJoin(function(a){CAICUI.render.$this.$scroller.html(e.render({data:{type:1,bbslist:a.data,pageNo:a.pageNo,pageSize:a.pageSize,totalCount:a.totalCount}}).el),window.CAICUI.myScroll.refresh()})},courseNavAnimate:function(e,a){e.stop(!0,!1).animate({width:"148px"},this.courseNavAnimateTime)},courseNavPreAnimate:function(e){var a=this.$(".courseIndex-li").eq(e);this.$(".courseIndex-active-box").eq(e).stop(!0,!1).animate({width:34,marginLeft:0},this.courseNavAnimateTime,function(){a.removeClass("hover")})},nextDomShow:function(e){var a=this.getThat(e);a.next().toggleClass("active")},addActive:function(e){var a=this.getThat(e);return a.siblings().removeClass("active"),a.addClass("active"),a},acSelectA:function(e){var a=this.getThat(e);a.toggleClass("active"),a.next().toggleClass("active")},selectBoxLeave:function(e){var a=CAICUI.iGlobal.getThat(e);a.find("a").removeClass("active"),a.find("ul").removeClass("active")},courseAcAdClose:function(e){var a=this.getThat(e),r=a.parents("li");r.remove(),window.CAICUI.myScroll.refresh()},acOptionChoose:function(e){var a=CAICUI.iGlobal.getThat(e),r=a.find(".option-a").text();a.siblings().removeClass("active"),a.addClass("active"),a.parent().removeClass("active"),a.parent().prev().removeClass("active"),a.parent().prev().find(".ac-select-text").text(r),a.hasClass("option-li-render")&&(CAICUI.render.type=a.attr("data-type")?a.attr("data-type"):CAICUI.render.type,CAICUI.render.ordertype=a.attr("data-ordertype")?a.attr("data-ordertype"):CAICUI.render.ordertype,this.acOptionChooseRender())},acOptionChooseRender:function(){switch(CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=1,CAICUI.render.navType){case 0:this.myAcList();break;case 1:this.myJoin()}},paginationChange:function(a){CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh();var r=CAICUI.iGlobal.getThat(a);switch(CAICUI.render.pageNo=r.attr("data-pageno"),CAICUI.render.navType){case 0:this.myAcList();break;case 1:this.myJoin()}},paginationPrev:function(a){if(CAICUI.render.pageNo>1)switch(CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=+CAICUI.render.pageNo-1,CAICUI.render.navType){case 0:this.myAcList();break;case 1:this.myJoin()}},paginationNext:function(a){if(CAICUI.render.pageNo<=CAICUI.render.pageTotal-1)switch(CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=+CAICUI.render.pageNo+1,CAICUI.render.navType){case 0:this.myAcList();break;case 1:this.myJoin()}},searchAc:function(a){var r=CAICUI.iGlobal.getThat(a),t=r.prev(),n=t.val();switch(CAICUI.iGlobal.loading("body #scroller",{height:e("#wrapper").height()+"px"}),window.CAICUI.myScroll.refresh(),CAICUI.render.pageNo=1,CAICUI.render.search=n,CAICUI.render.navType){case 0:this.myAcList(),t.val(""),CAICUI.render.search="";break;case 1:this.myJoin(),t.val(""),CAICUI.render.search=""}},acVideoLink:function(e){e.stopPropagation(),CAICUI.NavVideo=!1,CAICUI.domRender=!1;var a=CAICUI.iGlobal.getThat(e);window.location.hash=a.attr("link")},acRemove:function(a){a.stopPropagation();var r=CAICUI.iGlobal.getThat(a);r.attr("data-pid");CAICUI.render.bbsType=r.attr("data-type");var t=r.parents(".ac-list-li");CAICUI.render.bbsId=t.attr("data-id"),CAICUI.render.parentsAcListActive=t,CAICUI.render.navType?CAICUI.render.bbsId=t.attr("data-pid"):CAICUI.render.bbsId=t.attr("data-id"),CAICUI.render.acRemoveLoad=layer.load(1,{type:1,title:!1,content:e("#remove-ac-load"),closeBtn:0,shade:[.5,"#000"]})},acLoadCancel:function(){layer.close(CAICUI.render.acRemoveLoad)},acLoadConfirm:function(){this.bbs_del(function(){CAICUI.render.parentsAcListActive.remove(),e("body .ac-right").empty(),e("#replys-"+CAICUI.render.bbsId)&&(e("#replys-"+CAICUI.render.bbsId).parents(".ac-answer-li").remove(),window.CAICUI.acScroll.refresh()),window.CAICUI.myScroll.refresh(),layer.close(CAICUI.render.acRemoveLoad)})},acAnswerReplys:function(a){a.stopPropagation();var r=CAICUI.iGlobal.getThat(a),t=r.parents(".ac-answer-li");CAICUI.render.removeReplayNum=t.index(),CAICUI.render.bbsId=r.attr("data-pid"),CAICUI.render.bbsType=r.attr("data-type"),CAICUI.render.parentLi=t,CAICUI.render.acReplayRemoveLoad=layer.load(1,{type:1,title:!1,content:e("#remove-acReply-load"),closeBtn:0,shade:[.5,"#000"]})},acReplyLoadCancel:function(){layer.close(CAICUI.render.acReplayRemoveLoad)},acReplyLoadConfirm:function(){this.bbs_del(function(){if(CAICUI.render.parentLi.siblings().length){CAICUI.render.parentLi.remove();var a=e(".ac-answer-li");a.each(function(a){var r=e(this);r.find(".ac-answer-floor").text(a+1)})}else CAICUI.render.parentLi.parent().remove(),CAICUI.render.parentLi.remove();if(CAICUI.render.navType)e("#pid-"+CAICUI.render.bbsId).parents(".ac-list-li").remove();else{var r=CAICUI.render.$this.$(".ac-list-ul .ac-list-li.active").find(".ac-list-info-discuss-num"),t=r.text();r.text(+t-1)}window.CAICUI.myScroll.refresh(),window.CAICUI.acScroll.refresh(),layer.close(CAICUI.render.acReplayRemoveLoad)})}});return i});