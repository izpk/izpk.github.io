define(["jquery","underscore","backbone"],function(e,t,a){"use strict";var n=a.View.extend({el:"body #right",template:t.template(e("#template-studycenterIndex").html()),events:{"mouseenter .studyin-content-subjects":"subjectEnter","mouseleave .studyin-content-subjects":"subjectLeave","click .contarner-start":"list","click .index-course-a":"changeNav"},render:function(){CAICUI.render.$this=this,this.mycount(),this.capabilityAssessment(),this.learningcourse(),this.slideList(),this.loginloglist(),this.getExamDate(),CAICUI.render.$this.$el.html(CAICUI.render.$this.template({data:{mycount:"",capabilityAssessment:"",RecentCourse:"",slideList:"",loginloglist:"",getExamDate:"",experience:""}})),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper")},mycount:function(){CAICUI.Request.ajax({server:"mycount",data:{token:CAICUI.User.token},done:function(t){CAICUI.render.$this.$mycount=t.data,e("body .nodeNum").text(t.data.nodeNum),e("body .acNum").text(t.data.questionNum+t.data.discuss)},fail:function(e){CAICUI.render.$this.$mycount={}}})},capabilityAssessment:function(){CAICUI.Request.ajax({server:"capabilityAssessment",data:{token:CAICUI.User.token,id:CAICUI.User.memberId},done:function(t){CAICUI.render.serverNum++,CAICUI.render.$this.$capabilityAssessment=t.data[0];var a=t.data[0]?t.data[0].total:"0";e("body .examNum").text(a)},fail:function(e){CAICUI.render.$this.$capabilityAssessment={}}})},learningcourse:function(){CAICUI.Request.ajax({server:"learningcourse",data:{token:CAICUI.User.token,pageNo:1,pageSize:CAICUI.defaultPageSize},done:function(t){CAICUI.CACHE.Learningcourse=t.data.courselist,CAICUI.CACHE.RecentCourse=CAICUI.render.$this.courselistFilter(t.data.courselist);var a=e("#template-studycenterIndex-courseList").html(),n=CAICUI.iGlobal.getTemplate(a,CAICUI.CACHE.RecentCourse);e("body .index-course-ul").html(n),e("body .index-course-li").each(function(e){CAICUI.iGlobal.canvasRound("progress-round-"+e)}),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper")},fail:function(e){CAICUI.CACHE.Learningcourse={},CAICUI.CACHE.RecentCourse={}}})},slideList:function(){CAICUI.Request.ajax({server:"slide-list",data:{tag:"0",valid:"true",count:"4"},done:function(t){CAICUI.render.$this.$slideList=t.data;var a=e("#template-studycenterIndex-activityList").html(),n=CAICUI.iGlobal.getTemplate(a,{slideList:t.data});e("body .index-activity-ul").html(n),window.CAICUI.myScroll=CAICUI.iGlobal.iScroll("body #wrapper")},fail:function(e){CAICUI.render.$this.$slideList={}}})},loginloglist:function(){CAICUI.Request.ajax({server:"loginloglist",data:{memberid:CAICUI.User.memberId,pageNo:1,pageSize:1},done:function(t){CAICUI.render.$this.$loginloglist=t.data[0];var a=t.data[0]?CAICUI.iGlobal.stringData(t.data[0].login_time/1e3):"第一次登陆";e("body .loginloglist").text(a)},fail:function(e){CAICUI.render.$this.$loginloglist={}}})},getExamDate:function(){CAICUI.Request.ajax({server:"getExamDate",data:{memberId:CAICUI.User.memberId},done:function(t){CAICUI.render.$this.$getExamDate=t.data[0];var t=t.data[0],a=t?t.categorySign+" "+CAICUI.iGlobal.getDate(t.examinationDate):"暂无考试";e("body .getExamDate").text(a)},fail:function(e){CAICUI.render.$this.$getExamDate={}}})},changeNav:function(){CAICUI.isNav=!0},courselistFilter:function(e){var a=[];if(e&&e.length)for(var n=t.chain(e).uniq("courseId").pick(function(e){return e.lastTaskdate}).sortBy("lastTaskdate").reverse().value(),i=0;i<n.length&&!(i>2);i++)n[i]&&n[i].lastTaskdate&&a.push(n[i]);return console.log(a),{RecentCourse:a}},subjectEnter:function(t){var a=t.currentTarget,n=e(a),i=(n.index(),n.find(".subject-lf").find(".subject-mask")),s=n.find(".subject-rt");i.stop(!0,!1).animate({left:"0"});var r={mask:i,rt:s};return r},subjectLeave:function(e){var t=this.subjectEnter(e).mask;t.stop(!0,!1).animate({left:"-160px"})}});return n});