<!DOCTYPE html><html><head><meta content="True" name="HandheldFriendly"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="author" content="XiunoBBS 3.0"><meta name="keywords" content="Xiuno BBS"><meta name="description" content="Xiuno BBS"><meta name="renderer" content="webkit"><title>发帖</title><link rel="shortcut icon" href="static/favicon.ico"><link rel="icon" sizes="32x32" href="static/favicon.ico"><link rel="Bookmark" href="static/favicon.ico"><link rel="stylesheet" type="text/css" media="screen" href="xiunoui/xiuno.css"><link rel="stylesheet" type="text/css" href="xiunoui/icon.css"><link rel="stylesheet" type="text/css" media="screen" href="static/bbs.css"><link rel="stylesheet" type="text/css" media="screen" href="view/pc.css"><style type="text/css">html,body{
    		width: 100%;
    		height: 100%;
    	}
    	.editor-form{
    		position: relative;
    		width: 100%;
    		height: 100%;
    		overflow: hidden;
    	}
    	.editor-box{
    		width: 100%;
    		height: 100%;
    	}
    	.message{
    		width: 100%;
    		height: 115px;
    	}
    	.editor-button-box{
    		position: absolute;
    		right: 0;
    		bottom: 10px;

    	}
    	.reply-button{
    		float: right;
    		width: 144px;
    		height: 28px;
    		padding: 0;
    		line-height: 28px;
    		text-align: center;
    		font-size: 14px;
    		color: #fff;
    		border: 0;
    		border-radius: 0;
    		background-image: none;
    		background-color: #3E4E63;
    	}</style><script>var debug = 0;</script></head><body><!-- <div class="editor" style="width:100%;height:170px;"> --><form method="POST" id="thread_create_form" class="editor-form" action="http://api.caicui.com/api/studytools/discussreply/v2.1"><div class="editor-box"><textarea id="message" class="message" name="message" placeholder="内容"></textarea></div><div class="editor-button-box"><button id="submit" type="submit" loading-text="正在提交..." class="reply-button">回复</button> <input id="reset" type="reset" name="reset" value="重置" style="display:none"></div></form><!-- </div> --><script id="script_data">// 全局的数据
    var fid = 0; // 当前激活的 fid
    var forumlist = {
        "1": {
            "fid": "1",
            "name": "acca",
            "rank": "0",
            "threads": "11",
            "todayposts": "0",
            "todaythreads": "0",
            "brief": "默认版块介绍",
            "accesson": "0",
            "orderby": "0",
            "create_date": "1452956691",
            "icon": "0",
            "moduids": "",
            "seo_title": "",
            "seo_keywords": "",
            "create_date_fmt": "2016-1-16",
            "icon_url": "static/forum.png",
            "accesslist": [],
            "modlist": [],
            "newtids": {
                "113": 1453191807
            }
        }
    }; // 板块数据，包含 new_tids
    var new_thread_days = 3;

    var messageHeight = document.documentElement.scrollHeight-74;
    document.getElementById('message').style.height =  messageHeight+'px';</script><script src="xiunoui/zepto.js"></script><script src="xiunoui/xiuno.js"></script><script src="xiunoui/dialog.js"></script><script src="xiunoui/md5.js"></script><script src="static/bbs.js"></script></body></html><link rel="stylesheet" type="text/css" href="xneditor/editor.css"><script src="xiunoui/async.js"></script><script src="xiunoui/upload.js"></script><script src="xneditor/editor.js"></script><script>if(window.location.protocol!="file:"){
    localStorage.setItem('xneditor_pdata_message',JSON.stringify(''))
}
var editor = new $.XNEditor({
    
    textarea: 'message',
    image_upload_url: 'http://bbs.caicui.com/post-upload-1.htm',
    image_upload_width: 927,
    file_upload_url: 'http://bbs.caicui.com/post-upload-0.htm',
    
    tools : 'Cut,Copy',
    skin:'default'
    
});
var jform = $('#thread_create_form');
var jinput = jform.find('input');
var jsubject = jinput.filter('[name="subject"]');
var jmessage = $('#message');
var jseo_url = jform.find('input[name="seo_url"]');
var jsubmit = jform.find('button').filter('[type="submit"]');

// 选择论坛
// var jforum_select = $('#forum_select');
// var forumarr = {
//     "1": "acca"
// };
// var s = '<select name="fid">';
// for (k in forumarr) s += '<option value="' + k + '">' + forumarr[k] + '</option>';
// s += '</select>';
// var jselect = jforum_select.html(s).find('select');
// jselect.checked(fid);

jform.off('submit').on('submit', function() {
    // if (!jsubject.val()) {
    //     jsubject.popover('请输入标题！').focus();
    //     return false;
    // }
    if (!jmessage.val()) {
        editor.jeditor.popover('请输入内容');
        editor.focus();
        return false;
    }
    jsubmit.button('loading');
    var postdata = jform.serializeObj();
    // var newPostData = {
    //     "token" : parent.iMobile.constant.user['token'],
    //     "id" : parent.discussQADesc.discussQAId,
    //     "subjectId" : "subjectId",
    //     "content" : postdata.message,
    //     "clientType" : "pcWeb"
    // };
    //console.log(postdata.message)
    //console.log(parent.CAICUI.render.replayId)
    var thisParent= parent;
    thisParent.CAICUI.render.replayContent = postdata.message;
    thisParent.CAICUI.Request.ajax({
        'server' : 'bbsreply',
        'data' : {
            'token' : thisParent.CAICUI.User.token,
            'id' : thisParent.CAICUI.render.replayId,
            'content' : thisParent.CAICUI.render.replayContent,
            'replaytype' : 0,
            'pageNo' : 1,
            'pageSize' : 20
        },
        done : function(data){
           
            thisParent.CAICUI.Request.ajax({
                'server' : 'bbsdetail',
                'data' : {
                    'token' : thisParent.CAICUI.User.token,
                    'id' : thisParent.CAICUI.render.replayId,
                    'pageNo' : 1,
                    'pageSize' : 20
                },
                done : function(data){
                    var replysLength = data.data.replys.length;
                    var addDetailData = data.data.replys[replysLength-1];

                    var addTemp = thisParent.CAICUI.underscore.template($('#template-ac-detail-li').html());
                    if(replysLength<=1){
                        thisParent.$('body .ac-answer').append(addTemp({
                          "CAICUI" : thisParent.CAICUI,
                          "element" : addDetailData,
                          "index" : replysLength
                        }));
                    }else{
                        thisParent.$('body .ac-answer-ul').append(addTemp({
                          "CAICUI" : thisParent.CAICUI,
                          "element" : addDetailData,
                          "index" : replysLength
                        }));
                    }
                    

                    
                    thisParent.$('body .ac-list-ul .ac-list-li.active').find('.ac-list-info-discuss-num').text(replysLength);
                    thisParent.CAICUI.acScroll.refresh();

                    jsubmit.button('回复');
                    $('#reset').click();
                    $('#submit').removeClass('disabled').removeAttr('disabled');
                    editor.clear();
                }
            })
            //return;
        }
    })
   
    return false;
});

// 快捷键回复
jform.keyup(function(e) {
    if ((e.ctrlKey && (e.which == 13 || e.which == 10)) || (e.altKey && e.which == 83)) {
        jsubmit.trigger('click');
        return false;
    }
});</script><script id="template-ac-detail-li" type="text/template"> <% if(index<=1){ %> <ul class="ac-answer-ul"> <% } %> <li class="ac-answer-li">
              <img class="ac-answer-avatar" src="<%= CAICUI.Common.host.imgAddress + element.headImg %>">
              <div class="ac-answer-info">
                <p class="ac-answer-info-top">
                  <span class="ac-answer-user-name"><%= element.nikeName %></span>
                  <span class="ac-answer-line"></span>
                  <span class="ac-answer-time"><%= CAICUI.iGlobal.stringData(element.updateTime) %></span> <% if(element.del_permission){ %> <span class="ac-answer-line"></span>
                    <a id="replys-<%= element.pid %>" class="ac-answer-replys" data-pid="<%= element.pid %>" data-type="1" href="javascript:;">删除</a> <% } %> <span class="ac-answer-floor"><%= index %></span>
                </p>
                <div class="ac-answer-info-desc"> <%= element.contentHtml %> </div>
              </div>
            </li> <% if(index<=1){ %> </ul> <% } %> </script>