function post_list_script(t){var i=$("#quick_post_form"),e=i.find('button[type="submit"]'),o=i.find("textarea"),n=$("#postlist"),a=$.pdata("myagreelist");a||(a={}),empty(a)||n.find("dl[pid]").add("#firstpost").each(function(){var t=$(this),i=t.attr("pid"),e=t.find("i.agree"),o=t.find("i.agreed");a[i]?(e.hide(),o.show()):(e.show(),o.hide())}),$("#firstpost").find("a.delete").on("click",function(){var i=$(this),e=i.attr("href");return $.confirm("你确定删除主题吗？",function(){$.xpost(e,function(i,e){0==i?($.alert("删除成功。"),setTimeout(function(){window.location="forum-"+t+".htm"},500)):$.alert(e)})}),!1}),n.on("click","a.delete",function(){var t=$(this),i=t.attr("href"),e=t.parents("dl[pid]"),o=e.attr("pid");return $.confirm("你确定删除吗？",function(){$.xpost(i,function(t,i){if(0==t){e.next("p.hr").removeDeep(),e.removeDeep();var n=$("#posts");n.text(intval(n.text())-1),a&&(delete a[o],$.pdata("myagreelist",a))}else $.alert(i)})}),!1}),n.add("#firstpost").on("click","i.agree,i.agreed",function(){var t=$(this),i=(t.attr("href"),t.parents("dl[pid]")),e=i.attr("pid"),o=t.siblings("a.agrees"),n=i.find("i.agree"),r=i.find("i.agreed");return $.xpost("agree-update-"+e+".htm",function(t,i){0==t?(n.hide(),r.show(),o.text(intval(o.text())+1),a[e]=time(),$.pdata("myagreelist",a)):1==t?(n.show(),r.hide(),o.text(intval(o.text())-1),delete a[e],$.pdata("myagreelist",a)):$.alert(i)}),!1}),window.allowpost||(o.attr("readonly","readonly").attr("placeholder","您无权在此版块发帖"),e.button("disabled")),e.on("click",function(){var t=$("#quick_post_form"),i=t.find('button[type="submit"]');i.button("loading");var e=t.serialize();return $.xpost(t.attr("action"),e,function(e,n){if(0==e){var a=function(e,o){var n=t.find("textarea").focus(),a=$(o).appendTo("#postlist");a.line_ok(),n.val("");var r=$("#posts");r.text(intval(r.text())+1);var d=$("#threadlist").find('div[tid="'+tid+'"]').find("span.posts");d.text(intval(d.text())+1),setTimeout(function(){i.button("reset")},500)};return void a(e,n)}1==e?jsubject.popover(n).focus():2==e?o.popover(n).focus():$.alert(n),i.button("reset")}),!1}),save_view_tid(t,tid,thread.last_date),$("#quick_post_form").keyup(function(t){return t.ctrlKey&&(13==t.which||10==t.which)||t.altKey&&83==t.which?(e.trigger("click"),!1):void 0})}function thread_list_script(){var t=$("#threadlist"),i=$("#mod_top"),e=$("#mod_move"),o=$("#mod_delete"),n=$("#threadlist_checkall");i.off("click").on("click",function(){var i=t.find('input[name="tid"]'),e=[];i.map(function(){this.checked&&e.push(this.value)});$.ajax_dialog("mod-top-"+e.join("_")+".htm",!1)}),e.off("click").on("click",function(){var i=t.find('input[name="tid"]'),e=[];i.map(function(){this.checked&&e.push(this.value)});$.ajax_dialog("mod-move-"+e.join("_")+".htm",!1)}),o.off("click").on("click",function(){var i=t.find('input[name="tid"]'),e=[];i.map(function(){this.checked&&e.push(this.value)});$.ajax_dialog("mod-delete-"+e.join("_")+".htm",!1)}),t.find('input[type="checkbox"]').on("click",function(t){t.stopPropagation()}),n.off("click").on("click",function(){t.find('input[type="checkbox"]').prop("checked",this.checked)}),t.find("div.thread").on("click",function(){window.location=$(this).attr("href")})}var jforumlist=$("#forumlist"),jthreadlist=$("#threadlist"),render_forumlist=function(){var t=$.pdata("view_tids"),i=0;jforumlist.find("i.newthreads").each(function(){var e=$(this),o=e.attr("fid");if(0!=o){var n=get_view_tids(o,t),a=forumlist[o]?forumlist[o].newtids:{},r=diff_new_tids(a,n),d=Object.count(r);d>0?e.text(min(99,d)):e.hide(),i+=d}}),0==i?jforumlist.find('i.newthreads[fid="0"]').hide():jforumlist.find('i.newthreads[fid="0"]').text(i)},render_threadlist=function(t){var i=t;jforumlist.find('li[fid="0"]').hasClass("active")&&(i=0);var e=get_view_tids(i,$.pdata("view_tids")),o=get_new_tids(i);jthreadlist.find("div.thread").each(function(){var t=$(this),i=t.attr("tid"),n=intval(t.attr("last_date"));o[i]&&(!e[i]||e[i]<n)?t.addClass("new"):t.removeClass("new")}),thread_list_script()},document_scroll_top=function(){var t=$("#scroll_top");$(window).height();t.off("click").on("click",function(){document.body.scrollTop?$(document.body).animate({scrollTop:0},120):document.documentElement.scrollTop&&$(document.documentElement).animate({scrollTop:0},120)});var i=function(i){var e=document.body.scrollTop||document.documentElement.scrollTop;e>400?(t.is_show||t.fadeIn(),t.is_show=1):(t.fadeOut(),t.is_show=0)};$(document).on("scroll DOMMouseScroll",i),i()},jsrch_form=$("#srch_form");jsrch_form.on("submit",function(){var t=xn_urlencode(jsrch_form.son("input").val()),i="search-"+t+".htm";return window.location=i,!1}),jsrch_form.find("i").on("click",function(){jsrch_form.submit()});var forumlist_active=function(t){jforumlist.find('li[fid="'+t+'"]').addClass("active")};$("body").off("click").on("click","a.ajax,div.ajax>a,div.ajax",function(t){var i=$(this);return ajax_on_click(t,i),!1});var ajax_on_click=function(t,i){var e=i.attr("href");i.attr("target")||i.parent("div").attr("target");if(t.ctrlKey)return!0;if(!i.hasClass("dialog"))return!0;var o=!i.hasClass("nocache"),n=json_decode(i.attr("dialog"));n&&(n.pos_element=i[0]);$.ajax_dialog(e,o,n);return!1};