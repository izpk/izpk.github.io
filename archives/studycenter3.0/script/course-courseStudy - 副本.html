<script id="template-course-courseStudy" type="text/template"><div class="courseIndex">
		<ul class="option-ul course-change-ul"> <% 
				var courseName;
				_.each(data.learningcourse,function(element, index, list){ 
					_.each(element.newList,function(element, index){
						_.each(element.list,function(element, index){
							if(element.courseId == data.courseId){
								courseName = element.courseName;
							}
			%> <li class="option-li"><a class="option-a" data-courseid="<%= element.courseId %>" href="#courseStudy/<%= element.courseId %>"><%= element.courseName %></a></li> <%
						})
					})
				}) %> </ul>
		<div class="courseIndex-header">
			
			<div class="courseIndex-header-left"> <% if(courseName){ %> <a class="course-change" href="javascript:;">
						
						<span class="course-name"><%= courseName %></span>
						<i class="icon-triangle"></i>
					</a> <% }else{ %> <span class="course-name"><%= CAICUI.render.courseName %></span> <% }  %> </div>

			<div class="courseIndex-header-right">
				<ul class="courseIndex-ul">
					<li class="courseIndex-li active hover">
						<a class="courseIndex-a" href="javascript:;">
							<i class="icon icon-courseStudy"></i>
						</a>
						<div class="courseIndex-active-box">
							<div class="courseStudy-box js-courseIndex-nav-box">
								<a class="courseIndex-a-active" href="javascript:;">
									<i class="icon icon-courseStudy-active"></i>
								</a>
							</div>
						</div>
					</li>
					
					<li class="courseIndex-li">
						<a class="courseIndex-a" href="#courseAc/<%= data.courseId %>">
							<i class="icon icon-courseAc"></i>
						</a>
						<div class="courseIndex-active-box">
							<div class="courseAc-box js-courseIndex-nav-box">
								<a class="courseIndex-a-active" href="#courseAc/<%= data.courseId %>">
									<i class="icon icon-courseAc-active"></i>
								</a>
							</div>
						</div>
					</li>
					<li class="courseIndex-li">
						<a class="courseIndex-a" href="#courseNote/<%= data.courseId %>">
							<i class="icon icon-courseNote"></i>
						</a>
						<div class="courseIndex-active-box">
							<div class="courseNote-box js-courseIndex-nav-box">
								<a class="courseIndex-a-active" href="#courseNote/<%= data.courseId %>">
									<i class="icon icon-courseNote-active"></i>
								</a>
							</div>
						</div>
					</li>
				</ul>
			</div>

			

		</div>

		
			
		
		<div class="courseIndex-main">
			<div class="courseIndex-title">
				<i class="icon icon-course-title"></i>课程章节
				<div class="courseVersion">
					<span class="courseVersion-title">课程版本：</span>
					<div class="courseVersion-show"> <% console.log(data.courseDetail) %> <a class="courseVersion-show-btn active" href="javascript:;" title="<%= data.courseDetail.courseName %>"><span class="courseVersion-show-round"></span><%= data.courseDetail.courseName %><i class="icon-triangle"></i></a>
					</div>
				</div>
			</div>
			
			<ul class="courseVersion-list"> <%
					var courseActiveTimeIndex = 1; 
					_.each(data.courseVersion,function(element, index, list){
						var showCourseVersion = false;
						if(element.courseType && element.courseType != '1' && element.createDate>=data.courseActiveTime){
							showCourseVersion = true;
						}else{
							if(element.courseType && element.courseType != '1' && courseActiveTimeIndex){
								showCourseVersion = true;
								courseActiveTimeIndex = 0;
							}
						}
				%> <% if(showCourseVersion){ %> <li class="courseVersion-list-li">
						<a class="courseVersion-list-a" href="#courseStudy/<%= element.id %>" title="<%= element.title %>"> <%= element.title %> </a>
					</li> <% } %> <% }) %> </ul>
			<div class="courseIndex-content">
				<div class="courseIndex-content-left">
					
					<div class="course-list">
						<div id="wrapper" class="wrapper">
							<div id="scroller" class="scroller">
								
							</div>
						</div>
					</div>
				</div>
				<div class="courseIndex-content-right"> <% if(data.course_info){ %> <p class="course-title"><%= data.course_info.courseName %></p> <% 
						var lastLearnLink = '';
						var lastLearnChapterNameDom = ''; 
						if(data.lastLearnChapter && !data.lastLearnChapterName){
							lastLearnLink = '#video/'+data.courseId+'/'+data.lastLearnChapter.chapterId+'/'+ data.lastLearnChapter.taskId +'/'+ data.lastLearnChapter.progress +'?return_link=courseStudy/'+data.courseId+'&return_hash=on';
							lastLearnChapterNameDom = '上次学到：<span class="lastLearn-chapterName">'+data.lastLearnChapter.chapterName+' </span><i class="icon icon-course-arrow-right"></i>'
						}else{
							if(data.lastLearnChapterLink){
								lastLearnLink = data.lastLearnChapterLink
							}else{
								if(data.courseDetail.chapters[0].children){
									lastLearnLink = '#video/'+data.courseId+'/'+data.courseDetail.chapters[0].children[0].chapterId+'?return_link=courseStudy/'+data.courseId+'&return_hash=on'
								}else{
									lastLearnLink = '#video/'+data.courseId+'/'+data.courseDetail.chapters[0].chapterId+'?return_link=courseStudy/'+data.courseId+'&return_hash=on'
								}
							}
							if(data.lastLearnChapterName){ 
								lastLearnChapterNameDom = '上次学到：<span class="lastLearn-chapterName">'+data.lastLearnChapterName+' </span><i class="icon icon-course-arrow-right"></i>'
							}else{
								lastLearnChapterNameDom = '<i class="icon icon-course-arrow-right"></i><span class="lastLearn-chapterName">开始学习本课程</span>';
							}
						}	
						%> <a class="course-desc" href="<%= lastLearnLink %>"><%= lastLearnChapterNameDom %></a>
						<p>
							<a class="continue-learning" href="#video/<%= data.courseId %>/<%= data.courseInfo.chapterId %>?return_link=courseStudy/<%= data.courseId  %>&return_hash=on">继续学习</a>
							<a class="icon icon-handout-down" href="<%= CAICUI.Common.host.img + data.handout.path %>" target="_blank"></a>
						</p>
						<p class="course-info">
							考试时间： <% if(data.course_info.days<0){ %> 本科目考试时间未确定 <% }else if(data.course_info.days==0){ %> 请留意,本科目<strong>今天</strong>开始考试 <% }else{ %> 距本科目考试还有<strong><%=data.course_info.days%></strong>天 <% } %> <span>|</span>
								课程到期：<%= CAICUI.iGlobal.getDate(data.courseInfo.expirationTime) %> </p>
						<div class="course-progress">
							进度 <% 
								var taskprogress = data.courseInfo.taskprogress ? data.courseInfo.taskprogress : 0;
								var taskTotal = data.courseInfo.taskTotal ? data.courseInfo.taskTotal : 0;
								var percentage = 0;
								var lastProgress = data.courseInfo.lastProgress;
								if(taskprogress && taskTotal){
									var a = taskprogress/taskTotal;
									if(a>0 && a<0.01){
										a = 0.01
									}
									percentage = parseInt(a*100);
								}
								
							%> <span class="course-progress-box">
								<span class="course-progress-show" data-course-progress="<%= percentage %>">
									<i class="icon icon-course-progress"></i>
								</span>
								<i class="icon icon-course-no-progress"></i>
							</span> <%= percentage %>%
							
						</div> <% } %> </div>
			</div>
		</div>
	</div></script><script id="template-course-courseStudy" type="text/template"> <% if(data.courseDetail.availability && $.trim(data.courseDetail.availability) != ''){ %> <div class="courseIndex-content-tips" title="<%= data.courseDetail.availability %>"> <%= data.courseDetail.availability %> </div> <% } %> <ul class="course-list-one-ul"> <% 
		var hasTask = false;
		_.each(data.courseDetail.chapters,function(element, index, list){
			var courseActiveState = element.courseActiveState;
			var chaptersindex = index;
			if(element.children && element.children.length || element.tasks && element.tasks.length){
				hasTask = true;
		%> <li> <% if(element.children && element.children.length){ %> <a class="course-list-title-a" href="javascript:;"><i class="icon icon-arrow-right"></i><i class="icon icon-arrow-bottom"></i><%= element.chapterTitle %></a>
					
						<ul class="course-list-two-ul"> <% _.each(element.children,function(element, index, list){ 
								var chaptersindex2 = index;
							%> <li> <% if(element.children && element.children.length){ %> <a class="course-list-title-a course-list-title-two-a"  href="javascript:;"><i class="icon icon-arrow-right"></i><i class="icon icon-arrow-bottom"></i><%= element.chapterTitle %></a>
									<ul class="course-list-three-ul"> <% 
											_.each(element.children,function(element, index, list){ 
												var courseListLink = 'course-list-link';
												var courseListType = 'icon-course-list-default';
												var progress = 0;
												var total = 0;
												var tasksState = 'no';
												var tasksStateEndNum = 0;
												if(element.tasks){

												
												_.each(element.tasks,function(element,index){
													var progressTotal = 0;
													var elementProgress = element.progress ? element.progress : 0;
													progress += elementProgress;
													if(element.progress && element.total){
														progressTotal = parseInt(element.progress)/parseInt(element.total);
													}
													if(progressTotal>=0.9){
														tasksStateEndNum ++;
													}
												})
												if(tasksStateEndNum == element.tasks.length){
													tasksState = 'end';
												}else{
													if(progress){
														tasksState = 'ing';
													}else{
														tasksState = 'no';
													}
												}
												switch (tasksState){
													case 'no':
														courseListType = 'icon-course-list-default';
														break;
													case 'ing':
														courseListType = 'icon-course-list-learning';
														break;
													case 'end':
														courseListType = 'icon-course-list-completed';
														break;
												}
										%> <li> <% 
												var vidwoIsFree = false;
												if(data.courseDetail.courseActiveState==3  || element.isFree=='true'){
												//if(element.isFree=='false' && data.courseDetail.courseActiveState!=3){
													vidwoIsFree = true;
												}
												if(vidwoIsFree){
													courseListLink = 'js-course-list-link course-list-link';
													var link = '#video/'+data.courseId+'/'+element.chapterId+'?return_link=courseStudy/'+ data.courseId+'&return_hash=on';
													var videoNum = 0;
													var examNum = 0;
													
													_.each(element.tasks,function(element, index){
														if(element.taskType == "video"){
															videoNum = videoNum + 1;
														}else if(element.taskType == "exam"){
															examNum = examNum + 1;
														}
													});
													if(videoNum && examNum){
														courseListLink = 'js-course-list-link course-list-link course-list-link-width';
													}
												}else{
													var link = 'javascript:;';
													courseListType = 'icon-course-list-lock';
													courseListLink = 'js-course-list-link course-list-link course-list-link-nowidth';
												} 
											%> <a class="<%= courseListLink %>" link="<%= link %>" learning="learning" data-index="<%= chaptersindex + "|" + chaptersindex2 +"|" + index %>" href="javascript:;">
												<i class="icon icon-left <%= courseListType %>"></i>
												<span class="course-list-desc"><%= element.chapterTitle %></span>
												<div class="course-list-info"> <% if(videoNum){ %> <span class="course-list-triangle"></span>X<%= videoNum %> <% } %> <% if(examNum){ %> <i class="icon icon-course-exam"></i>X<%= examNum %> <% } %> </div>
											</a>
										</li> <% } }) %> </ul> <% 
										}else if(element.tasks && element.tasks.length){
											var courseListLink = 'course-list-link';
											var courseListType = 'icon-course-list-default'; 
											var progress = 0;
											var total = 0;
											var tasksState = 'no';
											var tasksStateEndNum = 0;

											_.each(element.tasks,function(element,index){
												var progressTotal = 0;
												var elementProgress = element.progress ? element.progress : 0;
												progress += elementProgress;
												if(element.progress && element.total){
													progressTotal = parseInt(element.progress)/parseInt(element.total);
												}
												if(progressTotal>=0.9){
													tasksStateEndNum ++;
												}
											})
											if(tasksStateEndNum == element.tasks.length){
												tasksState = 'end';
											}else{
												if(progress){
													tasksState = 'ing';
												}else{
													tasksState = 'no';
												}
											}
											switch (tasksState){
												case 'no':
													courseListType = 'icon-course-list-default';
													break;
												case 'ing':
													courseListType = 'icon-course-list-learning';
													break;
												case 'end':
													courseListType = 'icon-course-list-completed';
													break;
											}
									%> <% 
											var vidwoIsFree = false;
												if(data.courseDetail.courseActiveState==3  || element.isFree=='true'){
												//if(element.isFree=='false' && data.courseDetail.courseActiveState!=3){
													vidwoIsFree = true;
												}
											if(vidwoIsFree){
												courseListLink = 'js-course-list-link course-list-link';
												var link = '#video/'+data.courseId+'/'+element.chapterId+'?return_link=courseStudy/'+ data.courseId+'&return_hash=on';
												var videoNum = 0;
												var examNum = 0;
												
												_.each(element.tasks,function(element, index){
													if(element.taskType == "video"){
														videoNum = videoNum + 1;
													}else if(element.taskType == "exam"){
														examNum = examNum + 1;
													}
												});
												if(videoNum && examNum){
													courseListLink = 'js-course-list-link course-list-link course-list-link-width';
												}
											}else{
												var link = 'javascript:;';
												courseListType = 'icon-course-list-lock';
												courseListLink = 'js-course-list-link course-list-link course-list-link-nowidth';
											} 
										%> <a class="<%= courseListLink %>" link="<%= link %>" learning="learning" data-index="<%= chaptersindex + "|" + chaptersindex2  %>" href="javascript:;">
											<i class="icon icon-left <%= courseListType %>"></i>
											<span class="course-list-desc"><%= element.chapterTitle %></span>
											<div class="course-list-info"> <% if(videoNum){ %> <span class="course-list-triangle"></span>X<%= videoNum %> <% } %> <% if(examNum){ %> <i class="icon icon-course-exam"></i>X<%= examNum %> <% } %> </div>
										</a> <% } %> </li> <% }) %> </ul> <% }else if(element.tasks && element.tasks.length){ %> <% 
								var courseListLink = 'course-list-link';
								var courseListType = 'icon-course-list-default'; 
								var progress = 0;
								var total = 0;
								var tasksState = 'no';
								var tasksStateEndNum = 0;
								_.each(element.tasks,function(element,index){
									var progressTotal = 0;
									var elementProgress = element.progress ? element.progress : 0;
									progress += elementProgress;
									if(element.progress && element.total){
										progressTotal = parseInt(element.progress)/parseInt(element.total);
									}
									if(progressTotal>=0.9){
										tasksStateEndNum ++;
									}
								})
								if(tasksStateEndNum == element.tasks.length){
									tasksState = 'end';
								}else{
									if(progress){
										tasksState = 'ing';
									}else{
										tasksState = 'no';
									}
								}
								switch (tasksState){
									case 'no':
										courseListType = 'icon-course-list-default';
										break;
									case 'ing':
										courseListType = 'icon-course-list-learning';
										break;
									case 'end':
										courseListType = 'icon-course-list-completed';
										break;
								}
								var vidwoIsFree = false;
								if(data.courseDetail.courseActiveState==3  || element.isFree=='true'){
								//if(element.isFree=='false' && data.courseDetail.courseActiveState!=3){
									vidwoIsFree = true;
								}
								if(vidwoIsFree){
									courseListLink = 'js-course-list-link course-list-link';
									var link = '#video/'+data.courseId+'/'+element.chapterId+'?return_link=courseStudy/'+ data.courseId+'&return_hash=on';
									var videoNum = 0;
									var examNum = 0;
									
									_.each(element.tasks,function(element, index){
										if(element.taskType == "video"){
											videoNum = videoNum + 1;
										}else if(element.taskType == "exam"){
											examNum = examNum + 1;
										}
									});
									if(videoNum && examNum){
										courseListLink = 'js-course-list-link course-list-link course-list-link-width';
									}
								}else{
									var link = 'javascript:;';
									courseListType = 'icon-course-list-lock';
									courseListLink = 'js-course-list-link course-list-link course-list-link-nowidth';
								} 
						%> <a class="<%= courseListLink %>" link="<%= link %>" learning="learning" data-index="<%= chaptersindex %>" href="javascript:;">
							<i class="icon icon-left <%= courseListType %>"></i>
							<span class="course-list-desc"><%= element.chapterTitle %></span>
							<div class="course-list-info"> <% if(videoNum){ %> <span class="course-list-triangle"></span>X<%= videoNum %> <% } %> <% if(examNum){ %> <i class="icon icon-course-exam"></i>X<%= examNum %> <% } %> </div>
						</a> <% } %> </li> <%  } }) %> </ul></script>